"use strict";Object.defineProperty(exports,"__esModule",{value:true});var stream=require("stream");var stream__default=stream["default"];var util=require("util");var util__default=util["default"];var string_decoder=require("string_decoder");var string_decoder__default=string_decoder["default"];var awsSdk=require("aws-sdk");var awsSdk__default=awsSdk["default"];var url=require("url");var url__default=url["default"];var crypto=require("crypto");var crypto__default=crypto["default"];var buffer=require("buffer");var buffer__default=buffer["default"];var http=require("http");var http__default=http["default"];var https=require("https");var https__default=https["default"];var zlib=require("zlib");var zlib__default=zlib["default"];var commonjsGlobal=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function unwrapExports(x){return x&&x.__esModule?x["default"]:x}function createCommonjsModule(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}var require$$1=stream&&stream__default||stream;var require$$0=util&&util__default||util;var Generator;var stream$1;var util$1;stream$1=require$$1;util$1=require$$0;var index$2=function(){var callback,data,generator,options;if(arguments.length===2){options=arguments[0];callback=arguments[1]}else if(arguments.length===1){if(typeof arguments[0]==="function"){options={};callback=arguments[0]}else{options=arguments[0]}}else if(arguments.length===0){options={}}generator=new Generator(options);if(callback){data=[];generator.on("readable",function(){var d,results;results=[];while(d=generator.read()){results.push(data.push(options.objectMode?d:d.toString()))}return results});generator.on("error",callback);generator.on("end",function(){return callback(null,options.objectMode?data:data.join(""))})}return generator};Generator=function(options1){var base,base1,base2,base3,base4,base5,base6,base7,base8,i,j,len,ref,v;this.options=options1!=null?options1:{};stream$1.Readable.call(this,this.options);this.options.count=0;if((base=this.options).duration==null){base.duration=4*60*1e3}if((base1=this.options).columns==null){base1.columns=8}if((base2=this.options).max_word_length==null){base2.max_word_length=16}if((base3=this.options).fixed_size==null){base3.fixed_size=false}if(this.fixed_size_buffer==null){this.fixed_size_buffer=""}if((base4=this.options).start==null){base4.start=Date.now()}if((base5=this.options).end==null){base5.end=null}if((base6=this.options).seed==null){base6.seed=false}if((base7=this.options).length==null){base7.length=-1}if((base8=this.options).delimiter==null){base8.delimiter=","}this.count_written=0;this.count_created=0;if(typeof this.options.columns==="number"){this.options.columns=new Array(this.options.columns)}ref=this.options.columns;for(i=j=0,len=ref.length;j<len;i=++j){v=ref[i];if(v==null){v="ascii"}if(typeof v==="string"){this.options.columns[i]=Generator[v]}}return this};util$1.inherits(Generator,stream$1.Readable);var Generator_1=Generator;Generator.prototype.random=function(){if(this.options.seed){return this.options.seed=this.options.seed*Math.PI*100%100/100}else{return Math.random()}};Generator.prototype.end=function(){return this.push(null)};Generator.prototype._read=function(size){var column,data,header,j,k,l,len,len1,len2,len3,length,line,lineLength,m,ref;data=[];length=this.fixed_size_buffer.length;if(length){data.push(this.fixed_size_buffer)}while(true){if(this.count_created===this.options.length||this.options.end&&Date.now()>this.options.end){if(data.length){if(this.options.objectMode){for(j=0,len=data.length;j<len;j++){line=data[j];this.count_written++;this.push(line)}}else{this.count_written++;this.push(data.join(""))}}return this.push(null)}line=[];ref=this.options.columns;for(k=0,len1=ref.length;k<len1;k++){header=ref[k];line.push(""+header(this))}if(this.options.objectMode){lineLength=0;for(l=0,len2=line.length;l<len2;l++){column=line[l];lineLength+=column.length}}else{line=""+(this.count_created===0?"":"\n")+line.join(this.options.delimiter);lineLength=line.length}this.count_created++;if(length+lineLength>size){if(this.options.objectMode){data.push(line);for(m=0,len3=data.length;m<len3;m++){line=data[m];this.count_written++;this.push(line)}}else{if(this.options.fixed_size){this.fixed_size_buffer=line.substr(size-length);data.push(line.substr(0,size-length))}else{data.push(line)}this.count_written++;this.push(data.join(""))}break}length+=lineLength;data.push(line)}};Generator.ascii=function(gen){var char,column,j,nb_chars,ref;column=[];for(nb_chars=j=0,ref=Math.ceil(gen.random()*gen.options.max_word_length);0<=ref?j<ref:j>ref;nb_chars=0<=ref?++j:--j){char=Math.floor(gen.random()*32);column.push(String.fromCharCode(char+(char<16?65:97-16)))}return column.join("")};Generator.int=function(gen){return Math.floor(gen.random()*Math.pow(2,52))};Generator.bool=function(gen){return Math.floor(gen.random()*2)};index$2.Generator=Generator_1;var require$$0$1=string_decoder&&string_decoder__default||string_decoder;var Parser;var StringDecoder;var stream$2;var util$2;stream$2=require$$1;util$2=require$$0;StringDecoder=require$$0$1.StringDecoder;var index$4=function(){var callback,called,chunks,data,options,parser;if(arguments.length===3){data=arguments[0];options=arguments[1];callback=arguments[2];if(typeof callback!=="function"){throw Error("Invalid callback argument: "+JSON.stringify(callback))}if(!(typeof data==="string"||Buffer.isBuffer(arguments[0]))){return callback(Error("Invalid data argument: "+JSON.stringify(data)))}}else if(arguments.length===2){if(typeof arguments[0]==="string"||Buffer.isBuffer(arguments[0])){data=arguments[0]}else{options=arguments[0]}if(typeof arguments[1]==="function"){callback=arguments[1]}else{options=arguments[1]}}else if(arguments.length===1){if(typeof arguments[0]==="function"){callback=arguments[0]}else{options=arguments[0]}}if(options==null){options={}}parser=new Parser(options);if(data!=null){process.nextTick(function(){parser.write(data);return parser.end()})}if(callback){called=false;chunks=options.objname?{}:[];parser.on("readable",function(){var chunk,results;results=[];while(chunk=parser.read()){if(options.objname){results.push(chunks[chunk[0]]=chunk[1])}else{results.push(chunks.push(chunk))}}return results});parser.on("error",function(err){called=true;return callback(err)});parser.on("end",function(){if(!called){return callback(null,chunks)}})}return parser};Parser=function(options){var base,base1,base10,base11,base12,base13,base14,base15,base16,base2,base3,base4,base5,base6,base7,base8,base9,k,v;if(options==null){options={}}options.objectMode=true;this.options={};for(k in options){v=options[k];this.options[k]=v}stream$2.Transform.call(this,this.options);if((base=this.options).rowDelimiter==null){base.rowDelimiter=null}if(typeof this.options.rowDelimiter==="string"){this.options.rowDelimiter=[this.options.rowDelimiter]}if((base1=this.options).delimiter==null){base1.delimiter=","}if((base2=this.options).quote==null){base2.quote='"'}if((base3=this.options).escape==null){base3.escape='"'}if((base4=this.options).columns==null){base4.columns=null}if((base5=this.options).comment==null){base5.comment=""}if((base6=this.options).objname==null){base6.objname=false}if((base7=this.options).trim==null){base7.trim=false}if((base8=this.options).ltrim==null){base8.ltrim=false}if((base9=this.options).rtrim==null){base9.rtrim=false}if((base10=this.options).auto_parse==null){base10.auto_parse=false}if((base11=this.options).auto_parse_date==null){base11.auto_parse_date=false}if((base12=this.options).relax==null){base12.relax=false}if((base13=this.options).relax_column_count==null){base13.relax_column_count=false}if((base14=this.options).skip_empty_lines==null){base14.skip_empty_lines=false}if((base15=this.options).max_limit_on_data_read==null){base15.max_limit_on_data_read=128e3}if((base16=this.options).skip_lines_with_empty_values==null){base16.skip_lines_with_empty_values=false}this.lines=0;this.count=0;this.skipped_line_count=0;this.empty_line_count=0;this.is_int=/^(\-|\+)?([1-9]+[0-9]*)$/;this.is_float=function(value){return value-parseFloat(value)+1>=0};this._={};this._.decoder=new StringDecoder;this._.quoting=false;this._.commenting=false;this._.field=null;this._.nextChar=null;this._.closingQuote=0;this._.line=[];this._.chunks=[];this._.rawBuf="";this._.buf="";if(this.options.rowDelimiter){this._.rowDelimiterLength=Math.max.apply(Math,this.options.rowDelimiter.map(function(v){return v.length}))}return this};util$2.inherits(Parser,stream$2.Transform);var Parser_1=Parser;Parser.prototype._transform=function(chunk,encoding,callback){var err,error;if(chunk instanceof Buffer){chunk=this._.decoder.write(chunk)}try{this.__write(chunk,false);return callback()}catch(error){err=error;return this.emit("error",err)}};Parser.prototype._flush=function(callback){var err,error;try{this.__write(this._.decoder.end(),true);if(this._.quoting){this.emit("error",new Error("Quoted field not terminated at line "+(this.lines+1)));return}if(this._.line.length>0){this.__push(this._.line)}return callback()}catch(error){err=error;return this.emit("error",err)}};Parser.prototype.__push=function(line){var field,i,j,len,lineAsColumns,rawBuf,row;if(this.options.skip_lines_with_empty_values&&line.join("").trim()===""){return}row=null;if(this.options.columns===true){this.options.columns=line;rawBuf="";return}else if(typeof this.options.columns==="function"){this.options.columns=this.options.columns(line);rawBuf="";return}if(!this._.line_length&&line.length>0){this._.line_length=this.options.columns?this.options.columns.length:line.length}if(line.length===1&&line[0]===""){this.empty_line_count++}else if(line.length!==this._.line_length){if(this.options.relax_column_count){this.skipped_line_count++}else if(this.options.columns!=null){throw Error("Number of columns on line "+this.lines+" does not match header")}else{throw Error("Number of columns is inconsistent on line "+this.lines)}}else{this.count++}if(this.options.columns!=null){lineAsColumns={};for(i=j=0,len=line.length;j<len;i=++j){field=line[i];if(this.options.columns[i]===false){continue}lineAsColumns[this.options.columns[i]]=field}if(this.options.objname){row=[lineAsColumns[this.options.objname],lineAsColumns]}else{row=lineAsColumns}}else{row=line}if(this.count<this.options.from){return}if(this.count>this.options.to){return}if(this.options.raw){this.push({raw:this._.rawBuf,row:row});return this._.rawBuf=""}else{return this.push(row)}};Parser.prototype.__write=function(chars,end){var areNextCharsDelimiter,areNextCharsRowDelimiters,auto_parse,char,escapeIsQuote,i,isDelimiter,isEscape,isNextCharAComment,isQuote,isRowDelimiter,isRowDelimiterLength,is_float,is_int,l,ltrim,nextCharPos,ref,ref1,ref2,ref3,ref4,remainingBuffer,results,rowDelimiter,rtrim,wasCommenting;is_int=function(_this){return function(value){if(typeof _this.is_int==="function"){return _this.is_int(value)}else{return _this.is_int.test(value)}}}(this);is_float=function(_this){return function(value){if(typeof _this.is_float==="function"){return _this.is_float(value)}else{return _this.is_float.test(value)}}}(this);auto_parse=function(_this){return function(value){var m;if(!_this.options.auto_parse){return value}if(is_int(value)){value=parseInt(value)}else if(is_float(value)){value=parseFloat(value)}else if(_this.options.auto_parse_date){m=Date.parse(value);if(!isNaN(m)){value=new Date(m)}}return value}}(this);ltrim=this.options.trim||this.options.ltrim;rtrim=this.options.trim||this.options.rtrim;chars=this._.buf+chars;l=chars.length;i=0;if(this.lines===0&&65279===chars.charCodeAt(0)){i++}while(i<l){if(!end){remainingBuffer=chars.substr(i,l-i);if(!this.options.rowDelimiter&&i+3>l||!this._.commenting&&l-i<this.options.comment.length&&this.options.comment.substr(0,l-i)===remainingBuffer||this.options.rowDelimiter&&l-i<this._.rowDelimiterLength&&this.options.rowDelimiter.some(function(rd){return rd.substr(0,l-i)===remainingBuffer})||this.options.rowDelimiter&&this._.quoting&&l-i<this.options.quote.length+this._.rowDelimiterLength&&this.options.rowDelimiter.some(function(_this){return function(rd){return(_this.options.quote+rd).substr(0,l-i)===remainingBuffer}}(this))||l-i<=this.options.delimiter.length&&this.options.delimiter.substr(0,l-i)===remainingBuffer||l-i<=this.options.escape.length&&this.options.escape.substr(0,l-i)===remainingBuffer){break}}char=this._.nextChar?this._.nextChar:chars.charAt(i);this._.nextChar=l>i+1?chars.charAt(i+1):"";if(this.options.raw){this._.rawBuf+=char}if(this.options.rowDelimiter==null){nextCharPos=i;rowDelimiter=null;if(!this._.quoting&&(char==="\n"||char==="\r")){rowDelimiter=char;nextCharPos+=1}else if(!(!this._.quoting&&char===this.options.quote)&&(this._.nextChar==="\n"||this._.nextChar==="\r")){rowDelimiter=this._.nextChar;nextCharPos+=2;if(this.raw){rawBuf+=this._.nextChar}}if(rowDelimiter){if(rowDelimiter==="\r"&&chars.charAt(nextCharPos)==="\n"){rowDelimiter+="\n"}this.options.rowDelimiter=[rowDelimiter];this._.rowDelimiterLength=rowDelimiter.length}}if(!this._.commenting&&char===this.options.escape){escapeIsQuote=this.options.escape===this.options.quote;isEscape=this._.nextChar===this.options.escape;isQuote=this._.nextChar===this.options.quote;if(!(escapeIsQuote&&this._.field==null&&!this._.quoting)&&(isEscape||isQuote)){i++;char=this._.nextChar;this._.nextChar=chars.charAt(i+1);if(this._.field==null){this._.field=""}this._.field+=char;if(this.options.raw){this._.rawBuf+=char}i++;continue}}if(!this._.commenting&&char===this.options.quote){if(this._.quoting){areNextCharsRowDelimiters=this.options.rowDelimiter&&this.options.rowDelimiter.some(function(rd){return chars.substr(i+1,rd.length)===rd});areNextCharsDelimiter=chars.substr(i+1,this.options.delimiter.length)===this.options.delimiter;isNextCharAComment=this._.nextChar===this.options.comment;if(this._.nextChar&&!areNextCharsRowDelimiters&&!areNextCharsDelimiter&&!isNextCharAComment){if(this.options.relax){this._.quoting=false;this._.field=""+this.options.quote+this._.field}else{throw Error("Invalid closing quote at line "+(this.lines+1)+"; found "+JSON.stringify(this._.nextChar)+" instead of delimiter "+JSON.stringify(this.options.delimiter))}}else{this._.quoting=false;this._.closingQuote=this.options.quote.length;i++;if(end&&i===l){this._.line.push(auto_parse(this._.field||""));this._.field=null}continue}}else if(!this._.field){this._.quoting=true;i++;continue}else if(this._.field!=null&&!this.options.relax){throw Error("Invalid opening quote at line "+(this.lines+1))}}isRowDelimiter=this.options.rowDelimiter&&this.options.rowDelimiter.some(function(rd){return chars.substr(i,rd.length)===rd});if(isRowDelimiter){isRowDelimiterLength=this.options.rowDelimiter.filter(function(rd){return chars.substr(i,rd.length)===rd})[0].length}if(isRowDelimiter||end&&i===l-1){this.lines++}wasCommenting=false;if(!this._.commenting&&!this._.quoting&&this.options.comment&&chars.substr(i,this.options.comment.length)===this.options.comment){this._.commenting=true}else if(this._.commenting&&isRowDelimiter){wasCommenting=true;this._.commenting=false}isDelimiter=chars.substr(i,this.options.delimiter.length)===this.options.delimiter;if(!this._.commenting&&!this._.quoting&&(isDelimiter||isRowDelimiter)){if(isRowDelimiter&&this._.line.length===0&&this._.field==null){if(wasCommenting||this.options.skip_empty_lines){i+=isRowDelimiterLength;this._.nextChar=chars.charAt(i);continue}}if(rtrim){if(!this._.closingQuote){this._.field=(ref=this._.field)!=null?ref.trimRight():void 0}}this._.line.push(auto_parse(this._.field||""));this._.closingQuote=0;this._.field=null;if(isDelimiter){i+=this.options.delimiter.length;this._.nextChar=chars.charAt(i);if(end&&!this._.nextChar){isRowDelimiter=true;this._.line.push("")}}if(isRowDelimiter){this.__push(this._.line);this._.line=[];i+=isRowDelimiterLength;this._.nextChar=chars.charAt(i);continue}}else if(!this._.commenting&&!this._.quoting&&(char===" "||char==="\t")){if(this._.field==null){this._.field=""}if(!(ltrim&&!this._.field)){this._.field+=char}i++}else if(!this._.commenting){if(this._.field==null){this._.field=""}this._.field+=char;i++}else{i++}if(!this._.commenting&&((ref1=this._.field)!=null?ref1.length:void 0)>this.options.max_limit_on_data_read){throw Error("Delimiter not found in the file "+JSON.stringify(this.options.delimiter))}if(!this._.commenting&&((ref2=this._.line)!=null?ref2.length:void 0)>this.options.max_limit_on_data_read){throw Error("Row delimiter not found in the file "+JSON.stringify(this.options.rowDelimiter))}}if(end){if(this._.field!=null){if(rtrim){if(!this._.closingQuote){this._.field=(ref3=this._.field)!=null?ref3.trimRight():void 0}}this._.line.push(auto_parse(this._.field||""));this._.field=null}if(((ref4=this._.field)!=null?ref4.length:void 0)>this.options.max_limit_on_data_read){throw Error("Delimiter not found in the file "+JSON.stringify(this.options.delimiter))}if(l===0){this.lines++}if(this._.line.length>this.options.max_limit_on_data_read){throw Error("Row delimiter not found in the file "+JSON.stringify(this.options.rowDelimiter))}}this._.buf="";results=[];while(i<l){this._.buf+=chars.charAt(i);results.push(i++)}return results};index$4.Parser=Parser_1;var Transformer;var stream$3;var util$3;var slice=[].slice;stream$3=require$$1;util$3=require$$0;var index$6=function(){var argument,callback,data,error,handler,i,j,k,len,options,result,transform,type,v;options={};for(i=j=0,len=arguments.length;j<len;i=++j){argument=arguments[i];type=typeof argument;if(argument===null){type="null"}else if(type==="object"&&Array.isArray(argument)){type="array"}if(i===0){if(type==="function"){handler=argument}else if(type!==null){data=argument}continue}if(type==="object"){for(k in argument){v=argument[k];options[k]=v}}else if(type==="function"){if(handler&&i===arguments.length-1){callback=argument}else{handler=argument}}else if(type!=="null"){throw new Error("Invalid arguments")}}transform=new Transformer(options,handler);error=false;if(data){process.nextTick(function(){var len1,m,row;for(m=0,len1=data.length;m<len1;m++){row=data[m];if(error){break}transform.write(row)}return transform.end()})}if(callback||options.consume){result=[];transform.on("readable",function(){var r,results;results=[];while(r=transform.read()){if(callback){results.push(result.push(r))}else{results.push(void 0)}}return results});transform.on("error",function(err){error=true;if(callback){return callback(err)}});transform.on("end",function(){if(callback&&!error){return callback(null,result)}})}return transform};Transformer=function(options1,transform1){var base;this.options=options1!=null?options1:{};this.transform=transform1;this.options.objectMode=true;if((base=this.options).parallel==null){base.parallel=100}stream$3.Transform.call(this,this.options);this.running=0;this.started=0;this.finished=0;return this};util$3.inherits(Transformer,stream$3.Transform);var Transformer_1=Transformer;Transformer.prototype._transform=function(chunk,encoding,cb){var callback,err,l;this.started++;this.running++;if(this.running<this.options.parallel){cb();cb=null}try{l=this.transform.length;if(this.options.params!=null){l--}if(l===1){this._done(null,[this.transform.call(null,chunk,this.options.params)],cb)}else if(l===2){callback=function(_this){return function(){var chunks,err;err=arguments[0],chunks=2<=arguments.length?slice.call(arguments,1):[];return _this._done(err,chunks,cb)}}(this);this.transform.call(null,chunk,callback,this.options.params)}else{throw Error("Invalid handler arguments")}return false}catch(_error){err=_error;return this._done(err)}};Transformer.prototype._flush=function(cb){this._ending=function(){if(this.running===0){return cb()}};return this._ending()};Transformer.prototype._done=function(err,chunks,cb){var chunk,j,len;this.running--;if(err){return this.emit("error",err)}this.finished++;for(j=0,len=chunks.length;j<len;j++){chunk=chunks[j];if(typeof chunk==="number"){chunk=""+chunk}if(chunk!=null){this.push(chunk)}}if(cb){cb()}if(this._ending){return this._ending()}};index$6.Transformer=Transformer_1;var FUNC_ERROR_TEXT="Expected a function";var HASH_UNDEFINED="__lodash_hash_undefined__";var INFINITY=1/0;var funcTag="[object Function]";var genTag="[object GeneratorFunction]";var symbolTag="[object Symbol]";var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/;var reIsPlainProp=/^\w*$/;var reLeadingDot=/^\./;var rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var reRegExpChar=/[\\^$.*+?()[\]{}|]/g;var reEscapeChar=/\\(\\)?/g;var reIsHostCtor=/^\[object .+?Constructor\]$/;var freeGlobal=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();function getValue(object,key){return object==null?undefined:object[key]}function isHostObject(value){var result=false;if(value!=null&&typeof value.toString!="function"){try{result=!!(value+"")}catch(e){}}return result}var arrayProto=Array.prototype;var funcProto=Function.prototype;var objectProto=Object.prototype;var coreJsData=root["__core-js_shared__"];var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();var funcToString=funcProto.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objectToString=objectProto.toString;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Symbol$1=root.Symbol;var splice=arrayProto.splice;var Map$1=getNative(root,"Map");var nativeCreate=getNative(Object,"create");var symbolProto=Symbol$1?Symbol$1.prototype:undefined;var symbolToString=symbolProto?symbolProto.toString:undefined;function Hash(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}}function hashDelete(key){return this.has(key)&&delete this.__data__[key]}function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined}function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key)}function hashSet(key,value){var data=this.__data__;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this}Hash.prototype.clear=hashClear;Hash.prototype["delete"]=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;function ListCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function listCacheClear(){this.__data__=[]}function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false}var lastIndex=data.length-1;if(index==lastIndex){data.pop()}else{splice.call(data,index,1)}return true}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){data.push([key,value])}else{data[index][1]=value}return this}ListCache.prototype.clear=listCacheClear;ListCache.prototype["delete"]=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;function MapCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map$1||ListCache),string:new Hash}}function mapCacheDelete(key){return getMapData(this,key)["delete"](key)}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){getMapData(this,key).set(key,value);return this}MapCache.prototype.clear=mapCacheClear;MapCache.prototype["delete"]=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length}}return-1}function baseGet(object,path){path=isKey(path,object)?[path]:castPath(path);var index=0,length=path.length;while(object!=null&&index<length){object=object[toKey(path[index++])]}return index&&index==length?object:undefined}function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false}var pattern=isFunction(value)||isHostObject(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}function baseToString(value){if(typeof value=="string"){return value}if(isSymbol(value)){return symbolToString?symbolToString.call(value):""}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function castPath(value){return isArray(value)?value:stringToPath(value)}function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=="string"?"string":"hash"]:data.map}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}function isKey(value,object){if(isArray(value)){return false}var type=typeof value;if(type=="number"||type=="symbol"||type=="boolean"||value==null||isSymbol(value)){return true}return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||object!=null&&value in Object(object)}function isKeyable(value){var type=typeof value;return type=="string"||type=="number"||type=="symbol"||type=="boolean"?value!=="__proto__":value===null}function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}var stringToPath=memoize(function(string){string=toString(string);var result=[];if(reLeadingDot.test(string)){result.push("")}string.replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result});function toKey(value){if(typeof value=="string"||isSymbol(value)){return value}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function toSource(func){if(func!=null){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function memoize(func,resolver){if(typeof func!="function"||resolver&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);memoized.cache=cache.set(key,result);return result};memoized.cache=new(memoize.Cache||MapCache);return memoized}memoize.Cache=MapCache;function eq(value,other){return value===other||value!==value&&other!==other}var isArray=Array.isArray;function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&objectToString.call(value)==symbolTag}function toString(value){return value==null?"":baseToString(value)}function get$1(object,path,defaultValue){var result=object==null?undefined:baseGet(object,path);return result===undefined?defaultValue:result}var index$10=get$1;var Stringifier;var get;var stream$4;var util$4;stream$4=require$$1;util$4=require$$0;get=index$10;var index$8=function(){var callback,chunks,data,options,stringifier;if(arguments.length===3){data=arguments[0];options=arguments[1];callback=arguments[2]}else if(arguments.length===2){if(Array.isArray(arguments[0])){data=arguments[0]}else{options=arguments[0]}if(typeof arguments[1]==="function"){callback=arguments[1]}else{options=arguments[1]}}else if(arguments.length===1){if(typeof arguments[0]==="function"){callback=arguments[0]}else if(Array.isArray(arguments[0])){data=arguments[0]}else{options=arguments[0]}}if(options==null){options={}}stringifier=new Stringifier(options);if(data){process.nextTick(function(){var d,j,len;for(j=0,len=data.length;j<len;j++){d=data[j];stringifier.write(d)}return stringifier.end()})}if(callback){chunks=[];stringifier.on("readable",function(){var chunk,results;results=[];while(chunk=stringifier.read()){results.push(chunks.push(chunk))}return results});stringifier.on("error",function(err){return callback(err)});stringifier.on("end",function(){return callback(null,chunks.join(""))})}return stringifier};Stringifier=function(opts){var base,base1,base10,base11,base12,base2,base3,base4,base5,base6,base7,base8,base9,k,options,v;if(opts==null){opts={}}options={};for(k in opts){v=opts[k];options[k]=v}stream$4.Transform.call(this,options);this.options=options;if((base=this.options).delimiter==null){base.delimiter=","}if((base1=this.options).quote==null){base1.quote='"'}if((base2=this.options).quoted==null){base2.quoted=false}if((base3=this.options).quotedString==null){base3.quotedString=false}if((base4=this.options).eof==null){base4.eof=true}if((base5=this.options).escape==null){base5.escape='"'}if((base6=this.options).columns==null){base6.columns=null}if((base7=this.options).header==null){base7.header=false}if((base8=this.options).formatters==null){base8.formatters={}}if((base9=this.options.formatters).date==null){base9.date=function(value){return""+value.getTime()}}if((base10=this.options.formatters).bool==null){base10.bool=function(value){if(value){return"1"}else{return""}}}if((base11=this.options.formatters).object==null){base11.object=function(value){return JSON.stringify(value)}}if((base12=this.options).rowDelimiter==null){base12.rowDelimiter="\n"}if(this.countWriten==null){this.countWriten=0}switch(this.options.rowDelimiter){case"auto":this.options.rowDelimiter=null;break;case"unix":this.options.rowDelimiter="\n";break;case"mac":this.options.rowDelimiter="\r";break;case"windows":this.options.rowDelimiter="\r\n";break;case"unicode":this.options.rowDelimiter="\u2028"}return this};util$4.inherits(Stringifier,stream$4.Transform);var Stringifier_1=Stringifier;Stringifier.prototype.headers=function(){var k,label,labels;if(!this.options.header){return}if(!this.options.columns){return}labels=this.options.columns;if(typeof labels==="object"){labels=function(){var results;results=[];for(k in labels){label=labels[k];results.push(label)}return results}()}if(this.options.eof){labels=this.stringify(labels)+this.options.rowDelimiter}else{labels=this.stringify(labels)}return stream$4.Transform.prototype.write.call(this,labels)};Stringifier.prototype.end=function(chunk,encoding,callback){if(this.countWriten===0){this.headers()}return stream$4.Transform.prototype.end.apply(this,arguments)};Stringifier.prototype.write=function(chunk,encoding,callback){var base,e,error,preserve;if(chunk==null){return}preserve=typeof chunk!=="object";if(!preserve){if(this.countWriten===0&&!Array.isArray(chunk)){if((base=this.options).columns==null){base.columns=Object.keys(chunk)}}try{this.emit("record",chunk,this.countWriten)}catch(error){e=error;return this.emit("error",e)}if(this.options.eof){chunk=this.stringify(chunk)+this.options.rowDelimiter}else{chunk=this.stringify(chunk);if(this.options.header||this.countWriten){chunk=this.options.rowDelimiter+chunk}}}if(typeof chunk==="number"){chunk=""+chunk}if(this.countWriten===0){this.headers()}if(!preserve){this.countWriten++}return stream$4.Transform.prototype.write.call(this,chunk,encoding,callback)};Stringifier.prototype._transform=function(chunk,encoding,callback){this.push(chunk);return callback()};Stringifier.prototype.stringify=function(line){var _line,column,columns,containsEscape,containsLinebreak,containsQuote,containsdelimiter,delimiter,escape,field,i,j,l,newLine,quote,ref,ref1,regexp,shouldQuote,value;if(typeof line!=="object"){return line}columns=this.options.columns;if(typeof columns==="object"&&columns!==null&&!Array.isArray(columns)){columns=Object.keys(columns)}delimiter=this.options.delimiter;quote=this.options.quote;escape=this.options.escape;if(!Array.isArray(line)){_line=[];if(columns){for(i=j=0,ref=columns.length;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j){column=columns[i];value=get(line,column);_line[i]=typeof value==="undefined"||value===null?"":value}}else{for(column in line){_line.push(line[column])}}line=_line;_line=null}else if(columns){line.splice(columns.length)}if(Array.isArray(line)){newLine="";for(i=l=0,ref1=line.length;0<=ref1?l<ref1:l>ref1;i=0<=ref1?++l:--l){field=line[i];if(typeof field==="string"){}else if(typeof field==="number"){field=""+field}else if(typeof field==="boolean"){field=this.options.formatters.bool(field)}else if(field instanceof Date){field=this.options.formatters.date(field)}else if(typeof field==="object"&&field!==null){field=this.options.formatters.object(field)}if(field){containsdelimiter=field.indexOf(delimiter)>=0;containsQuote=field.indexOf(quote)>=0;containsEscape=field.indexOf(escape)>=0&&escape!==quote;containsLinebreak=field.indexOf("\r")>=0||field.indexOf("\n")>=0;shouldQuote=containsQuote||containsdelimiter||containsLinebreak||this.options.quoted||this.options.quotedString&&typeof line[i]==="string";if(shouldQuote&&containsEscape){regexp=escape==="\\"?new RegExp(escape+escape,"g"):new RegExp(escape,"g");field=field.replace(regexp,escape+escape)}if(containsQuote){regexp=new RegExp(quote,"g");field=field.replace(regexp,escape+quote)}if(shouldQuote){field=quote+field+quote}newLine+=field}else if(this.options.quotedEmpty||this.options.quotedEmpty==null&&line[i]===""&&this.options.quotedString){newLine+=quote+quote}if(i!==line.length-1){newLine+=delimiter}}line=newLine}return line};index$8.Stringifier=Stringifier_1;var generate;var parse;var stringify;var transform;generate=index$2;parse=index$4;transform=index$6;stringify=index$8;var generate_1=generate;var parse_1=parse;var transform_1=transform;var stringify_1=stringify;var index={generate:generate_1,parse:parse_1,transform:transform_1,stringify:stringify_1};var assertHasValidDynamoDBFieldNames=createCommonjsModule(function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const validFieldName=/^[a-z]+$/i;exports.assertHasValidDynamoDBFieldNames=(values=>{const invalidFieldNames=Object.keys(values).filter(key=>!validFieldName.test(key));if(invalidFieldNames.length>0){throw new Error(`Invalid field name specified ${invalidFieldNames}`)}})});var findAll=createCommonjsModule(function(module,exports){"use strict";var __await=commonjsGlobal&&commonjsGlobal.__await||function(v){return this instanceof __await?(this.v=v,this):new __await(v)};var __asyncGenerator=commonjsGlobal&&commonjsGlobal.__asyncGenerator||function(thisArg,_arguments,generator){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var g=generator.apply(thisArg,_arguments||[]),i,q=[];return i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i;function verb(n){if(g[n])i[n]=function(v){return new Promise(function(a,b){q.push([n,v,a,b])>1||resume(n,v)})}}function resume(n,v){try{step(g[n](v))}catch(e){settle(q[0][3],e)}}function step(r){r.value instanceof __await?Promise.resolve(r.value.v).then(fulfill,reject):settle(q[0][2],r)}function fulfill(value){resume("next",value)}function reject(value){resume("throw",value)}function settle(f,v){if(f(v),q.shift(),q.length)resume(q[0][0],q[0][1])}};Object.defineProperty(exports,"__esModule",{value:true});const createFilterExpression=(fieldNames,fields)=>fieldNames.reduce((obj,key)=>{obj[`:${key}`]=fields[key];return obj},{});exports.findAll=(({client:client,tableName:tableName,limit:limit})=>(function(fields){return __asyncGenerator(this,arguments,function*(){assertHasValidDynamoDBFieldNames.assertHasValidDynamoDBFieldNames(fields);if("id"in fields){throw new Error("Use read rather than find if you know the id")}const fieldNames=Object.keys(fields);const filterExpression=fieldNames.length===0?undefined:fieldNames.map(key=>`${key} = :${key}`).join(" and ");const expressionAtributeValues=fieldNames.length===0?undefined:createFilterExpression(fieldNames,fields);let key;do{const response=yield __await(client.scan({TableName:tableName,FilterExpression:filterExpression,ExpressionAttributeValues:expressionAtributeValues,ExclusiveStartKey:key,Limit:limit}).promise());for(const item of response.Items){yield item}key=response.LastEvaluatedKey}while(key!=null)})}))});var __findAll=createCommonjsModule(function(module,exports){"use strict";var __awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __asyncValues=commonjsGlobal&&commonjsGlobal.__asyncIterator||function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=o[Symbol.asyncIterator];return m?m.call(o):typeof __values==="function"?__values(o):o[Symbol.iterator]()};Object.defineProperty(exports,"__esModule",{value:true});exports.__findAll=(({client:client,tableName:tableName,limit:limit})=>fields=>__awaiter(commonjsGlobal,void 0,void 0,function*(){const result=[];try{for(var _a=__asyncValues(findAll.findAll({client:client,tableName:tableName,limit:limit})(fields)),_b;_b=yield _a.next(),!_b.done;){const item=yield _b.value;result.push(item)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{if(_b&&!_b.done&&(_c=_a.return))yield _c.call(_a)}finally{if(e_1)throw e_1.error}}return result;var e_1,_c}))});var create=createCommonjsModule(function(module,exports){"use strict";var __awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.create=(({client:client,tableName:tableName})=>item=>__awaiter(commonjsGlobal,void 0,void 0,function*(){assertHasValidDynamoDBFieldNames.assertHasValidDynamoDBFieldNames(item);const now=Date.now();const itemWithMetadata=Object.assign({},item,{version:0,created:now,modified:now});try{yield client.put({TableName:tableName,Item:itemWithMetadata,ConditionExpression:"attribute_not_exists(id)"}).promise()}catch(e){if(e.code!=="ConditionalCheckFailedException"){throw e}throw new Error(`Item already exists ${item.id}`)}return itemWithMetadata}))});var find=createCommonjsModule(function(module,exports){"use strict";var __awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.find=(({client:client,tableName:tableName,limit:limit})=>fields=>__awaiter(commonjsGlobal,void 0,void 0,function*(){const items=yield findAll.findAll({client:client,tableName:tableName,limit:limit})(fields);const firstResult=yield items.next();if(firstResult.done){throw new Error("No value found")}const secondResult=yield items.next();if(!secondResult.done){throw new Error("Multiple values found")}return firstResult.value}))});var read=createCommonjsModule(function(module,exports){"use strict";var __awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.read=(({client:client,tableName:tableName,consistent:consistent=false})=>id=>__awaiter(commonjsGlobal,void 0,void 0,function*(){const response=yield client.get({TableName:tableName,Key:{id:id},ConsistentRead:consistent}).promise();if(response.Item==null){throw new Error(`Key not found ${id}`)}return response.Item}))});var update=createCommonjsModule(function(module,exports){"use strict";var __awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.update=(({client:client,tableName:tableName})=>item=>__awaiter(commonjsGlobal,void 0,void 0,function*(){assertHasValidDynamoDBFieldNames.assertHasValidDynamoDBFieldNames(item);const itemWithMetadata=Object.assign({},item,{version:item.version+1,modified:Date.now()});const conditionAttributeValues={":previousVersion":item.version,":previousCreated":item.created};try{yield client.put({TableName:tableName,Item:itemWithMetadata,ConditionExpression:"version = :previousVersion AND created = :previousCreated",ExpressionAttributeValues:conditionAttributeValues}).promise();return itemWithMetadata}catch(e){if(e.code!=="ConditionalCheckFailedException"){throw e}throw new Error(`Item is out of date`)}}))});var reduce=createCommonjsModule(function(module,exports){"use strict";var __awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.reduce=(({client:client,tableName:tableName})=>{const getAggregate=(aggregateIdSelector,suppliedAggregate,event,aggregateFactory)=>__awaiter(commonjsGlobal,void 0,void 0,function*(){const id=aggregateIdSelector(event);if(suppliedAggregate!=null){if(suppliedAggregate.id!==id){throw new Error(`Aggregate supplied ${suppliedAggregate.id} does not match id ${id}`)}return suppliedAggregate}try{return yield read.read({client:client,tableName:tableName,consistent:false})(id)}catch(e){if(aggregateFactory==null||e.message!==`Key not found ${id}`){throw e}}const newAggregate=aggregateFactory(event);if(newAggregate.id!==id){throw new Error(`New aggregate id ${newAggregate.id} does not match selected id ${id}`)}return yield create.create({client:client,tableName:tableName})(newAggregate)});return(aggregateIdSelector,eventIdSelector,reducer,aggregateFactory)=>(event,aggregate)=>__awaiter(commonjsGlobal,void 0,void 0,function*(){const innerAggregate=yield getAggregate(aggregateIdSelector,aggregate,event,aggregateFactory);const eventId=eventIdSelector(event);const{lastReceived:previousLastReceived,lastEmitted:previousLastEmitted}=innerAggregate;if(previousLastReceived!=null&&previousLastReceived.id===eventId){return innerAggregate}let archivedEvent=null;try{archivedEvent=yield read.read({client:client,tableName:tableName,consistent:true})(eventId)}catch(e){if(e.message!==`Key not found ${eventId}`){throw e}}if(archivedEvent!=null){return innerAggregate}if(previousLastReceived!=null){try{yield create.create({client:client,tableName:tableName})(previousLastReceived)}catch(e){if(e.message!==`Item already exists ${previousLastReceived.id}`){throw e}}}if(previousLastEmitted!=null){try{yield create.create({client:client,tableName:tableName})(previousLastEmitted)}catch(e){if(e.message!==`Item already exists ${previousLastEmitted.id}`){throw e}}}let updatedLastEmitted=null;const emit=emittedEvent=>{if(updatedLastEmitted!=null){throw new Error(`Currently emit can only be invoked once ${updatedLastEmitted.id}.`)}updatedLastEmitted={id:emittedEvent.id,data:emittedEvent,previous:innerAggregate.lastEmitted&&innerAggregate.lastEmitted.id}};const reducedAggregate=yield reducer(innerAggregate,event,emit);const updatedLastReceived={id:eventId,data:event,previous:previousLastReceived&&previousLastReceived.id};const updatedAggregate=Object.assign({},reducedAggregate,{lastReceived:updatedLastReceived,lastEmitted:updatedLastEmitted});return yield update.update({client:client,tableName:tableName})(updatedAggregate)})})});var truncate=createCommonjsModule(function(module,exports){"use strict";var __awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.truncate=(({client:client,tableName:tableName})=>item=>__awaiter(commonjsGlobal,void 0,void 0,function*(){try{yield client.delete({TableName:tableName,Key:{id:item.id},ConditionExpression:"version = :version",ExpressionAttributeValues:{":version":item.version}}).promise()}catch(e){if(e.code!=="ConditionalCheckFailedException"){throw e}throw new Error(`Item is out of date`)}}))});var aws_sdk_1=awsSdk&&awsSdk__default||awsSdk;var index$12=createCommonjsModule(function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});Symbol.asyncIterator=Symbol.for("asyncIterator");exports.default=(({endpoint:endpoint=process.env.AWS_DYNAMODB_ENDPOINT,region:region=process.env.AWS_REGION,tableName:tableName,limit:limit})=>{const client=new aws_sdk_1.DynamoDB.DocumentClient({apiVersion:"2012-08-10",endpoint:endpoint,region:region});return{create:create.create({client:client,tableName:tableName}),read:read.read({client:client,tableName:tableName}),reduce:reduce.reduce({client:client,tableName:tableName}),update:update.update({client:client,tableName:tableName}),__findAll:__findAll.__findAll({client:client,tableName:tableName,limit:limit}),findAll:findAll.findAll({client:client,tableName:tableName,limit:limit}),find:find.find({client:client,tableName:tableName,limit:limit}),truncate:truncate.truncate({client:client,tableName:tableName})}})});var baseUrl=createCommonjsModule(function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.baseUrl=process.env.BASE_URL;if(exports.baseUrl==null){throw new Error("no $BASE_URL provided")}exports.lambdaBaseUrl=process.env.LAMBDA_BASE_URL;if(exports.lambdaBaseUrl==null){throw new Error("no $LAMBDA_BASE_URL provided")}});var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;var index$16=function(val,options){options=options||{};var type=typeof val;if(type==="string"&&val.length>0){return parse$1(val)}else if(type==="number"&&isNaN(val)===false){return options.long?fmtLong(val):fmtShort(val)}throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(val))};function parse$1(str){str=String(str);if(str.length>1e4){return}var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match){return}var n=parseFloat(match[1]);var type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return undefined}}function fmtShort(ms){if(ms>=d){return Math.round(ms/d)+"d"}if(ms>=h){return Math.round(ms/h)+"h"}if(ms>=m){return Math.round(ms/m)+"m"}if(ms>=s){return Math.round(ms/s)+"s"}return ms+"ms"}function fmtLong(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(ms<n){return}if(ms<n*1.5){return Math.floor(ms/n)+" "+name}return Math.ceil(ms/n)+" "+name+"s"}var hasOwnProperty$1=Object.prototype.hasOwnProperty;var pseudomap=PseudoMap;function PseudoMap(set){if(!(this instanceof PseudoMap))throw new TypeError("Constructor PseudoMap requires 'new'");this.clear();if(set){if(set instanceof PseudoMap||typeof Map==="function"&&set instanceof Map)set.forEach(function(value,key){this.set(key,value)},this);else if(Array.isArray(set))set.forEach(function(kv){this.set(kv[0],kv[1])},this);else throw new TypeError("invalid argument")}}PseudoMap.prototype.forEach=function(fn,thisp){thisp=thisp||this;Object.keys(this._data).forEach(function(k){if(k!=="size")fn.call(thisp,this._data[k].value,this._data[k].key)},this)};PseudoMap.prototype.has=function(k){return!!find$2(this._data,k)};PseudoMap.prototype.get=function(k){var res=find$2(this._data,k);return res&&res.value};PseudoMap.prototype.set=function(k,v){set(this._data,k,v)};PseudoMap.prototype.delete=function(k){var res=find$2(this._data,k);if(res){delete this._data[res._index];this._data.size--}};PseudoMap.prototype.clear=function(){var data=Object.create(null);data.size=0;Object.defineProperty(this,"_data",{value:data,enumerable:false,configurable:true,writable:false})};Object.defineProperty(PseudoMap.prototype,"size",{get:function(){return this._data.size},set:function(n){},enumerable:true,configurable:true});PseudoMap.prototype.values=PseudoMap.prototype.keys=PseudoMap.prototype.entries=function(){throw new Error("iterators are not implemented in this version")};function same(a,b){return a===b||a!==a&&b!==b}function Entry$1(k,v,i){this.key=k;this.value=v;this._index=i}function find$2(data,k){for(var i=0,s="_"+k,key=s;hasOwnProperty$1.call(data,key);key=s+i++){if(same(data[key].key,k))return data[key]}}function set(data,k,v){for(var i=0,s="_"+k,key=s;hasOwnProperty$1.call(data,key);key=s+i++){if(same(data[key].key,k)){data[key].value=v;return}}data.size++;data[key]=new Entry$1(k,v,key)}var map=createCommonjsModule(function(module){if(process.env.npm_package_name==="pseudomap"&&process.env.npm_lifecycle_script==="test")process.env.TEST_PSEUDOMAP="true";if(typeof Map==="function"&&!process.env.TEST_PSEUDOMAP){module.exports=Map}else{module.exports=pseudomap}});var yallist=Yallist;Yallist.Node=Node;Yallist.create=Yallist;function Yallist(list){var self=this;if(!(self instanceof Yallist)){self=new Yallist}self.tail=null;self.head=null;self.length=0;if(list&&typeof list.forEach==="function"){list.forEach(function(item){self.push(item)})}else if(arguments.length>0){for(var i=0,l=arguments.length;i<l;i++){self.push(arguments[i])}}return self}Yallist.prototype.removeNode=function(node){if(node.list!==this){throw new Error("removing node which does not belong to this list")}var next=node.next;var prev=node.prev;if(next){next.prev=prev}if(prev){prev.next=next}if(node===this.head){this.head=next}if(node===this.tail){this.tail=prev}node.list.length--;node.next=null;node.prev=null;node.list=null};Yallist.prototype.unshiftNode=function(node){if(node===this.head){return}if(node.list){node.list.removeNode(node)}var head=this.head;node.list=this;node.next=head;if(head){head.prev=node}this.head=node;if(!this.tail){this.tail=node}this.length++};Yallist.prototype.pushNode=function(node){if(node===this.tail){return}if(node.list){node.list.removeNode(node)}var tail=this.tail;node.list=this;node.prev=tail;if(tail){tail.next=node}this.tail=node;if(!this.head){this.head=node}this.length++};Yallist.prototype.push=function(){for(var i=0,l=arguments.length;i<l;i++){push(this,arguments[i])}return this.length};Yallist.prototype.unshift=function(){for(var i=0,l=arguments.length;i<l;i++){unshift(this,arguments[i])}return this.length};Yallist.prototype.pop=function(){if(!this.tail){return undefined}var res=this.tail.value;this.tail=this.tail.prev;if(this.tail){this.tail.next=null}else{this.head=null}this.length--;return res};Yallist.prototype.shift=function(){if(!this.head){return undefined}var res=this.head.value;this.head=this.head.next;if(this.head){this.head.prev=null}else{this.tail=null}this.length--;return res};Yallist.prototype.forEach=function(fn,thisp){thisp=thisp||this;for(var walker=this.head,i=0;walker!==null;i++){fn.call(thisp,walker.value,i,this);walker=walker.next}};Yallist.prototype.forEachReverse=function(fn,thisp){thisp=thisp||this;for(var walker=this.tail,i=this.length-1;walker!==null;i--){fn.call(thisp,walker.value,i,this);walker=walker.prev}};Yallist.prototype.get=function(n){for(var i=0,walker=this.head;walker!==null&&i<n;i++){walker=walker.next}if(i===n&&walker!==null){return walker.value}};Yallist.prototype.getReverse=function(n){for(var i=0,walker=this.tail;walker!==null&&i<n;i++){walker=walker.prev}if(i===n&&walker!==null){return walker.value}};Yallist.prototype.map=function(fn,thisp){thisp=thisp||this;var res=new Yallist;for(var walker=this.head;walker!==null;){res.push(fn.call(thisp,walker.value,this));walker=walker.next}return res};Yallist.prototype.mapReverse=function(fn,thisp){thisp=thisp||this;var res=new Yallist;for(var walker=this.tail;walker!==null;){res.push(fn.call(thisp,walker.value,this));walker=walker.prev}return res};Yallist.prototype.reduce=function(fn,initial){var acc;var walker=this.head;if(arguments.length>1){acc=initial}else if(this.head){walker=this.head.next;acc=this.head.value}else{throw new TypeError("Reduce of empty list with no initial value")}for(var i=0;walker!==null;i++){acc=fn(acc,walker.value,i);walker=walker.next}return acc};Yallist.prototype.reduceReverse=function(fn,initial){var acc;var walker=this.tail;if(arguments.length>1){acc=initial}else if(this.tail){walker=this.tail.prev;acc=this.tail.value}else{throw new TypeError("Reduce of empty list with no initial value")}for(var i=this.length-1;walker!==null;i--){acc=fn(acc,walker.value,i);walker=walker.prev}return acc};Yallist.prototype.toArray=function(){var arr=new Array(this.length);for(var i=0,walker=this.head;walker!==null;i++){arr[i]=walker.value;walker=walker.next}return arr};Yallist.prototype.toArrayReverse=function(){var arr=new Array(this.length);for(var i=0,walker=this.tail;walker!==null;i++){arr[i]=walker.value;walker=walker.prev}return arr};Yallist.prototype.slice=function(from,to){to=to||this.length;if(to<0){to+=this.length}from=from||0;if(from<0){from+=this.length}var ret=new Yallist;if(to<from||to<0){return ret}if(from<0){from=0}if(to>this.length){to=this.length}for(var i=0,walker=this.head;walker!==null&&i<from;i++){walker=walker.next}for(;walker!==null&&i<to;i++,walker=walker.next){ret.push(walker.value)}return ret};Yallist.prototype.sliceReverse=function(from,to){to=to||this.length;if(to<0){to+=this.length}from=from||0;if(from<0){from+=this.length}var ret=new Yallist;if(to<from||to<0){return ret}if(from<0){from=0}if(to>this.length){to=this.length}for(var i=this.length,walker=this.tail;walker!==null&&i>to;i--){walker=walker.prev}for(;walker!==null&&i>from;i--,walker=walker.prev){ret.push(walker.value)}return ret};Yallist.prototype.reverse=function(){var head=this.head;var tail=this.tail;for(var walker=head;walker!==null;walker=walker.prev){var p=walker.prev;walker.prev=walker.next;walker.next=p}this.head=tail;this.tail=head;return this};function push(self,item){self.tail=new Node(item,self.tail,null,self);if(!self.head){self.head=self.tail}self.length++}function unshift(self,item){self.head=new Node(item,null,self.head,self);if(!self.tail){self.tail=self.head}self.length++}function Node(value,prev,next,list){if(!(this instanceof Node)){return new Node(value,prev,next,list)}this.list=list;this.value=value;if(prev){prev.next=this;this.prev=prev}else{this.prev=null}if(next){next.prev=this;this.next=next}else{this.next=null}}var lruCache=LRUCache;var symbols={};var hasSymbol=typeof Symbol==="function";var makeSymbol;if(hasSymbol){makeSymbol=function(key){return Symbol.for(key)}}else{makeSymbol=function(key){return"_"+key}}function priv(obj,key,val){var sym;if(symbols[key]){sym=symbols[key]}else{sym=makeSymbol(key);symbols[key]=sym}if(arguments.length===2){return obj[sym]}else{obj[sym]=val;return val}}function naiveLength(){return 1}function LRUCache(options){if(!(this instanceof LRUCache)){return new LRUCache(options)}if(typeof options==="number"){options={max:options}}if(!options){options={}}var max=priv(this,"max",options.max);if(!max||!(typeof max==="number")||max<=0){priv(this,"max",Infinity)}var lc=options.length||naiveLength;if(typeof lc!=="function"){lc=naiveLength}priv(this,"lengthCalculator",lc);priv(this,"allowStale",options.stale||false);priv(this,"maxAge",options.maxAge||0);priv(this,"dispose",options.dispose);this.reset()}Object.defineProperty(LRUCache.prototype,"max",{set:function(mL){if(!mL||!(typeof mL==="number")||mL<=0){mL=Infinity}priv(this,"max",mL);trim(this)},get:function(){return priv(this,"max")},enumerable:true});Object.defineProperty(LRUCache.prototype,"allowStale",{set:function(allowStale){priv(this,"allowStale",!!allowStale)},get:function(){return priv(this,"allowStale")},enumerable:true});Object.defineProperty(LRUCache.prototype,"maxAge",{set:function(mA){if(!mA||!(typeof mA==="number")||mA<0){mA=0}priv(this,"maxAge",mA);trim(this)},get:function(){return priv(this,"maxAge")},enumerable:true});Object.defineProperty(LRUCache.prototype,"lengthCalculator",{set:function(lC){if(typeof lC!=="function"){lC=naiveLength}if(lC!==priv(this,"lengthCalculator")){priv(this,"lengthCalculator",lC);priv(this,"length",0);priv(this,"lruList").forEach(function(hit){hit.length=priv(this,"lengthCalculator").call(this,hit.value,hit.key);priv(this,"length",priv(this,"length")+hit.length)},this)}trim(this)},get:function(){return priv(this,"lengthCalculator")},enumerable:true});Object.defineProperty(LRUCache.prototype,"length",{get:function(){return priv(this,"length")},enumerable:true});Object.defineProperty(LRUCache.prototype,"itemCount",{get:function(){return priv(this,"lruList").length},enumerable:true});LRUCache.prototype.rforEach=function(fn,thisp){thisp=thisp||this;for(var walker=priv(this,"lruList").tail;walker!==null;){var prev=walker.prev;forEachStep(this,fn,walker,thisp);walker=prev}};function forEachStep(self,fn,node,thisp){var hit=node.value;if(isStale(self,hit)){del(self,node);if(!priv(self,"allowStale")){hit=undefined}}if(hit){fn.call(thisp,hit.value,hit.key,self)}}LRUCache.prototype.forEach=function(fn,thisp){thisp=thisp||this;for(var walker=priv(this,"lruList").head;walker!==null;){var next=walker.next;forEachStep(this,fn,walker,thisp);walker=next}};LRUCache.prototype.keys=function(){return priv(this,"lruList").toArray().map(function(k){return k.key},this)};LRUCache.prototype.values=function(){return priv(this,"lruList").toArray().map(function(k){return k.value},this)};LRUCache.prototype.reset=function(){if(priv(this,"dispose")&&priv(this,"lruList")&&priv(this,"lruList").length){priv(this,"lruList").forEach(function(hit){priv(this,"dispose").call(this,hit.key,hit.value)},this)}priv(this,"cache",new map);priv(this,"lruList",new yallist);priv(this,"length",0)};LRUCache.prototype.dump=function(){return priv(this,"lruList").map(function(hit){if(!isStale(this,hit)){return{k:hit.key,v:hit.value,e:hit.now+(hit.maxAge||0)}}},this).toArray().filter(function(h){return h})};LRUCache.prototype.dumpLru=function(){return priv(this,"lruList")};LRUCache.prototype.inspect=function(n,opts){var str="LRUCache {";var extras=false;var as=priv(this,"allowStale");if(as){str+="\n  allowStale: true";extras=true}var max=priv(this,"max");if(max&&max!==Infinity){if(extras){str+=","}str+="\n  max: "+require$$0.inspect(max,opts);extras=true}var maxAge=priv(this,"maxAge");if(maxAge){if(extras){str+=","}str+="\n  maxAge: "+require$$0.inspect(maxAge,opts);extras=true}var lc=priv(this,"lengthCalculator");if(lc&&lc!==naiveLength){if(extras){str+=","}str+="\n  length: "+require$$0.inspect(priv(this,"length"),opts);extras=true}var didFirst=false;priv(this,"lruList").forEach(function(item){if(didFirst){str+=",\n  "}else{if(extras){str+=",\n"}didFirst=true;str+="\n  "}var key=require$$0.inspect(item.key).split("\n").join("\n  ");var val={value:item.value};if(item.maxAge!==maxAge){val.maxAge=item.maxAge}if(lc!==naiveLength){val.length=item.length}if(isStale(this,item)){val.stale=true}val=require$$0.inspect(val,opts).split("\n").join("\n  ");str+=key+" => "+val});if(didFirst||extras){str+="\n"}str+="}";return str};LRUCache.prototype.set=function(key,value,maxAge){maxAge=maxAge||priv(this,"maxAge");var now=maxAge?Date.now():0;var len=priv(this,"lengthCalculator").call(this,value,key);if(priv(this,"cache").has(key)){if(len>priv(this,"max")){del(this,priv(this,"cache").get(key));return false}var node=priv(this,"cache").get(key);var item=node.value;if(priv(this,"dispose")){priv(this,"dispose").call(this,key,item.value)}item.now=now;item.maxAge=maxAge;item.value=value;priv(this,"length",priv(this,"length")+(len-item.length));item.length=len;this.get(key);trim(this);return true}var hit=new Entry(key,value,len,now,maxAge);if(hit.length>priv(this,"max")){if(priv(this,"dispose")){priv(this,"dispose").call(this,key,value)}return false}priv(this,"length",priv(this,"length")+hit.length);priv(this,"lruList").unshift(hit);priv(this,"cache").set(key,priv(this,"lruList").head);trim(this);return true};LRUCache.prototype.has=function(key){if(!priv(this,"cache").has(key))return false;var hit=priv(this,"cache").get(key).value;if(isStale(this,hit)){return false}return true};LRUCache.prototype.get=function(key){return get$2(this,key,true)};LRUCache.prototype.peek=function(key){return get$2(this,key,false)};LRUCache.prototype.pop=function(){var node=priv(this,"lruList").tail;if(!node)return null;del(this,node);return node.value};LRUCache.prototype.del=function(key){del(this,priv(this,"cache").get(key))};LRUCache.prototype.load=function(arr){this.reset();var now=Date.now();for(var l=arr.length-1;l>=0;l--){var hit=arr[l];var expiresAt=hit.e||0;if(expiresAt===0){this.set(hit.k,hit.v)}else{var maxAge=expiresAt-now;if(maxAge>0){this.set(hit.k,hit.v,maxAge)}}}};LRUCache.prototype.prune=function(){var self=this;priv(this,"cache").forEach(function(value,key){get$2(self,key,false)})};function get$2(self,key,doUse){var node=priv(self,"cache").get(key);if(node){var hit=node.value;if(isStale(self,hit)){del(self,node);if(!priv(self,"allowStale"))hit=undefined}else{if(doUse){priv(self,"lruList").unshiftNode(node)}}if(hit)hit=hit.value}return hit}function isStale(self,hit){if(!hit||!hit.maxAge&&!priv(self,"maxAge")){return false}var stale=false;var diff=Date.now()-hit.now;if(hit.maxAge){stale=diff>hit.maxAge}else{stale=priv(self,"maxAge")&&diff>priv(self,"maxAge")}return stale}function trim(self){if(priv(self,"length")>priv(self,"max")){for(var walker=priv(self,"lruList").tail;priv(self,"length")>priv(self,"max")&&walker!==null;){var prev=walker.prev;del(self,walker);walker=prev}}}function del(self,node){if(node){var hit=node.value;if(priv(self,"dispose")){priv(self,"dispose").call(this,hit.key,hit.value)}priv(self,"length",priv(self,"length")-hit.length);priv(self,"cache").delete(hit.key);priv(self,"lruList").removeNode(node)}}function Entry(key,value,length,now,maxAge){this.key=key;this.value=value;this.length=length;this.now=now;this.maxAge=maxAge||0}var ac=AsyncCache;function AsyncCache(opt){if(!opt||typeof opt!=="object"){throw new Error("options must be an object")}if(!opt.load){throw new Error("load function is required")}if(!(this instanceof AsyncCache)){return new AsyncCache(opt)}this._opt=opt;this._cache=new lruCache(opt);this._load=opt.load;this._loading={};this._stales={};this._allowStale=opt.stale}Object.defineProperty(AsyncCache.prototype,"itemCount",{get:function(){return this._cache.itemCount},enumerable:true,configurable:true});AsyncCache.prototype.get=function(key,cb){var stale=this._stales[key];if(this._allowStale&&stale!==undefined){return process.nextTick(function(){cb(null,stale)})}if(this._loading[key]){return this._loading[key].push(cb)}var has=this._cache.has(key);var cached=this._cache.get(key);if(has&&undefined!==cached){return process.nextTick(function(){cb(null,cached)})}if(undefined!==cached&&this._allowStale&&!has){this._stales[key]=cached;process.nextTick(function(){cb(null,cached)})}else{this._loading[key]=[cb]}this._load(key,function(er,res,maxAge){if(!er){this._cache.set(key,res,maxAge)}if(this._allowStale){delete this._stales[key]}var cbs=this._loading[key];if(!cbs){return}delete this._loading[key];cbs.forEach(function(cb){cb(er,res)})}.bind(this))};AsyncCache.prototype.keys=function(){return this._cache.keys()};AsyncCache.prototype.set=function(key,val,maxAge){return this._cache.set(key,val,maxAge)};AsyncCache.prototype.reset=function(){return this._cache.reset()};AsyncCache.prototype.has=function(key){return this._cache.has(key)};AsyncCache.prototype.del=function(key){return this._cache.del(key)};AsyncCache.prototype.peek=function(key){return this._cache.peek(key)};var asyncCache=createCommonjsModule(function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});Symbol.asyncIterator=Symbol.for("asyncIterator");exports.default=(options=>{const cache=ac(Object.assign({},options,{load:(key,cb)=>{options.load(key).then(result=>cb(null,result)).catch(cb)}}));const get=key=>new Promise((resolve,reject)=>cache.get(key,(error,result)=>{if(error){return reject(error)}resolve(result)}));return{get:get}})});var error$1=createCommonjsModule(function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});class CodedError extends Error{constructor(code,message){super(message);this.code=code}}exports.CodedError=CodedError});var crypto$1=crypto&&crypto__default||crypto;var rb=crypto$1.randomBytes;function rng(){return rb(16)}var rng_1=rng;var byteToHex=[];for(var i=0;i<256;++i){byteToHex[i]=(i+256).toString(16).substr(1)}function bytesToUuid(buf,offset){var i=offset||0;var bth=byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}var bytesToUuid_1=bytesToUuid;var _seedBytes=rng_1();var _nodeId=[_seedBytes[0]|1,_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]];var _clockseq=(_seedBytes[6]<<8|_seedBytes[7])&16383;var _lastMSecs=0;var _lastNSecs=0;function v1(options,buf,offset){var i=buf&&offset||0;var b=buf||[];options=options||{};var clockseq=options.clockseq!==undefined?options.clockseq:_clockseq;var msecs=options.msecs!==undefined?options.msecs:(new Date).getTime();var nsecs=options.nsecs!==undefined?options.nsecs:_lastNSecs+1;var dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&options.clockseq===undefined){clockseq=clockseq+1&16383}if((dt<0||msecs>_lastMSecs)&&options.nsecs===undefined){nsecs=0}if(nsecs>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}_lastMSecs=msecs;_lastNSecs=nsecs;_clockseq=clockseq;msecs+=122192928e5;var tl=((msecs&268435455)*1e4+nsecs)%4294967296;b[i++]=tl>>>24&255;b[i++]=tl>>>16&255;b[i++]=tl>>>8&255;b[i++]=tl&255;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255;b[i++]=tmh&255;b[i++]=tmh>>>24&15|16;b[i++]=tmh>>>16&255;b[i++]=clockseq>>>8|128;b[i++]=clockseq&255;var node=options.node||_nodeId;for(var n=0;n<6;++n){b[i+n]=node[n]}return buf?buf:bytesToUuid_1(b)}var v1_1=v1;function v4(options,buf,offset){var i=buf&&offset||0;if(typeof options=="string"){buf=options=="binary"?new Array(16):null;options=null}options=options||{};var rnds=options.random||(options.rng||rng_1)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){for(var ii=0;ii<16;++ii){buf[i+ii]=rnds[ii]}}return buf||bytesToUuid_1(rnds)}var v4_1=v4;var uuid=v4_1;uuid.v1=v1_1;uuid.v4=v4_1;var index$18=uuid;var assertString_1=createCommonjsModule(function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=assertString;function assertString(input){if(typeof input!=="string"){throw new TypeError("This library (validator.js) validates strings only")}}module.exports=exports["default"]});var isUUID_1=createCommonjsModule(function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=isUUID;var _assertString2=_interopRequireDefault(assertString_1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var uuid={3:/^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,4:/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,5:/^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,all:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i};function isUUID(str){var version=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"all";(0,_assertString2.default)(str);var pattern=uuid[version];return pattern&&pattern.test(str)}module.exports=exports["default"]});var key=createCommonjsModule(function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const createKey=({service:service,correlationKey:correlationKey=index$18.v4(),tags:tags={}})=>{return{__IS__A__KEY__:void 0,service:service,correlationKey:correlationKey,tags:tags}};exports.createUserKey=(({userId:userId,correlationKey:correlationKey})=>{if(!isUUID_1(userId)){throw new Error(`Invalid userId specified ${userId}`)}return createKey({service:"user",correlationKey:correlationKey,tags:{userId:userId}})});exports.createAuthenticationKey=(()=>{const key=createKey({service:"auth"});return Object.assign({},key,{setUserId(userId){const{correlationKey:correlationKey}=key;return exports.createUserKey({userId:userId,correlationKey:correlationKey})}})});exports.createServiceKey=(({service:service})=>{return createKey({service:service})});exports.tagKey=((key,tags)=>{return createKey(Object.assign({},key,{tags:Object.assign({},key.tags,tags)}))})});var log_1=createCommonjsModule(function(module,exports){"use strict";var __rest=commonjsGlobal&&commonjsGlobal.__rest||function(s,e){var t={};for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0)t[p]=s[p];if(s!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)if(e.indexOf(p[i])<0)t[p[i]]=s[p[i]];return t};Object.defineProperty(exports,"__esModule",{value:true});const replacer=(_key,value)=>{if(value instanceof Error){const{message:message,stack:stack}=value,rest=__rest(value,["message","stack"]);return Object.assign({message:message,stack:stack},rest)}return value};const log=(level,key,message,...args)=>{const output=Object.assign({},key,{time:(new Date).toISOString(),lvl:level,msg:message,args:args});const json=JSON.stringify(output,replacer);console.log(json)};exports.debug=((key,message,...args)=>{log("DEBUG",key,message,args)});exports.info=((key,message,...args)=>{log("INFO",key,message,args)});exports.warn=((key,message,...args)=>{log("WARN",key,message,args)});exports.error=((key,message,...args)=>{log("ERROR",key,message,args)})});var padString_1=createCommonjsModule(function(module,exports){"use strict";function padString(input){var segmentLength=4;var stringLength=input.length;var diff=stringLength%segmentLength;if(!diff){return input}var position=stringLength;var padLength=segmentLength-diff;var paddedStringLength=stringLength+padLength;var buffer$$1=new Buffer(paddedStringLength);buffer$$1.write(input);while(padLength--){buffer$$1.write("=",position++)}return buffer$$1.toString()}Object.defineProperty(exports,"__esModule",{value:true});exports.default=padString});var base64url_1=createCommonjsModule(function(module,exports){"use strict";function encode(input,encoding){if(encoding===void 0){encoding="utf8"}if(Buffer.isBuffer(input)){return fromBase64(input.toString("base64"))}return fromBase64(new Buffer(input,encoding).toString("base64"))}function decode(base64url,encoding){if(encoding===void 0){encoding="utf8"}return new Buffer(toBase64(base64url),"base64").toString(encoding)}function toBase64(base64url){base64url=base64url.toString();return padString_1.default(base64url).replace(/\-/g,"+").replace(/_/g,"/")}function fromBase64(base64){return base64.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function toBuffer(base64url){return new Buffer(toBase64(base64url),"base64")}var base64url=encode;base64url.encode=encode;base64url.decode=decode;base64url.toBase64=toBase64;base64url.fromBase64=fromBase64;base64url.toBuffer=toBuffer;Object.defineProperty(exports,"__esModule",{value:true});exports.default=base64url});var index$24=createCommonjsModule(function(module){module.exports=base64url_1.default;module.exports.default=module.exports});var require$$0$5=buffer&&buffer__default||buffer;var index$26=createCommonjsModule(function(module,exports){if(Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow){module.exports=require$$0$5}else{Object.keys(require$$0$5).forEach(function(prop){exports[prop]=require$$0$5[prop]});exports.Buffer=SafeBuffer}function SafeBuffer(arg,encodingOrOffset,length){return Buffer(arg,encodingOrOffset,length)}Object.keys(Buffer).forEach(function(prop){SafeBuffer[prop]=Buffer[prop]});SafeBuffer.from=function(arg,encodingOrOffset,length){if(typeof arg==="number"){throw new TypeError("Argument must not be a number")}return Buffer(arg,encodingOrOffset,length)};SafeBuffer.alloc=function(size,fill,encoding){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}var buf=Buffer(size);if(fill!==undefined){if(typeof encoding==="string"){buf.fill(fill,encoding)}else{buf.fill(fill)}}else{buf.fill(0)}return buf};SafeBuffer.allocUnsafe=function(size){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}return Buffer(size)};SafeBuffer.allocUnsafeSlow=function(size){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}return require$$0$5.SlowBuffer(size)}});var Buffer$1=index$26.Buffer;function DataStream(data){this.buffer=null;this.writable=true;this.readable=true;if(!data){this.buffer=Buffer$1.alloc(0);return this}if(typeof data.pipe==="function"){this.buffer=Buffer$1.alloc(0);data.pipe(this);return this}if(data.length||typeof data==="object"){this.buffer=data;this.writable=false;process.nextTick(function(){this.emit("end",data);this.readable=false;this.emit("close")}.bind(this));return this}throw new TypeError("Unexpected data type ("+typeof data+")")}require$$0.inherits(DataStream,require$$1);DataStream.prototype.write=function write(data){this.buffer=Buffer$1.concat([this.buffer,Buffer$1.from(data)]);this.emit("data",data)};DataStream.prototype.end=function end(data){if(data)this.write(data);this.emit("end",data);this.emit("close");this.writable=false;this.readable=false};var dataStream=DataStream;var Buffer$3=require$$0$5.Buffer;var SlowBuffer=require$$0$5.SlowBuffer;var index$30=bufferEq;function bufferEq(a,b){if(!Buffer$3.isBuffer(a)||!Buffer$3.isBuffer(b)){return false}if(a.length!==b.length){return false}var c=0;for(var i=0;i<a.length;i++){c|=a[i]^b[i]}return c===0}bufferEq.install=function(){Buffer$3.prototype.equal=SlowBuffer.prototype.equal=function equal(that){return bufferEq(this,that)}};var origBufEqual=Buffer$3.prototype.equal;var origSlowBufEqual=SlowBuffer.prototype.equal;bufferEq.restore=function(){Buffer$3.prototype.equal=origBufEqual;SlowBuffer.prototype.equal=origSlowBufEqual};function getParamSize(keySize){var result=(keySize/8|0)+(keySize%8===0?0:1);return result}var paramBytesForAlg={ES256:getParamSize(256),ES384:getParamSize(384),ES512:getParamSize(521)};function getParamBytesForAlg(alg){var paramBytes=paramBytesForAlg[alg];if(paramBytes){return paramBytes}throw new Error('Unknown algorithm "'+alg+'"')}var paramBytesForAlg_1=getParamBytesForAlg;var base64Url=index$24.fromBase64;var Buffer$4=index$26.Buffer;var MAX_OCTET=128;var CLASS_UNIVERSAL=0;var PRIMITIVE_BIT=32;var TAG_SEQ=16;var TAG_INT=2;var ENCODED_TAG_SEQ=TAG_SEQ|PRIMITIVE_BIT|CLASS_UNIVERSAL<<6;var ENCODED_TAG_INT=TAG_INT|CLASS_UNIVERSAL<<6;function signatureAsBuffer(signature){if(Buffer$4.isBuffer(signature)){return signature}else if("string"===typeof signature){return Buffer$4.from(signature,"base64")}throw new TypeError("ECDSA signature must be a Base64 string or a Buffer")}function derToJose(signature,alg){signature=signatureAsBuffer(signature);var paramBytes=paramBytesForAlg_1(alg);var maxEncodedParamLength=paramBytes+1;var inputLength=signature.length;var offset=0;if(signature[offset++]!==ENCODED_TAG_SEQ){throw new Error('Could not find expected "seq"')}var seqLength=signature[offset++];if(seqLength===(MAX_OCTET|1)){seqLength=signature[offset++]}if(inputLength-offset<seqLength){throw new Error('"seq" specified length of "'+seqLength+'", only "'+(inputLength-offset)+'" remaining')}if(signature[offset++]!==ENCODED_TAG_INT){throw new Error('Could not find expected "int" for "r"')}var rLength=signature[offset++];if(inputLength-offset-2<rLength){throw new Error('"r" specified length of "'+rLength+'", only "'+(inputLength-offset-2)+'" available')}if(maxEncodedParamLength<rLength){throw new Error('"r" specified length of "'+rLength+'", max of "'+maxEncodedParamLength+'" is acceptable')}var rOffset=offset;offset+=rLength;if(signature[offset++]!==ENCODED_TAG_INT){throw new Error('Could not find expected "int" for "s"')}var sLength=signature[offset++];if(inputLength-offset!==sLength){throw new Error('"s" specified length of "'+sLength+'", expected "'+(inputLength-offset)+'"')}if(maxEncodedParamLength<sLength){throw new Error('"s" specified length of "'+sLength+'", max of "'+maxEncodedParamLength+'" is acceptable')}var sOffset=offset;offset+=sLength;if(offset!==inputLength){throw new Error('Expected to consume entire buffer, but "'+(inputLength-offset)+'" bytes remain')}var rPadding=paramBytes-rLength,sPadding=paramBytes-sLength;var dst=Buffer$4.allocUnsafe(rPadding+rLength+sPadding+sLength);for(offset=0;offset<rPadding;++offset){dst[offset]=0}signature.copy(dst,offset,rOffset+Math.max(-rPadding,0),rOffset+rLength);offset=paramBytes;for(var o=offset;offset<o+sPadding;++offset){dst[offset]=0}signature.copy(dst,offset,sOffset+Math.max(-sPadding,0),sOffset+sLength);dst=dst.toString("base64");dst=base64Url(dst);return dst}function countPadding(buf,start,stop){var padding=0;while(start+padding<stop&&buf[start+padding]===0){++padding}var needsSign=buf[start+padding]>=MAX_OCTET;if(needsSign){--padding}return padding}function joseToDer(signature,alg){signature=signatureAsBuffer(signature);var paramBytes=paramBytesForAlg_1(alg);var signatureBytes=signature.length;if(signatureBytes!==paramBytes*2){throw new TypeError('"'+alg+'" signatures must be "'+paramBytes*2+'" bytes, saw "'+signatureBytes+'"')}var rPadding=countPadding(signature,0,paramBytes);var sPadding=countPadding(signature,paramBytes,signature.length);var rLength=paramBytes-rPadding;var sLength=paramBytes-sPadding;var rsBytes=1+1+rLength+1+1+sLength;var shortLength=rsBytes<MAX_OCTET;var dst=Buffer$4.allocUnsafe((shortLength?2:3)+rsBytes);var offset=0;dst[offset++]=ENCODED_TAG_SEQ;if(shortLength){dst[offset++]=rsBytes}else{dst[offset++]=MAX_OCTET|1;dst[offset++]=rsBytes&255}dst[offset++]=ENCODED_TAG_INT;dst[offset++]=rLength;if(rPadding<0){dst[offset++]=0;offset+=signature.copy(dst,offset,0,paramBytes)}else{offset+=signature.copy(dst,offset,rPadding,paramBytes)}dst[offset++]=ENCODED_TAG_INT;dst[offset++]=sLength;if(sPadding<0){dst[offset++]=0;signature.copy(dst,offset,paramBytes)}else{signature.copy(dst,offset,paramBytes+sPadding)}return dst}var ecdsaSigFormatter={derToJose:derToJose,joseToDer:joseToDer};var Buffer$2=index$26.Buffer;var MSG_INVALID_ALGORITHM='"%s" is not a valid algorithm.\n  Supported algorithms are:\n  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512" and "none".';var MSG_INVALID_SECRET="secret must be a string or buffer";var MSG_INVALID_VERIFIER_KEY="key must be a string or a buffer";var MSG_INVALID_SIGNER_KEY="key must be a string, a buffer or an object";function typeError(template){var args=[].slice.call(arguments,1);var errMsg=require$$0.format.bind(require$$0,template).apply(null,args);return new TypeError(errMsg)}function bufferOrString(obj){return Buffer$2.isBuffer(obj)||typeof obj==="string"}function normalizeInput(thing){if(!bufferOrString(thing))thing=JSON.stringify(thing);return thing}function createHmacSigner(bits){return function sign(thing,secret){if(!bufferOrString(secret))throw typeError(MSG_INVALID_SECRET);thing=normalizeInput(thing);var hmac=crypto$1.createHmac("sha"+bits,secret);var sig=(hmac.update(thing),hmac.digest("base64"));return index$24.fromBase64(sig)}}function createHmacVerifier(bits){return function verify(thing,signature,secret){var computedSig=createHmacSigner(bits)(thing,secret);return index$30(Buffer$2.from(signature),Buffer$2.from(computedSig))}}function createKeySigner(bits){return function sign(thing,privateKey){if(!bufferOrString(privateKey)&&!(typeof privateKey==="object"))throw typeError(MSG_INVALID_SIGNER_KEY);thing=normalizeInput(thing);var signer=crypto$1.createSign("RSA-SHA"+bits);var sig=(signer.update(thing),signer.sign(privateKey,"base64"));return index$24.fromBase64(sig)}}function createKeyVerifier(bits){return function verify(thing,signature,publicKey){if(!bufferOrString(publicKey))throw typeError(MSG_INVALID_VERIFIER_KEY);thing=normalizeInput(thing);signature=index$24.toBase64(signature);var verifier=crypto$1.createVerify("RSA-SHA"+bits);verifier.update(thing);return verifier.verify(publicKey,signature,"base64")}}function createECDSASigner(bits){var inner=createKeySigner(bits);return function sign(){var signature=inner.apply(null,arguments);signature=ecdsaSigFormatter.derToJose(signature,"ES"+bits);return signature}}function createECDSAVerifer(bits){var inner=createKeyVerifier(bits);return function verify(thing,signature,publicKey){signature=ecdsaSigFormatter.joseToDer(signature,"ES"+bits).toString("base64");var result=inner(thing,signature,publicKey);return result}}function createNoneSigner(){return function sign(){return""}}function createNoneVerifier(){return function verify(thing,signature){return signature===""}}var index$28=function jwa(algorithm){var signerFactories={hs:createHmacSigner,rs:createKeySigner,es:createECDSASigner,none:createNoneSigner};var verifierFactories={hs:createHmacVerifier,rs:createKeyVerifier,es:createECDSAVerifer,none:createNoneVerifier};var match=algorithm.match(/^(RS|ES|HS)(256|384|512)$|^(none)$/i);if(!match)throw typeError(MSG_INVALID_ALGORITHM,algorithm);var algo=(match[1]||match[3]).toLowerCase();var bits=match[2];return{sign:signerFactories[algo](bits),verify:verifierFactories[algo](bits)}};var Buffer$5=require$$0$5.Buffer;var tostring=function toString(obj){if(typeof obj==="string")return obj;if(typeof obj==="number"||Buffer$5.isBuffer(obj))return obj.toString();return JSON.stringify(obj)};function jwsSecuredInput(header,payload,encoding){encoding=encoding||"utf8";var encodedHeader=index$24(tostring(header),"binary");var encodedPayload=index$24(tostring(payload),encoding);return require$$0.format("%s.%s",encodedHeader,encodedPayload)}function jwsSign(opts){var header=opts.header;var payload=opts.payload;var secretOrKey=opts.secret||opts.privateKey;var encoding=opts.encoding;var algo=index$28(header.alg);var securedInput=jwsSecuredInput(header,payload,encoding);var signature=algo.sign(securedInput,secretOrKey);return require$$0.format("%s.%s",securedInput,signature)}function SignStream(opts){var secret=opts.secret||opts.privateKey||opts.key;var secretStream=new dataStream(secret);this.readable=true;this.header=opts.header;this.encoding=opts.encoding;this.secret=this.privateKey=this.key=secretStream;this.payload=new dataStream(opts.payload);this.secret.once("close",function(){if(!this.payload.writable&&this.readable)this.sign()}.bind(this));this.payload.once("close",function(){if(!this.secret.writable&&this.readable)this.sign()}.bind(this))}require$$0.inherits(SignStream,require$$1);SignStream.prototype.sign=function sign(){try{var signature=jwsSign({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});this.emit("done",signature);this.emit("data",signature);this.emit("end");this.readable=false;return signature}catch(e){this.readable=false;this.emit("error",e);this.emit("close")}};SignStream.sign=jwsSign;var signStream=SignStream;var JWS_REGEX=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function isObject$1(thing){return Object.prototype.toString.call(thing)==="[object Object]"}function safeJsonParse(thing){if(isObject$1(thing))return thing;try{return JSON.parse(thing)}catch(e){return undefined}}function headerFromJWS(jwsSig){var encodedHeader=jwsSig.split(".",1)[0];return safeJsonParse(index$24.decode(encodedHeader,"binary"))}function securedInputFromJWS(jwsSig){return jwsSig.split(".",2).join(".")}function signatureFromJWS(jwsSig){return jwsSig.split(".")[2]}function payloadFromJWS(jwsSig,encoding){encoding=encoding||"utf8";var payload=jwsSig.split(".")[1];return index$24.decode(payload,encoding)}function isValidJws(string){return JWS_REGEX.test(string)&&!!headerFromJWS(string)}function jwsVerify(jwsSig,algorithm,secretOrKey){if(!algorithm){var err=new Error("Missing algorithm parameter for jws.verify");err.code="MISSING_ALGORITHM";throw err}jwsSig=tostring(jwsSig);var signature=signatureFromJWS(jwsSig);var securedInput=securedInputFromJWS(jwsSig);var algo=index$28(algorithm);return algo.verify(securedInput,signature,secretOrKey)}function jwsDecode(jwsSig,opts){opts=opts||{};jwsSig=tostring(jwsSig);if(!isValidJws(jwsSig))return null;var header=headerFromJWS(jwsSig);if(!header)return null;var payload=payloadFromJWS(jwsSig);if(header.typ==="JWT"||opts.json)payload=JSON.parse(payload,opts.encoding);return{header:header,payload:payload,signature:signatureFromJWS(jwsSig)}}function VerifyStream(opts){opts=opts||{};var secretOrKey=opts.secret||opts.publicKey||opts.key;var secretStream=new dataStream(secretOrKey);this.readable=true;this.algorithm=opts.algorithm;this.encoding=opts.encoding;this.secret=this.publicKey=this.key=secretStream;this.signature=new dataStream(opts.signature);this.secret.once("close",function(){if(!this.signature.writable&&this.readable)this.verify()}.bind(this));this.signature.once("close",function(){if(!this.secret.writable&&this.readable)this.verify()}.bind(this))}require$$0.inherits(VerifyStream,require$$1);VerifyStream.prototype.verify=function verify(){try{var valid=jwsVerify(this.signature.buffer,this.algorithm,this.key.buffer);var obj=jwsDecode(this.signature.buffer,this.encoding);this.emit("done",valid,obj);this.emit("data",valid);this.emit("end");this.readable=false;return valid}catch(e){this.readable=false;this.emit("error",e);this.emit("close")}};VerifyStream.decode=jwsDecode;VerifyStream.isValid=isValidJws;VerifyStream.verify=jwsVerify;var verifyStream=VerifyStream;var ALGORITHMS=["HS256","HS384","HS512","RS256","RS384","RS512","ES256","ES384","ES512"];var ALGORITHMS_1=ALGORITHMS;var sign=signStream.sign;var verify=verifyStream.verify;var decode$2=verifyStream.decode;var isValid=verifyStream.isValid;var createSign=function createSign(opts){return new signStream(opts)};var createVerify=function createVerify(opts){return new verifyStream(opts)};var index$22={ALGORITHMS:ALGORITHMS_1,sign:sign,verify:verify,decode:decode$2,isValid:isValid,createSign:createSign,createVerify:createVerify};var decode=function(jwt,options){options=options||{};var decoded=index$22.decode(jwt,options);if(!decoded){return null}var payload=decoded.payload;if(typeof payload==="string"){try{var obj=JSON.parse(payload);if(typeof obj==="object"){payload=obj}}catch(e){}}if(options.complete===true){return{header:decoded.header,payload:payload,signature:decoded.signature}}return payload};var JsonWebTokenError=function(message,error){Error.call(this,message);Error.captureStackTrace(this,this.constructor);this.name="JsonWebTokenError";this.message=message;if(error)this.inner=error};JsonWebTokenError.prototype=Object.create(Error.prototype);JsonWebTokenError.prototype.constructor=JsonWebTokenError;var JsonWebTokenError_1=JsonWebTokenError;var NotBeforeError=function(message,date){JsonWebTokenError_1.call(this,message);this.name="NotBeforeError";this.date=date};NotBeforeError.prototype=Object.create(JsonWebTokenError_1.prototype);NotBeforeError.prototype.constructor=NotBeforeError;var NotBeforeError_1=NotBeforeError;var TokenExpiredError=function(message,expiredAt){JsonWebTokenError_1.call(this,message);this.name="TokenExpiredError";this.expiredAt=expiredAt};TokenExpiredError.prototype=Object.create(JsonWebTokenError_1.prototype);TokenExpiredError.prototype.constructor=TokenExpiredError;var TokenExpiredError_1=TokenExpiredError;var s$1=1e3;var m$1=s$1*60;var h$1=m$1*60;var d$1=h$1*24;var y$1=d$1*365.25;var index$32=function(val,options){options=options||{};var type=typeof val;if(type==="string"&&val.length>0){return parse$2(val)}else if(type==="number"&&isNaN(val)===false){return options.long?fmtLong$1(val):fmtShort$1(val)}throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(val))};function parse$2(str){str=String(str);if(str.length>1e4){return}var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match){return}var n=parseFloat(match[1]);var type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"yrs":case"yr":case"y":return n*y$1;case"days":case"day":case"d":return n*d$1;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h$1;case"minutes":case"minute":case"mins":case"min":case"m":return n*m$1;case"seconds":case"second":case"secs":case"sec":case"s":return n*s$1;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return undefined}}function fmtShort$1(ms){if(ms>=d$1){return Math.round(ms/d$1)+"d"}if(ms>=h$1){return Math.round(ms/h$1)+"h"}if(ms>=m$1){return Math.round(ms/m$1)+"m"}if(ms>=s$1){return Math.round(ms/s$1)+"s"}return ms+"ms"}function fmtLong$1(ms){return plural$1(ms,d$1,"day")||plural$1(ms,h$1,"hour")||plural$1(ms,m$1,"minute")||plural$1(ms,s$1,"second")||ms+" ms"}function plural$1(ms,n,name){if(ms<n){return}if(ms<n*1.5){return Math.floor(ms/n)+" "+name}return Math.ceil(ms/n)+" "+name+"s"}var immutable=extend;var hasOwnProperty$2=Object.prototype.hasOwnProperty;function extend(){var target={};for(var i=0;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(hasOwnProperty$2.call(source,key)){target[key]=source[key]}}}return target}var verify$1=function(jwtString,secretOrPublicKey,options,callback){if(typeof options==="function"&&!callback){callback=options;options={}}if(!options){options={}}options=immutable(options);var done;if(callback){done=function(){var args=Array.prototype.slice.call(arguments,0);return process.nextTick(function(){callback.apply(null,args)})}}else{done=function(err,data){if(err)throw err;return data}}if(options.clockTimestamp&&typeof options.clockTimestamp!=="number"){return done(new JsonWebTokenError_1("clockTimestamp must be a number"))}var clockTimestamp=options.clockTimestamp||Math.floor(Date.now()/1e3);if(!jwtString){return done(new JsonWebTokenError_1("jwt must be provided"))}if(typeof jwtString!=="string"){return done(new JsonWebTokenError_1("jwt must be a string"))}var parts=jwtString.split(".");if(parts.length!==3){return done(new JsonWebTokenError_1("jwt malformed"))}var hasSignature=parts[2].trim()!=="";if(!hasSignature&&secretOrPublicKey){return done(new JsonWebTokenError_1("jwt signature is required"))}if(hasSignature&&!secretOrPublicKey){return done(new JsonWebTokenError_1("secret or public key must be provided"))}if(!hasSignature&&!options.algorithms){options.algorithms=["none"]}if(!options.algorithms){options.algorithms=~secretOrPublicKey.toString().indexOf("BEGIN CERTIFICATE")||~secretOrPublicKey.toString().indexOf("BEGIN PUBLIC KEY")?["RS256","RS384","RS512","ES256","ES384","ES512"]:~secretOrPublicKey.toString().indexOf("BEGIN RSA PUBLIC KEY")?["RS256","RS384","RS512"]:["HS256","HS384","HS512"]}var decodedToken;try{decodedToken=index$22.decode(jwtString)}catch(err){return done(err)}if(!decodedToken){return done(new JsonWebTokenError_1("invalid token"))}var header=decodedToken.header;if(!~options.algorithms.indexOf(header.alg)){return done(new JsonWebTokenError_1("invalid algorithm"))}var valid;try{valid=index$22.verify(jwtString,header.alg,secretOrPublicKey)}catch(e){return done(e)}if(!valid)return done(new JsonWebTokenError_1("invalid signature"));var payload;try{payload=decode(jwtString)}catch(err){return done(err)}if(typeof payload.nbf!=="undefined"&&!options.ignoreNotBefore){if(typeof payload.nbf!=="number"){return done(new JsonWebTokenError_1("invalid nbf value"))}if(payload.nbf>clockTimestamp+(options.clockTolerance||0)){return done(new NotBeforeError_1("jwt not active",new Date(payload.nbf*1e3)))}}if(typeof payload.exp!=="undefined"&&!options.ignoreExpiration){if(typeof payload.exp!=="number"){return done(new JsonWebTokenError_1("invalid exp value"))}if(clockTimestamp>=payload.exp+(options.clockTolerance||0)){return done(new TokenExpiredError_1("jwt expired",new Date(payload.exp*1e3)))}}if(options.audience){var audiences=Array.isArray(options.audience)?options.audience:[options.audience];var target=Array.isArray(payload.aud)?payload.aud:[payload.aud];var match=target.some(function(aud){return audiences.indexOf(aud)!=-1});if(!match)return done(new JsonWebTokenError_1("jwt audience invalid. expected: "+audiences.join(" or ")))}if(options.issuer){var invalid_issuer=typeof options.issuer==="string"&&payload.iss!==options.issuer||Array.isArray(options.issuer)&&options.issuer.indexOf(payload.iss)===-1;if(invalid_issuer){return done(new JsonWebTokenError_1("jwt issuer invalid. expected: "+options.issuer))}}if(options.subject){if(payload.sub!==options.subject){return done(new JsonWebTokenError_1("jwt subject invalid. expected: "+options.subject))}}if(options.jwtid){if(payload.jti!==options.jwtid){return done(new JsonWebTokenError_1("jwt jwtid invalid. expected: "+options.jwtid))}}if(options.maxAge){var maxAge=index$32(options.maxAge);if(typeof payload.iat!=="number"){return done(new JsonWebTokenError_1("iat required when maxAge is specified"))}var nowOrClockTimestamp=(options.clockTimestamp||0)*1e3||Date.now();if(nowOrClockTimestamp-payload.iat*1e3>maxAge+(options.clockTolerance||0)*1e3){return done(new TokenExpiredError_1("maxAge exceeded",new Date(payload.iat*1e3+maxAge)))}}return done(null,payload)};var timespan=function(time,iat){var timestamp=iat||Math.floor(Date.now()/1e3);if(typeof time==="string"){var milliseconds=index$32(time);if(typeof milliseconds==="undefined"){return}return Math.floor(timestamp+milliseconds/1e3)}else if(typeof time==="number"){return timestamp+time}else{return}};var INFINITY$1=1/0;var MAX_SAFE_INTEGER=9007199254740991;var MAX_INTEGER=1.7976931348623157e308;var NAN=0/0;var argsTag="[object Arguments]";var funcTag$1="[object Function]";var genTag$1="[object GeneratorFunction]";var stringTag="[object String]";var symbolTag$1="[object Symbol]";var reTrim=/^\s+|\s+$/g;var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;var reIsBinary=/^0b[01]+$/i;var reIsOctal=/^0o[0-7]+$/i;var reIsUint=/^(?:0|[1-9]\d*)$/;var freeParseInt=parseInt;function arrayMap(array,iteratee){var index=-1,length=array?array.length:0,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array)}return result}function baseFindIndex(array,predicate,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?1:-1);while(fromRight?index--:++index<length){if(predicate(array[index],index,array)){return index}}return-1}function baseIndexOf(array,value,fromIndex){if(value!==value){return baseFindIndex(array,baseIsNaN,fromIndex)}var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index}}return-1}function baseIsNaN(value){return value!==value}function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index)}return result}function baseValues(object,props){return arrayMap(props,function(key){return object[key]})}function overArg(func,transform){return function(arg){return func(transform(arg))}}var objectProto$1=Object.prototype;var hasOwnProperty$3=objectProto$1.hasOwnProperty;var objectToString$1=objectProto$1.toString;var propertyIsEnumerable=objectProto$1.propertyIsEnumerable;var nativeKeys=overArg(Object.keys,Object);var nativeMax=Math.max;function arrayLikeKeys(value,inherited){var result=isArray$1(value)||isArguments(value)?baseTimes(value.length,String):[];var length=result.length,skipIndexes=!!length;for(var key in value){if((inherited||hasOwnProperty$3.call(value,key))&&!(skipIndexes&&(key=="length"||isIndex(key,length)))){result.push(key)}}return result}function baseKeys(object){if(!isPrototype(object)){return nativeKeys(object)}var result=[];for(var key in Object(object)){if(hasOwnProperty$3.call(object,key)&&key!="constructor"){result.push(key)}}return result}function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER:length;return!!length&&(typeof value=="number"||reIsUint.test(value))&&(value>-1&&value%1==0&&value<length)}function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=="function"&&Ctor.prototype||objectProto$1;return value===proto}function includes(collection,value,fromIndex,guard){collection=isArrayLike(collection)?collection:values(collection);fromIndex=fromIndex&&!guard?toInteger(fromIndex):0;var length=collection.length;if(fromIndex<0){fromIndex=nativeMax(length+fromIndex,0)}return isString(collection)?fromIndex<=length&&collection.indexOf(value,fromIndex)>-1:!!length&&baseIndexOf(collection,value,fromIndex)>-1}function isArguments(value){return isArrayLikeObject(value)&&hasOwnProperty$3.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString$1.call(value)==argsTag)}var isArray$1=Array.isArray;function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction$1(value)}function isArrayLikeObject(value){return isObjectLike$1(value)&&isArrayLike(value)}function isFunction$1(value){var tag=isObject$2(value)?objectToString$1.call(value):"";return tag==funcTag$1||tag==genTag$1}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject$2(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike$1(value){return!!value&&typeof value=="object"}function isString(value){return typeof value=="string"||!isArray$1(value)&&isObjectLike$1(value)&&objectToString$1.call(value)==stringTag}function isSymbol$1(value){return typeof value=="symbol"||isObjectLike$1(value)&&objectToString$1.call(value)==symbolTag$1}function toFinite(value){if(!value){return value===0?value:0}value=toNumber(value);if(value===INFINITY$1||value===-INFINITY$1){var sign=value<0?-1:1;return sign*MAX_INTEGER}return value===value?value:0}function toInteger(value){var result=toFinite(value),remainder=result%1;return result===result?remainder?result-remainder:result:0}function toNumber(value){if(typeof value=="number"){return value}if(isSymbol$1(value)){return NAN}if(isObject$2(value)){var other=typeof value.valueOf=="function"?value.valueOf():value;value=isObject$2(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object)}function values(object){return object?baseValues(object,keys(object)):[]}var index$34=includes;var isArray$2=Array.isArray;var index$36=isArray$2;var boolTag="[object Boolean]";var objectProto$2=Object.prototype;var objectToString$2=objectProto$2.toString;function isBoolean(value){return value===true||value===false||isObjectLike$2(value)&&objectToString$2.call(value)==boolTag}function isObjectLike$2(value){return!!value&&typeof value=="object"}var index$38=isBoolean;var INFINITY$2=1/0;var MAX_INTEGER$1=1.7976931348623157e308;var NAN$1=0/0;var symbolTag$2="[object Symbol]";var reTrim$1=/^\s+|\s+$/g;var reIsBadHex$1=/^[-+]0x[0-9a-f]+$/i;var reIsBinary$1=/^0b[01]+$/i;var reIsOctal$1=/^0o[0-7]+$/i;var freeParseInt$1=parseInt;var objectProto$3=Object.prototype;var objectToString$3=objectProto$3.toString;function isInteger(value){return typeof value=="number"&&value==toInteger$1(value)}function isObject$3(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike$3(value){return!!value&&typeof value=="object"}function isSymbol$2(value){return typeof value=="symbol"||isObjectLike$3(value)&&objectToString$3.call(value)==symbolTag$2}function toFinite$1(value){if(!value){return value===0?value:0}value=toNumber$1(value);if(value===INFINITY$2||value===-INFINITY$2){var sign=value<0?-1:1;return sign*MAX_INTEGER$1}return value===value?value:0}function toInteger$1(value){var result=toFinite$1(value),remainder=result%1;return result===result?remainder?result-remainder:result:0}function toNumber$1(value){if(typeof value=="number"){return value}if(isSymbol$2(value)){return NAN$1}if(isObject$3(value)){var other=typeof value.valueOf=="function"?value.valueOf():value;value=isObject$3(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=value.replace(reTrim$1,"");var isBinary=reIsBinary$1.test(value);return isBinary||reIsOctal$1.test(value)?freeParseInt$1(value.slice(2),isBinary?2:8):reIsBadHex$1.test(value)?NAN$1:+value}var index$40=isInteger;var numberTag="[object Number]";var objectProto$4=Object.prototype;var objectToString$4=objectProto$4.toString;function isObjectLike$4(value){return!!value&&typeof value=="object"}function isNumber(value){return typeof value=="number"||isObjectLike$4(value)&&objectToString$4.call(value)==numberTag}var index$42=isNumber;var objectTag="[object Object]";function isHostObject$1(value){var result=false;if(value!=null&&typeof value.toString!="function"){try{result=!!(value+"")}catch(e){}}return result}function overArg$1(func,transform){return function(arg){return func(transform(arg))}}var funcProto$1=Function.prototype;var objectProto$5=Object.prototype;var funcToString$1=funcProto$1.toString;var hasOwnProperty$4=objectProto$5.hasOwnProperty;var objectCtorString=funcToString$1.call(Object);var objectToString$5=objectProto$5.toString;var getPrototype=overArg$1(Object.getPrototypeOf,Object);function isObjectLike$5(value){return!!value&&typeof value=="object"}function isPlainObject(value){if(!isObjectLike$5(value)||objectToString$5.call(value)!=objectTag||isHostObject$1(value)){return false}var proto=getPrototype(value);if(proto===null){return true}var Ctor=hasOwnProperty$4.call(proto,"constructor")&&proto.constructor;return typeof Ctor=="function"&&Ctor instanceof Ctor&&funcToString$1.call(Ctor)==objectCtorString}var index$44=isPlainObject;var stringTag$1="[object String]";var objectProto$6=Object.prototype;var objectToString$6=objectProto$6.toString;var isArray$3=Array.isArray;function isObjectLike$6(value){return!!value&&typeof value=="object"}function isString$1(value){return typeof value=="string"||!isArray$3(value)&&isObjectLike$6(value)&&objectToString$6.call(value)==stringTag$1}var index$46=isString$1;var FUNC_ERROR_TEXT$1="Expected a function";var INFINITY$3=1/0;var MAX_INTEGER$2=1.7976931348623157e308;var NAN$2=0/0;var symbolTag$3="[object Symbol]";var reTrim$2=/^\s+|\s+$/g;var reIsBadHex$2=/^[-+]0x[0-9a-f]+$/i;var reIsBinary$2=/^0b[01]+$/i;var reIsOctal$2=/^0o[0-7]+$/i;var freeParseInt$2=parseInt;var objectProto$7=Object.prototype;var objectToString$7=objectProto$7.toString;function before(n,func){var result;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT$1)}n=toInteger$2(n);return function(){if(--n>0){result=func.apply(this,arguments)}if(n<=1){func=undefined}return result}}function once(func){return before(2,func)}function isObject$4(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike$7(value){return!!value&&typeof value=="object"}function isSymbol$3(value){return typeof value=="symbol"||isObjectLike$7(value)&&objectToString$7.call(value)==symbolTag$3}function toFinite$2(value){if(!value){return value===0?value:0}value=toNumber$2(value);if(value===INFINITY$3||value===-INFINITY$3){var sign=value<0?-1:1;return sign*MAX_INTEGER$2}return value===value?value:0}function toInteger$2(value){var result=toFinite$2(value),remainder=result%1;return result===result?remainder?result-remainder:result:0}function toNumber$2(value){if(typeof value=="number"){return value}if(isSymbol$3(value)){return NAN$2}if(isObject$4(value)){var other=typeof value.valueOf=="function"?value.valueOf():value;value=isObject$4(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=value.replace(reTrim$2,"");var isBinary=reIsBinary$2.test(value);return isBinary||reIsOctal$2.test(value)?freeParseInt$2(value.slice(2),isBinary?2:8):reIsBadHex$2.test(value)?NAN$2:+value}var index$48=once;var sign_options_schema={expiresIn:function(value){return index$40(value)||index$46(value)},notBefore:function(value){return index$40(value)||index$46(value)},audience:function(value){return index$46(value)||index$36(value)},algorithm:index$34.bind(null,["RS256","RS384","RS512","ES256","ES384","ES512","HS256","HS384","HS512","none"]),header:index$44,encoding:index$46,issuer:index$46,subject:index$46,jwtid:index$46,noTimestamp:index$38,keyid:index$46};var registered_claims_schema={iat:index$42,exp:index$42,nbf:index$42};function validate(schema,unknown,object){if(!index$44(object)){throw new Error("Expected object")}Object.keys(object).forEach(function(key){if(schema[key]==null){if(!unknown){throw new Error('"'+key+'" is not allowed')}return}if(!schema[key](object[key])){throw new Error('"'+key+'" is not the correct type')}})}var options_to_payload={audience:"aud",issuer:"iss",subject:"sub",jwtid:"jti"};var options_for_objects=["expiresIn","notBefore","noTimestamp","audience","issuer","subject","jwtid"];var sign$1=function(payload,secretOrPrivateKey,options,callback){if(typeof options==="function"){callback=options;options={}}else{options=options||{}}var isObjectPayload=typeof payload==="object"&&!Buffer.isBuffer(payload);var header=immutable({alg:options.algorithm||"HS256",typ:isObjectPayload?"JWT":undefined,kid:options.keyid},options.header);function failure(err){if(callback){return callback(err)}throw err}if(typeof payload==="undefined"){return failure(new Error("payload is required"))}else if(isObjectPayload){try{validate(registered_claims_schema,true,payload)}catch(error){return failure(error)}payload=immutable(payload)}else{var invalid_options=options_for_objects.filter(function(opt){return typeof options[opt]!=="undefined"});if(invalid_options.length>0){return failure(new Error("invalid "+invalid_options.join(",")+" option for "+typeof payload+" payload"))}}if(typeof payload.exp!=="undefined"&&typeof options.expiresIn!=="undefined"){return failure(new Error('Bad "options.expiresIn" option the payload already has an "exp" property.'))}if(typeof payload.nbf!=="undefined"&&typeof options.notBefore!=="undefined"){return failure(new Error('Bad "options.notBefore" option the payload already has an "nbf" property.'))}try{validate(sign_options_schema,false,options)}catch(error){return failure(error)}var timestamp=payload.iat||Math.floor(Date.now()/1e3);if(!options.noTimestamp){payload.iat=timestamp}else{delete payload.iat}if(typeof options.notBefore!=="undefined"){payload.nbf=timespan(options.notBefore);if(typeof payload.nbf==="undefined"){return failure(new Error('"notBefore" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}}if(typeof options.expiresIn!=="undefined"&&typeof payload==="object"){payload.exp=timespan(options.expiresIn,timestamp);if(typeof payload.exp==="undefined"){return failure(new Error('"expiresIn" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}}Object.keys(options_to_payload).forEach(function(key){var claim=options_to_payload[key];if(typeof options[key]!=="undefined"){if(typeof payload[claim]!=="undefined"){return failure(new Error('Bad "options.'+key+'" option. The payload already has an "'+claim+'" property.'))}payload[claim]=options[key]}});var encoding=options.encoding||"utf8";if(typeof callback==="function"){callback=callback&&index$48(callback);index$22.createSign({header:header,privateKey:secretOrPrivateKey,payload:payload,encoding:encoding}).once("error",callback).once("done",function(signature){callback(null,signature)})}else{return index$22.sign({header:header,payload:payload,secret:secretOrPrivateKey,encoding:encoding})}};var index$20={decode:decode,verify:verify$1,sign:sign$1,JsonWebTokenError:JsonWebTokenError_1,NotBeforeError:NotBeforeError_1,TokenExpiredError:TokenExpiredError_1};var serviceSecret=createCommonjsModule(function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const secret=process.env.SERVICE_TOKEN_SECRET;if(!secret){throw new Error("no $SERVICE_TOKEN_SECRET provided")}exports.signServiceSecret=(()=>index$20.sign({baseUrl:baseUrl.baseUrl},secret,{algorithm:"HS256",expiresIn:30}));exports.verifyServiceSecret=(opaqueObject=>{const{baseUrl:foundBaseUrl}=index$20.verify(opaqueObject,secret,{algorithms:["HS256"],clockTolerance:30});if(foundBaseUrl!==baseUrl.baseUrl){const e=new Error("Incorrect service secret");e.invalidServiceSecret=foundBaseUrl;throw e}})});var require$$0$6=url&&url__default||url;var fetch=createCommonjsModule(function(module,exports){"use strict";var __awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});const isApiResponseError=response=>"error"in response;const getFunctionPrefix=baseUrl$$1=>{const{hostname:hostname}=require$$0$6.parse(baseUrl$$1);if(hostname==null){throw new Error(`Failed to parse ${baseUrl$$1}`)}const branch=hostname.split(".")[0];return branch==="live"?"honesty-store-":`hs-${branch}-`};exports.default=((service,baseUrl$$1=baseUrl.baseUrl)=>{const getUrl=(version,path)=>`/${service}/v${version}${path}`;const fetchAndParse=({method:method,url:url$$1,key:key$$1,body:body=undefined})=>__awaiter(commonjsGlobal,void 0,void 0,function*(){log_1.info(key$$1,`send ${method} ${url$$1}`);const request={serviceSecret:serviceSecret.signServiceSecret(),key:key$$1,method:method,path:url$$1,body:body};const response=yield new aws_sdk_1.Lambda({apiVersion:"2015-03-31"}).invoke({InvocationType:"RequestResponse",FunctionName:getFunctionPrefix(baseUrl$$1)+service,Payload:JSON.stringify(request)}).promise();let json;try{json=JSON.parse(response.Payload)}catch(e){log_1.error(key$$1,`failed ${method} ${url$$1}, couldn't parse json`,{httpStatus:response.StatusCode,responseText:response.Payload});throw new Error(`${method} ${url$$1} failed (couldn't parse json), HTTP ${response.StatusCode}`)}if(response.StatusCode==null||response.StatusCode<200||response.StatusCode>=300){log_1.error(key$$1,`failed non-2xx ${method} ${url$$1} ${response.StatusCode}`);throw new Error(`${method} ${url$$1} failed (non-2xx response), HTTP ${response.StatusCode}`)}if(isApiResponseError(json)){log_1.error(key$$1,`error ${method} ${url$$1} ${json.error.message}`);if(json.error.code){throw new error$1.CodedError(json.error.code,json.error.message)}throw new Error(json.error.message)}log_1.info(key$$1,`success ${method} ${url$$1}`,{status:response.StatusCode,response:json});return json.response});const cache=asyncCache.default({max:1e3,maxAge:index$16("5s"),load:url$$1=>fetchAndParse({method:"GET",url:url$$1,key:key.createServiceKey({service:service})})});const get=(version,key$$1,path,cacheBypass=false)=>__awaiter(commonjsGlobal,void 0,void 0,function*(){const url$$1=getUrl(version,path);if(cacheBypass){return yield fetchAndParse({method:"GET",url:url$$1,key:key.createServiceKey({service:service})})}log_1.info(key$$1,`cache check for GET ${url$$1}`);return yield cache.get(url$$1)});const post=(version,key$$1,path,body)=>__awaiter(commonjsGlobal,void 0,void 0,function*(){return yield fetchAndParse({method:"POST",url:getUrl(version,path),key:key$$1,body:body})});const put=(version,key$$1,path,body)=>__awaiter(commonjsGlobal,void 0,void 0,function*(){return yield fetchAndParse({method:"PUT",url:getUrl(version,path),key:key$$1,body:body})});return{get:get,post:post,put:put}})});var index$14=createCommonjsModule(function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const{get:get,post:post}=fetch.default("item",baseUrl.lambdaBaseUrl);exports.createItem=((key,details)=>post(1,key,`/`,details));exports.updateItem=((key,itemId,details)=>post(1,key,`/${itemId}`,details));exports.getItem=((key,itemId)=>get(1,key,`/${itemId}`));exports.getAllItems=(key=>get(1,key,`/all`));exports.getItemAliases=(key=>get(1,key,`/all/aliases`));exports.assertItemExistsAsync=((key,itemId)=>exports.getItem(key,itemId).then(()=>void 0).catch(e=>{console.error(`item '${itemId}' doesn't exist`,e);process.exit(1)}))});var merge_1=createCommonjsModule(function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=merge;function merge(){var obj=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var defaults=arguments[1];for(var key in defaults){if(typeof obj[key]==="undefined"){obj[key]=defaults[key]}}return obj}module.exports=exports["default"]});var isByteLength_1=createCommonjsModule(function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.default=isByteLength;var _assertString2=_interopRequireDefault(assertString_1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function isByteLength(str,options){(0,_assertString2.default)(str);var min=void 0;var max=void 0;if((typeof options==="undefined"?"undefined":_typeof(options))==="object"){min=options.min||0;max=options.max}else{min=arguments[1];max=arguments[2]}var len=encodeURI(str).split(/%..|./).length-1;return len>=min&&(typeof max==="undefined"||len<=max)}module.exports=exports["default"]});var isFQDN=createCommonjsModule(function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=isFDQN;var _assertString2=_interopRequireDefault(assertString_1);var _merge2=_interopRequireDefault(merge_1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var default_fqdn_options={require_tld:true,allow_underscores:false,allow_trailing_dot:false};function isFDQN(str,options){(0,_assertString2.default)(str);options=(0,_merge2.default)(options,default_fqdn_options);if(options.allow_trailing_dot&&str[str.length-1]==="."){str=str.substring(0,str.length-1)}var parts=str.split(".");if(options.require_tld){var tld=parts.pop();if(!parts.length||!/^([a-z\u00a1-\uffff]{2,}|xn[a-z0-9-]{2,})$/i.test(tld)){return false}}for(var part,i=0;i<parts.length;i++){part=parts[i];if(options.allow_underscores){part=part.replace(/_/g,"")}if(!/^[a-z\u00a1-\uffff0-9-]+$/i.test(part)){return false}if(/[\uff01-\uff5e]/.test(part)){return false}if(part[0]==="-"||part[part.length-1]==="-"){return false}}return true}module.exports=exports["default"]});var isEmail_1=createCommonjsModule(function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=isEmail;var _assertString2=_interopRequireDefault(assertString_1);var _merge2=_interopRequireDefault(merge_1);var _isByteLength2=_interopRequireDefault(isByteLength_1);var _isFQDN2=_interopRequireDefault(isFQDN);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var default_email_options={allow_display_name:false,require_display_name:false,allow_utf8_local_part:true,require_tld:true};var displayName=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~\.\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~\.\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF\s]*<(.+)>$/i;var emailUserPart=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~]+$/i;var quotedEmailUser=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f]))*$/i;var emailUserUtf8Part=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+$/i;var quotedEmailUserUtf8=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*$/i;function isEmail(str,options){(0,_assertString2.default)(str);options=(0,_merge2.default)(options,default_email_options);if(options.require_display_name||options.allow_display_name){var display_email=str.match(displayName);if(display_email){str=display_email[1]}else if(options.require_display_name){return false}}var parts=str.split("@");var domain=parts.pop();var user=parts.join("@");var lower_domain=domain.toLowerCase();if(lower_domain==="gmail.com"||lower_domain==="googlemail.com"){user=user.replace(/\./g,"").toLowerCase()}if(!(0,_isByteLength2.default)(user,{max:64})||!(0,_isByteLength2.default)(domain,{max:256})){return false}if(!(0,_isFQDN2.default)(domain,{require_tld:options.require_tld})){return false}if(user[0]==='"'){user=user.slice(1,user.length-1);return options.allow_utf8_local_part?quotedEmailUserUtf8.test(user):quotedEmailUser.test(user)}var pattern=options.allow_utf8_local_part?emailUserUtf8Part:emailUserPart;var user_parts=user.split(".");for(var i=0;i<user_parts.length;i++){if(!pattern.test(user_parts[i])){return false}}return true}module.exports=exports["default"]});var assert=createCommonjsModule(function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createAssertValidUuid=(name=>uuid=>{if(uuid==null||!isUUID_1(uuid,4)){throw new Error(`Invalid ${name} ${uuid}`)}});exports.assertValidUuid=((key,value)=>{if(value==null||!isUUID_1(value,4)){throw new Error(`Invalid ${key} ${value}`)}});exports.assertValidString=((key,value)=>{if(typeof value!=="string"){throw new Error(`Invalid ${key} ${value}`)}});exports.assertPositiveInteger=((key,value)=>{if(!Number.isInteger(value)||value<0){throw new Error(`Invalid ${key} ${value}`)}});exports.assertNonZeroPositiveInteger=((key,value)=>{if(!Number.isInteger(value)||value<=0){throw new Error(`Invalid ${key} ${value}`)}});exports.assertObject=((key,value)=>{if(typeof value!=="object"){throw new Error(`Invalid ${key} ${value}`)}});exports.assertOptional=(validator=>{return(key,value)=>{if(value!=null){validator(key,value)}}});exports.assertValidEmailAddress=(emailAddress=>{if(emailAddress==null||!isEmail_1(emailAddress)){throw new Error(`Invalid emailAddress ${emailAddress}`)}});exports.createAssertValidObject=(validator=>object=>{for(const key of Object.keys(validator)){const value=object[key];validator[key](key,value)}const unexpectedKeys=Object.keys(object).filter(key=>!(key in validator));if(unexpectedKeys.length!==0){throw new Error(`Unexpected key(s) found on object: ${unexpectedKeys}`)}});exports.assertNever=(value=>{throw new Error(`Invalid value ${value}`)})});var BOMChar="\ufeff";var PrependBOM=PrependBOMWrapper;function PrependBOMWrapper(encoder,options){this.encoder=encoder;this.addBOM=true}PrependBOMWrapper.prototype.write=function(str){if(this.addBOM){str=BOMChar+str;this.addBOM=false}return this.encoder.write(str)};PrependBOMWrapper.prototype.end=function(){return this.encoder.end()};var StripBOM=StripBOMWrapper;function StripBOMWrapper(decoder,options){this.decoder=decoder;this.pass=false;this.options=options||{}}StripBOMWrapper.prototype.write=function(buf){var res=this.decoder.write(buf);if(this.pass||!res)return res;if(res[0]===BOMChar){res=res.slice(1);if(typeof this.options.stripBOM==="function")this.options.stripBOM()}this.pass=true;return res};StripBOMWrapper.prototype.end=function(){return this.decoder.end()};var bomHandling={PrependBOM:PrependBOM,StripBOM:StripBOM};var internal={utf8:{type:"_internal",bomAware:true},cesu8:{type:"_internal",bomAware:true},unicode11utf8:"utf8",ucs2:{type:"_internal",bomAware:true},utf16le:"ucs2",binary:{type:"_internal"},base64:{type:"_internal"},hex:{type:"_internal"},_internal:InternalCodec};function InternalCodec(codecOptions,iconv){this.enc=codecOptions.encodingName;this.bomAware=codecOptions.bomAware;if(this.enc==="base64")this.encoder=InternalEncoderBase64;else if(this.enc==="cesu8"){this.enc="utf8";this.encoder=InternalEncoderCesu8;if(new Buffer("eda080","hex").toString().length==3){this.decoder=InternalDecoderCesu8;this.defaultCharUnicode=iconv.defaultCharUnicode}}}InternalCodec.prototype.encoder=InternalEncoder;InternalCodec.prototype.decoder=InternalDecoder;var StringDecoder$1=require$$0$1.StringDecoder;if(!StringDecoder$1.prototype.end)StringDecoder$1.prototype.end=function(){};function InternalDecoder(options,codec){StringDecoder$1.call(this,codec.enc)}InternalDecoder.prototype=StringDecoder$1.prototype;function InternalEncoder(options,codec){this.enc=codec.enc}InternalEncoder.prototype.write=function(str){return new Buffer(str,this.enc)};InternalEncoder.prototype.end=function(){};function InternalEncoderBase64(options,codec){this.prevStr=""}InternalEncoderBase64.prototype.write=function(str){str=this.prevStr+str;var completeQuads=str.length-str.length%4;this.prevStr=str.slice(completeQuads);str=str.slice(0,completeQuads);return new Buffer(str,"base64")};InternalEncoderBase64.prototype.end=function(){return new Buffer(this.prevStr,"base64")};function InternalEncoderCesu8(options,codec){}InternalEncoderCesu8.prototype.write=function(str){var buf=new Buffer(str.length*3),bufIdx=0;for(var i=0;i<str.length;i++){var charCode=str.charCodeAt(i);if(charCode<128)buf[bufIdx++]=charCode;else if(charCode<2048){buf[bufIdx++]=192+(charCode>>>6);buf[bufIdx++]=128+(charCode&63)}else{buf[bufIdx++]=224+(charCode>>>12);buf[bufIdx++]=128+(charCode>>>6&63);buf[bufIdx++]=128+(charCode&63)}}return buf.slice(0,bufIdx)};InternalEncoderCesu8.prototype.end=function(){};function InternalDecoderCesu8(options,codec){this.acc=0;this.contBytes=0;this.accBytes=0;this.defaultCharUnicode=codec.defaultCharUnicode}InternalDecoderCesu8.prototype.write=function(buf){var acc=this.acc,contBytes=this.contBytes,accBytes=this.accBytes,res="";for(var i=0;i<buf.length;i++){var curByte=buf[i];if((curByte&192)!==128){if(contBytes>0){res+=this.defaultCharUnicode;contBytes=0}if(curByte<128){res+=String.fromCharCode(curByte)}else if(curByte<224){acc=curByte&31;contBytes=1;accBytes=1}else if(curByte<240){acc=curByte&15;contBytes=2;accBytes=1}else{res+=this.defaultCharUnicode}}else{if(contBytes>0){acc=acc<<6|curByte&63;contBytes--;accBytes++;if(contBytes===0){if(accBytes===2&&acc<128&&acc>0)res+=this.defaultCharUnicode;else if(accBytes===3&&acc<2048)res+=this.defaultCharUnicode;else res+=String.fromCharCode(acc)}}else{res+=this.defaultCharUnicode}}}this.acc=acc;this.contBytes=contBytes;this.accBytes=accBytes;return res};InternalDecoderCesu8.prototype.end=function(){var res=0;if(this.contBytes>0)res+=this.defaultCharUnicode;return res};var utf16be=Utf16BECodec;function Utf16BECodec(){}Utf16BECodec.prototype.encoder=Utf16BEEncoder;Utf16BECodec.prototype.decoder=Utf16BEDecoder;Utf16BECodec.prototype.bomAware=true;function Utf16BEEncoder(){}Utf16BEEncoder.prototype.write=function(str){var buf=new Buffer(str,"ucs2");for(var i=0;i<buf.length;i+=2){var tmp=buf[i];buf[i]=buf[i+1];buf[i+1]=tmp}return buf};Utf16BEEncoder.prototype.end=function(){};function Utf16BEDecoder(){this.overflowByte=-1}Utf16BEDecoder.prototype.write=function(buf){if(buf.length==0)return"";var buf2=new Buffer(buf.length+1),i=0,j=0;if(this.overflowByte!==-1){buf2[0]=buf[0];buf2[1]=this.overflowByte;i=1;j=2}for(;i<buf.length-1;i+=2,j+=2){buf2[j]=buf[i+1];buf2[j+1]=buf[i]}this.overflowByte=i==buf.length-1?buf[buf.length-1]:-1;return buf2.slice(0,j).toString("ucs2")};Utf16BEDecoder.prototype.end=function(){};var utf16_1=Utf16Codec;function Utf16Codec(codecOptions,iconv){this.iconv=iconv}Utf16Codec.prototype.encoder=Utf16Encoder;Utf16Codec.prototype.decoder=Utf16Decoder;function Utf16Encoder(options,codec){options=options||{};if(options.addBOM===undefined)options.addBOM=true;this.encoder=codec.iconv.getEncoder("utf-16le",options)}Utf16Encoder.prototype.write=function(str){return this.encoder.write(str)};Utf16Encoder.prototype.end=function(){return this.encoder.end()};function Utf16Decoder(options,codec){this.decoder=null;this.initialBytes=[];this.initialBytesLen=0;this.options=options||{};this.iconv=codec.iconv}Utf16Decoder.prototype.write=function(buf){if(!this.decoder){this.initialBytes.push(buf);this.initialBytesLen+=buf.length;if(this.initialBytesLen<16)return"";var buf=Buffer.concat(this.initialBytes),encoding=detectEncoding(buf,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(encoding,this.options);this.initialBytes.length=this.initialBytesLen=0}return this.decoder.write(buf)};Utf16Decoder.prototype.end=function(){if(!this.decoder){var buf=Buffer.concat(this.initialBytes),encoding=detectEncoding(buf,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(encoding,this.options);var res=this.decoder.write(buf),trail=this.decoder.end();return trail?res+trail:res}return this.decoder.end()};function detectEncoding(buf,defaultEncoding){var enc=defaultEncoding||"utf-16le";if(buf.length>=2){if(buf[0]==254&&buf[1]==255)enc="utf-16be";else if(buf[0]==255&&buf[1]==254)enc="utf-16le";else{var asciiCharsLE=0,asciiCharsBE=0,_len=Math.min(buf.length-buf.length%2,64);for(var i=0;i<_len;i+=2){if(buf[i]===0&&buf[i+1]!==0)asciiCharsBE++;if(buf[i]!==0&&buf[i+1]===0)asciiCharsLE++}if(asciiCharsBE>asciiCharsLE)enc="utf-16be";else if(asciiCharsBE<asciiCharsLE)enc="utf-16le"}}return enc}var utf16={utf16be:utf16be,utf16:utf16_1};var utf7_1=Utf7Codec;var unicode11utf7="utf7";function Utf7Codec(codecOptions,iconv){this.iconv=iconv}Utf7Codec.prototype.encoder=Utf7Encoder;Utf7Codec.prototype.decoder=Utf7Decoder;Utf7Codec.prototype.bomAware=true;var nonDirectChars=/[^A-Za-z0-9'\(\),-\.\/:\? \n\r\t]+/g;function Utf7Encoder(options,codec){this.iconv=codec.iconv}Utf7Encoder.prototype.write=function(str){return new Buffer(str.replace(nonDirectChars,function(chunk){return"+"+(chunk==="+"?"":this.iconv.encode(chunk,"utf16-be").toString("base64").replace(/=+$/,""))+"-"}.bind(this)))};Utf7Encoder.prototype.end=function(){};function Utf7Decoder(options,codec){this.iconv=codec.iconv;this.inBase64=false;this.base64Accum=""}var base64Regex=/[A-Za-z0-9\/+]/;var base64Chars=[];for(var i$1=0;i$1<256;i$1++)base64Chars[i$1]=base64Regex.test(String.fromCharCode(i$1));var plusChar="+".charCodeAt(0);var minusChar="-".charCodeAt(0);var andChar="&".charCodeAt(0);Utf7Decoder.prototype.write=function(buf){var res="",lastI=0,inBase64=this.inBase64,base64Accum=this.base64Accum;for(var i=0;i<buf.length;i++){if(!inBase64){if(buf[i]==plusChar){res+=this.iconv.decode(buf.slice(lastI,i),"ascii");lastI=i+1;inBase64=true}}else{if(!base64Chars[buf[i]]){if(i==lastI&&buf[i]==minusChar){res+="+"}else{var b64str=base64Accum+buf.slice(lastI,i).toString();res+=this.iconv.decode(new Buffer(b64str,"base64"),"utf16-be")}if(buf[i]!=minusChar)i--;lastI=i+1;inBase64=false;base64Accum=""}}}if(!inBase64){res+=this.iconv.decode(buf.slice(lastI),"ascii")}else{var b64str=base64Accum+buf.slice(lastI).toString();var canBeDecoded=b64str.length-b64str.length%8;base64Accum=b64str.slice(canBeDecoded);b64str=b64str.slice(0,canBeDecoded);res+=this.iconv.decode(new Buffer(b64str,"base64"),"utf16-be")}this.inBase64=inBase64;this.base64Accum=base64Accum;return res};Utf7Decoder.prototype.end=function(){var res="";if(this.inBase64&&this.base64Accum.length>0)res=this.iconv.decode(new Buffer(this.base64Accum,"base64"),"utf16-be");this.inBase64=false;this.base64Accum="";return res};var utf7imap=Utf7IMAPCodec;function Utf7IMAPCodec(codecOptions,iconv){this.iconv=iconv}Utf7IMAPCodec.prototype.encoder=Utf7IMAPEncoder;Utf7IMAPCodec.prototype.decoder=Utf7IMAPDecoder;Utf7IMAPCodec.prototype.bomAware=true;function Utf7IMAPEncoder(options,codec){this.iconv=codec.iconv;this.inBase64=false;this.base64Accum=new Buffer(6);this.base64AccumIdx=0}Utf7IMAPEncoder.prototype.write=function(str){var inBase64=this.inBase64,base64Accum=this.base64Accum,base64AccumIdx=this.base64AccumIdx,buf=new Buffer(str.length*5+10),bufIdx=0;for(var i=0;i<str.length;i++){var uChar=str.charCodeAt(i);if(32<=uChar&&uChar<=126){if(inBase64){if(base64AccumIdx>0){bufIdx+=buf.write(base64Accum.slice(0,base64AccumIdx).toString("base64").replace(/\//g,",").replace(/=+$/,""),bufIdx);base64AccumIdx=0}buf[bufIdx++]=minusChar;inBase64=false}if(!inBase64){buf[bufIdx++]=uChar;if(uChar===andChar)buf[bufIdx++]=minusChar}}else{if(!inBase64){buf[bufIdx++]=andChar;inBase64=true}if(inBase64){base64Accum[base64AccumIdx++]=uChar>>8;base64Accum[base64AccumIdx++]=uChar&255;if(base64AccumIdx==base64Accum.length){bufIdx+=buf.write(base64Accum.toString("base64").replace(/\//g,","),bufIdx);base64AccumIdx=0}}}}this.inBase64=inBase64;this.base64AccumIdx=base64AccumIdx;return buf.slice(0,bufIdx)};Utf7IMAPEncoder.prototype.end=function(){var buf=new Buffer(10),bufIdx=0;if(this.inBase64){if(this.base64AccumIdx>0){bufIdx+=buf.write(this.base64Accum.slice(0,this.base64AccumIdx).toString("base64").replace(/\//g,",").replace(/=+$/,""),bufIdx);this.base64AccumIdx=0}buf[bufIdx++]=minusChar;this.inBase64=false}return buf.slice(0,bufIdx)};function Utf7IMAPDecoder(options,codec){this.iconv=codec.iconv;this.inBase64=false;this.base64Accum=""}var base64IMAPChars=base64Chars.slice();base64IMAPChars[",".charCodeAt(0)]=true;Utf7IMAPDecoder.prototype.write=function(buf){var res="",lastI=0,inBase64=this.inBase64,base64Accum=this.base64Accum;for(var i=0;i<buf.length;i++){if(!inBase64){if(buf[i]==andChar){res+=this.iconv.decode(buf.slice(lastI,i),"ascii");lastI=i+1;inBase64=true}}else{if(!base64IMAPChars[buf[i]]){if(i==lastI&&buf[i]==minusChar){res+="&"}else{var b64str=base64Accum+buf.slice(lastI,i).toString().replace(/,/g,"/");res+=this.iconv.decode(new Buffer(b64str,"base64"),"utf16-be")}if(buf[i]!=minusChar)i--;lastI=i+1;inBase64=false;base64Accum=""}}}if(!inBase64){res+=this.iconv.decode(buf.slice(lastI),"ascii")}else{var b64str=base64Accum+buf.slice(lastI).toString().replace(/,/g,"/");var canBeDecoded=b64str.length-b64str.length%8;base64Accum=b64str.slice(canBeDecoded);b64str=b64str.slice(0,canBeDecoded);res+=this.iconv.decode(new Buffer(b64str,"base64"),"utf16-be")}this.inBase64=inBase64;this.base64Accum=base64Accum;return res};Utf7IMAPDecoder.prototype.end=function(){var res="";if(this.inBase64&&this.base64Accum.length>0)res=this.iconv.decode(new Buffer(this.base64Accum,"base64"),"utf16-be");this.inBase64=false;this.base64Accum="";return res};var utf7={utf7:utf7_1,unicode11utf7:unicode11utf7,utf7imap:utf7imap};var _sbcs=SBCSCodec;function SBCSCodec(codecOptions,iconv){if(!codecOptions)throw new Error("SBCS codec is called without the data.");if(!codecOptions.chars||codecOptions.chars.length!==128&&codecOptions.chars.length!==256)throw new Error("Encoding '"+codecOptions.type+"' has incorrect 'chars' (must be of len 128 or 256)");if(codecOptions.chars.length===128){var asciiString="";for(var i=0;i<128;i++)asciiString+=String.fromCharCode(i);codecOptions.chars=asciiString+codecOptions.chars}this.decodeBuf=new Buffer(codecOptions.chars,"ucs2");var encodeBuf=new Buffer(65536);encodeBuf.fill(iconv.defaultCharSingleByte.charCodeAt(0));for(var i=0;i<codecOptions.chars.length;i++)encodeBuf[codecOptions.chars.charCodeAt(i)]=i;this.encodeBuf=encodeBuf}SBCSCodec.prototype.encoder=SBCSEncoder;SBCSCodec.prototype.decoder=SBCSDecoder;function SBCSEncoder(options,codec){this.encodeBuf=codec.encodeBuf}SBCSEncoder.prototype.write=function(str){var buf=new Buffer(str.length);for(var i=0;i<str.length;i++)buf[i]=this.encodeBuf[str.charCodeAt(i)];return buf};SBCSEncoder.prototype.end=function(){};function SBCSDecoder(options,codec){this.decodeBuf=codec.decodeBuf}SBCSDecoder.prototype.write=function(buf){var decodeBuf=this.decodeBuf;var newBuf=new Buffer(buf.length*2);var idx1=0,idx2=0;for(var i=0;i<buf.length;i++){idx1=buf[i]*2;idx2=i*2;newBuf[idx2]=decodeBuf[idx1];newBuf[idx2+1]=decodeBuf[idx1+1]}return newBuf.toString("ucs2")};SBCSDecoder.prototype.end=function(){};var sbcsCodec={_sbcs:_sbcs};var sbcsData={10029:"maccenteuro",maccenteuro:{type:"_sbcs",chars:""},808:"cp808",ibm808:"cp808",cp808:{type:"_sbcs",chars:""},ascii8bit:"ascii",usascii:"ascii",ansix34:"ascii",ansix341968:"ascii",ansix341986:"ascii",csascii:"ascii",cp367:"ascii",ibm367:"ascii",isoir6:"ascii",iso646us:"ascii",iso646irv:"ascii",us:"ascii",latin1:"iso88591",latin2:"iso88592",latin3:"iso88593",latin4:"iso88594",latin5:"iso88599",latin6:"iso885910",latin7:"iso885913",latin8:"iso885914",latin9:"iso885915",latin10:"iso885916",csisolatin1:"iso88591",csisolatin2:"iso88592",csisolatin3:"iso88593",csisolatin4:"iso88594",csisolatincyrillic:"iso88595",csisolatinarabic:"iso88596",csisolatingreek:"iso88597",csisolatinhebrew:"iso88598",csisolatin5:"iso88599",csisolatin6:"iso885910",l1:"iso88591",l2:"iso88592",l3:"iso88593",l4:"iso88594",l5:"iso88599",l6:"iso885910",l7:"iso885913",l8:"iso885914",l9:"iso885915",l10:"iso885916",isoir14:"iso646jp",isoir57:"iso646cn",isoir100:"iso88591",isoir101:"iso88592",isoir109:"iso88593",isoir110:"iso88594",isoir144:"iso88595",isoir127:"iso88596",isoir126:"iso88597",isoir138:"iso88598",isoir148:"iso88599",isoir157:"iso885910",isoir166:"tis620",isoir179:"iso885913",isoir199:"iso885914",isoir203:"iso885915",isoir226:"iso885916",cp819:"iso88591",ibm819:"iso88591",cyrillic:"iso88595",arabic:"iso88596",arabic8:"iso88596",ecma114:"iso88596",asmo708:"iso88596",greek:"iso88597",greek8:"iso88597",ecma118:"iso88597",elot928:"iso88597",hebrew:"iso88598",hebrew8:"iso88598",turkish:"iso88599",turkish8:"iso88599",thai:"iso885911",thai8:"iso885911",celtic:"iso885914",celtic8:"iso885914",isoceltic:"iso885914",tis6200:"tis620",tis62025291:"tis620",tis62025330:"tis620",10000:"macroman",10006:"macgreek",10007:"maccyrillic",10079:"maciceland",10081:"macturkish",cspc8codepage437:"cp437",cspc775baltic:"cp775",cspc850multilingual:"cp850",cspcp852:"cp852",cspc862latinhebrew:"cp862",cpgr:"cp869",msee:"cp1250",mscyrl:"cp1251",msansi:"cp1252",msgreek:"cp1253",msturk:"cp1254",mshebr:"cp1255",msarab:"cp1256",winbaltrim:"cp1257",cp20866:"koi8r",20866:"koi8r",ibm878:"koi8r",cskoi8r:"koi8r",cp21866:"koi8u",21866:"koi8u",ibm1168:"koi8u",strk10482002:"rk1048",tcvn5712:"tcvn",tcvn57121:"tcvn",gb198880:"iso646cn",cn:"iso646cn",csiso14jisc6220ro:"iso646jp",jisc62201969ro:"iso646jp",jp:"iso646jp",cshproman8:"hproman8",r8:"hproman8",roman8:"hproman8",xroman8:"hproman8",ibm1051:"hproman8",mac:"macintosh",csmacintosh:"macintosh"};var sbcsDataGenerated={437:"cp437",737:"cp737",775:"cp775",850:"cp850",852:"cp852",855:"cp855",856:"cp856",857:"cp857",858:"cp858",860:"cp860",861:"cp861",862:"cp862",863:"cp863",864:"cp864",865:"cp865",866:"cp866",869:"cp869",874:"windows874",922:"cp922",1046:"cp1046",1124:"cp1124",1125:"cp1125",1129:"cp1129",1133:"cp1133",1161:"cp1161",1162:"cp1162",1163:"cp1163",1250:"windows1250",1251:"windows1251",1252:"windows1252",1253:"windows1253",1254:"windows1254",1255:"windows1255",1256:"windows1256",1257:"windows1257",1258:"windows1258",28591:"iso88591",28592:"iso88592",28593:"iso88593",28594:"iso88594",28595:"iso88595",28596:"iso88596",28597:"iso88597",28598:"iso88598",28599:"iso88599",28600:"iso885910",28601:"iso885911",28603:"iso885913",28604:"iso885914",28605:"iso885915",28606:"iso885916",windows874:{type:"_sbcs",chars:""},win874:"windows874",cp874:"windows874",windows1250:{type:"_sbcs",chars:""},win1250:"windows1250",cp1250:"windows1250",windows1251:{type:"_sbcs",chars:""},win1251:"windows1251",cp1251:"windows1251",windows1252:{type:"_sbcs",chars:""},win1252:"windows1252",cp1252:"windows1252",windows1253:{type:"_sbcs",chars:""},win1253:"windows1253",cp1253:"windows1253",windows1254:{type:"_sbcs",chars:""},win1254:"windows1254",cp1254:"windows1254",windows1255:{type:"_sbcs",chars:""},win1255:"windows1255",cp1255:"windows1255",windows1256:{type:"_sbcs",chars:""},win1256:"windows1256",cp1256:"windows1256",windows1257:{type:"_sbcs",chars:""},win1257:"windows1257",cp1257:"windows1257",windows1258:{type:"_sbcs",chars:""},win1258:"windows1258",cp1258:"windows1258",iso88591:{type:"_sbcs",chars:""},cp28591:"iso88591",iso88592:{type:"_sbcs",chars:""},cp28592:"iso88592",iso88593:{type:"_sbcs",chars:""},cp28593:"iso88593",iso88594:{type:"_sbcs",chars:""},cp28594:"iso88594",iso88595:{type:"_sbcs",chars:""},cp28595:"iso88595",iso88596:{type:"_sbcs",chars:""},cp28596:"iso88596",iso88597:{type:"_sbcs",chars:""},cp28597:"iso88597",iso88598:{type:"_sbcs",chars:""},cp28598:"iso88598",iso88599:{type:"_sbcs",chars:""},cp28599:"iso88599",iso885910:{type:"_sbcs",chars:""},cp28600:"iso885910",iso885911:{type:"_sbcs",chars:""},cp28601:"iso885911",iso885913:{type:"_sbcs",chars:""},cp28603:"iso885913",iso885914:{type:"_sbcs",chars:""},cp28604:"iso885914",iso885915:{type:"_sbcs",chars:""},cp28605:"iso885915",iso885916:{type:"_sbcs",chars:""},cp28606:"iso885916",cp437:{type:"_sbcs",chars:""},ibm437:"cp437",csibm437:"cp437",cp737:{type:"_sbcs",chars:""},ibm737:"cp737",csibm737:"cp737",cp775:{type:"_sbcs",chars:""},ibm775:"cp775",csibm775:"cp775",cp850:{type:"_sbcs",chars:""},ibm850:"cp850",csibm850:"cp850",cp852:{type:"_sbcs",chars:""},ibm852:"cp852",csibm852:"cp852",cp855:{type:"_sbcs",chars:""},ibm855:"cp855",csibm855:"cp855",cp856:{type:"_sbcs",chars:""},ibm856:"cp856",csibm856:"cp856",cp857:{type:"_sbcs",chars:""},ibm857:"cp857",csibm857:"cp857",cp858:{type:"_sbcs",chars:""},ibm858:"cp858",csibm858:"cp858",cp860:{type:"_sbcs",chars:""},ibm860:"cp860",csibm860:"cp860",cp861:{type:"_sbcs",chars:""},ibm861:"cp861",csibm861:"cp861",cp862:{type:"_sbcs",chars:""},ibm862:"cp862",csibm862:"cp862",cp863:{type:"_sbcs",chars:""},ibm863:"cp863",csibm863:"cp863",cp864:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#$&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"},ibm864:"cp864",csibm864:"cp864",cp865:{type:"_sbcs",chars:""},ibm865:"cp865",csibm865:"cp865",cp866:{type:"_sbcs",chars:""},ibm866:"cp866",csibm866:"cp866",cp869:{type:"_sbcs",chars:""},ibm869:"cp869",csibm869:"cp869",cp922:{type:"_sbcs",chars:""},ibm922:"cp922",csibm922:"cp922",cp1046:{type:"_sbcs",chars:""},ibm1046:"cp1046",csibm1046:"cp1046",cp1124:{type:"_sbcs",chars:""},ibm1124:"cp1124",csibm1124:"cp1124",cp1125:{type:"_sbcs",chars:""},ibm1125:"cp1125",csibm1125:"cp1125",cp1129:{type:"_sbcs",chars:""},ibm1129:"cp1129",csibm1129:"cp1129",cp1133:{type:"_sbcs",chars:""},ibm1133:"cp1133",csibm1133:"cp1133",cp1161:{type:"_sbcs",chars:""},ibm1161:"cp1161",csibm1161:"cp1161",cp1162:{type:"_sbcs",chars:""},ibm1162:"cp1162",csibm1162:"cp1162",cp1163:{type:"_sbcs",chars:""},ibm1163:"cp1163",csibm1163:"cp1163",maccroatian:{type:"_sbcs",chars:""},maccyrillic:{type:"_sbcs",chars:""},macgreek:{type:"_sbcs",chars:""},maciceland:{type:"_sbcs",chars:""},macroman:{type:"_sbcs",chars:""},macromania:{type:"_sbcs",chars:""},macthai:{type:"_sbcs",chars:"\ufeff"},macturkish:{type:"_sbcs",chars:""},macukraine:{type:"_sbcs",chars:""},koi8r:{type:"_sbcs",chars:""},koi8u:{type:"_sbcs",chars:""},koi8ru:{type:"_sbcs",chars:""},koi8t:{type:"_sbcs",chars:""},armscii8:{type:"_sbcs",chars:")(.,-"},rk1048:{type:"_sbcs",chars:""},tcvn:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"},georgianacademy:{type:"_sbcs",chars:""},georgianps:{type:"_sbcs",chars:""},pt154:{type:"_sbcs",chars:""},viscii:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"},iso646cn:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}"},iso646jp:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}"},hproman8:{type:"_sbcs",chars:""},macintosh:{type:"_sbcs",chars:""},ascii:{type:"_sbcs",chars:""},tis620:{type:"_sbcs",chars:""}};var _dbcs=DBCSCodec;var UNASSIGNED=-1;var GB18030_CODE=-2;var SEQ_START=-10;var NODE_START=-1e3;var UNASSIGNED_NODE=new Array(256);var DEF_CHAR=-1;for(var i$2=0;i$2<256;i$2++)UNASSIGNED_NODE[i$2]=UNASSIGNED;function DBCSCodec(codecOptions,iconv){this.encodingName=codecOptions.encodingName;if(!codecOptions)throw new Error("DBCS codec is called without the data.");if(!codecOptions.table)throw new Error("Encoding '"+this.encodingName+"' has no data.");var mappingTable=codecOptions.table();this.decodeTables=[];this.decodeTables[0]=UNASSIGNED_NODE.slice(0);this.decodeTableSeq=[];for(var i=0;i<mappingTable.length;i++)this._addDecodeChunk(mappingTable[i]);this.defaultCharUnicode=iconv.defaultCharUnicode;this.encodeTable=[];this.encodeTableSeq=[];var skipEncodeChars={};if(codecOptions.encodeSkipVals)for(var i=0;i<codecOptions.encodeSkipVals.length;i++){var val=codecOptions.encodeSkipVals[i];if(typeof val==="number")skipEncodeChars[val]=true;else for(var j=val.from;j<=val.to;j++)skipEncodeChars[j]=true}this._fillEncodeTable(0,0,skipEncodeChars);if(codecOptions.encodeAdd){for(var uChar in codecOptions.encodeAdd)if(Object.prototype.hasOwnProperty.call(codecOptions.encodeAdd,uChar))this._setEncodeChar(uChar.charCodeAt(0),codecOptions.encodeAdd[uChar])}this.defCharSB=this.encodeTable[0][iconv.defaultCharSingleByte.charCodeAt(0)];if(this.defCharSB===UNASSIGNED)this.defCharSB=this.encodeTable[0]["?"];if(this.defCharSB===UNASSIGNED)this.defCharSB="?".charCodeAt(0);if(typeof codecOptions.gb18030==="function"){this.gb18030=codecOptions.gb18030();var thirdByteNodeIdx=this.decodeTables.length;var thirdByteNode=this.decodeTables[thirdByteNodeIdx]=UNASSIGNED_NODE.slice(0);var fourthByteNodeIdx=this.decodeTables.length;var fourthByteNode=this.decodeTables[fourthByteNodeIdx]=UNASSIGNED_NODE.slice(0);for(var i=129;i<=254;i++){var secondByteNodeIdx=NODE_START-this.decodeTables[0][i];var secondByteNode=this.decodeTables[secondByteNodeIdx];for(var j=48;j<=57;j++)secondByteNode[j]=NODE_START-thirdByteNodeIdx}for(var i=129;i<=254;i++)thirdByteNode[i]=NODE_START-fourthByteNodeIdx;for(var i=48;i<=57;i++)fourthByteNode[i]=GB18030_CODE}}DBCSCodec.prototype.encoder=DBCSEncoder;DBCSCodec.prototype.decoder=DBCSDecoder;DBCSCodec.prototype._getDecodeTrieNode=function(addr){var bytes=[];for(;addr>0;addr>>=8)bytes.push(addr&255);if(bytes.length==0)bytes.push(0);var node=this.decodeTables[0];for(var i=bytes.length-1;i>0;i--){var val=node[bytes[i]];if(val==UNASSIGNED){node[bytes[i]]=NODE_START-this.decodeTables.length;this.decodeTables.push(node=UNASSIGNED_NODE.slice(0))}else if(val<=NODE_START){node=this.decodeTables[NODE_START-val]}else throw new Error("Overwrite byte in "+this.encodingName+", addr: "+addr.toString(16))}return node};DBCSCodec.prototype._addDecodeChunk=function(chunk){var curAddr=parseInt(chunk[0],16);var writeTable=this._getDecodeTrieNode(curAddr);curAddr=curAddr&255;for(var k=1;k<chunk.length;k++){var part=chunk[k];if(typeof part==="string"){for(var l=0;l<part.length;){var code=part.charCodeAt(l++);if(55296<=code&&code<56320){var codeTrail=part.charCodeAt(l++);if(56320<=codeTrail&&codeTrail<57344)writeTable[curAddr++]=65536+(code-55296)*1024+(codeTrail-56320);else throw new Error("Incorrect surrogate pair in "+this.encodingName+" at chunk "+chunk[0])}else if(4080<code&&code<=4095){var len=4095-code+2;var seq=[];for(var m=0;m<len;m++)seq.push(part.charCodeAt(l++));writeTable[curAddr++]=SEQ_START-this.decodeTableSeq.length;this.decodeTableSeq.push(seq)}else writeTable[curAddr++]=code}}else if(typeof part==="number"){var charCode=writeTable[curAddr-1]+1;for(var l=0;l<part;l++)writeTable[curAddr++]=charCode++}else throw new Error("Incorrect type '"+typeof part+"' given in "+this.encodingName+" at chunk "+chunk[0])}if(curAddr>255)throw new Error("Incorrect chunk in "+this.encodingName+" at addr "+chunk[0]+": too long"+curAddr)};DBCSCodec.prototype._getEncodeBucket=function(uCode){var high=uCode>>8;if(this.encodeTable[high]===undefined)this.encodeTable[high]=UNASSIGNED_NODE.slice(0);return this.encodeTable[high]};DBCSCodec.prototype._setEncodeChar=function(uCode,dbcsCode){var bucket=this._getEncodeBucket(uCode);var low=uCode&255;if(bucket[low]<=SEQ_START)this.encodeTableSeq[SEQ_START-bucket[low]][DEF_CHAR]=dbcsCode;else if(bucket[low]==UNASSIGNED)bucket[low]=dbcsCode};DBCSCodec.prototype._setEncodeSequence=function(seq,dbcsCode){var uCode=seq[0];var bucket=this._getEncodeBucket(uCode);var low=uCode&255;var node;if(bucket[low]<=SEQ_START){node=this.encodeTableSeq[SEQ_START-bucket[low]]}else{node={};if(bucket[low]!==UNASSIGNED)node[DEF_CHAR]=bucket[low];bucket[low]=SEQ_START-this.encodeTableSeq.length;this.encodeTableSeq.push(node)}for(var j=1;j<seq.length-1;j++){var oldVal=node[uCode];if(typeof oldVal==="object")node=oldVal;else{node=node[uCode]={};if(oldVal!==undefined)node[DEF_CHAR]=oldVal}}uCode=seq[seq.length-1];node[uCode]=dbcsCode};DBCSCodec.prototype._fillEncodeTable=function(nodeIdx,prefix,skipEncodeChars){var node=this.decodeTables[nodeIdx];for(var i=0;i<256;i++){var uCode=node[i];var mbCode=prefix+i;if(skipEncodeChars[mbCode])continue;if(uCode>=0)this._setEncodeChar(uCode,mbCode);else if(uCode<=NODE_START)this._fillEncodeTable(NODE_START-uCode,mbCode<<8,skipEncodeChars);else if(uCode<=SEQ_START)this._setEncodeSequence(this.decodeTableSeq[SEQ_START-uCode],mbCode)}};function DBCSEncoder(options,codec){this.leadSurrogate=-1;this.seqObj=undefined;this.encodeTable=codec.encodeTable;this.encodeTableSeq=codec.encodeTableSeq;this.defaultCharSingleByte=codec.defCharSB;this.gb18030=codec.gb18030}DBCSEncoder.prototype.write=function(str){var newBuf=new Buffer(str.length*(this.gb18030?4:3)),leadSurrogate=this.leadSurrogate,seqObj=this.seqObj,nextChar=-1,i=0,j=0;while(true){if(nextChar===-1){if(i==str.length)break;var uCode=str.charCodeAt(i++)}else{var uCode=nextChar;nextChar=-1}if(55296<=uCode&&uCode<57344){if(uCode<56320){if(leadSurrogate===-1){leadSurrogate=uCode;continue}else{leadSurrogate=uCode;uCode=UNASSIGNED}}else{if(leadSurrogate!==-1){uCode=65536+(leadSurrogate-55296)*1024+(uCode-56320);leadSurrogate=-1}else{uCode=UNASSIGNED}}}else if(leadSurrogate!==-1){nextChar=uCode;uCode=UNASSIGNED;leadSurrogate=-1}var dbcsCode=UNASSIGNED;if(seqObj!==undefined&&uCode!=UNASSIGNED){var resCode=seqObj[uCode];if(typeof resCode==="object"){seqObj=resCode;continue}else if(typeof resCode=="number"){dbcsCode=resCode}else if(resCode==undefined){resCode=seqObj[DEF_CHAR];if(resCode!==undefined){dbcsCode=resCode;nextChar=uCode}else{}}seqObj=undefined}else if(uCode>=0){var subtable=this.encodeTable[uCode>>8];if(subtable!==undefined)dbcsCode=subtable[uCode&255];if(dbcsCode<=SEQ_START){seqObj=this.encodeTableSeq[SEQ_START-dbcsCode];continue}if(dbcsCode==UNASSIGNED&&this.gb18030){var idx=findIdx(this.gb18030.uChars,uCode);if(idx!=-1){var dbcsCode=this.gb18030.gbChars[idx]+(uCode-this.gb18030.uChars[idx]);newBuf[j++]=129+Math.floor(dbcsCode/12600);dbcsCode=dbcsCode%12600;newBuf[j++]=48+Math.floor(dbcsCode/1260);dbcsCode=dbcsCode%1260;newBuf[j++]=129+Math.floor(dbcsCode/10);dbcsCode=dbcsCode%10;newBuf[j++]=48+dbcsCode;continue}}}if(dbcsCode===UNASSIGNED)dbcsCode=this.defaultCharSingleByte;if(dbcsCode<256){newBuf[j++]=dbcsCode}else if(dbcsCode<65536){newBuf[j++]=dbcsCode>>8;newBuf[j++]=dbcsCode&255}else{newBuf[j++]=dbcsCode>>16;newBuf[j++]=dbcsCode>>8&255;newBuf[j++]=dbcsCode&255}}this.seqObj=seqObj;this.leadSurrogate=leadSurrogate;return newBuf.slice(0,j)};DBCSEncoder.prototype.end=function(){if(this.leadSurrogate===-1&&this.seqObj===undefined)return;var newBuf=new Buffer(10),j=0;if(this.seqObj){var dbcsCode=this.seqObj[DEF_CHAR];if(dbcsCode!==undefined){if(dbcsCode<256){newBuf[j++]=dbcsCode}else{newBuf[j++]=dbcsCode>>8;newBuf[j++]=dbcsCode&255}}else{}this.seqObj=undefined}if(this.leadSurrogate!==-1){newBuf[j++]=this.defaultCharSingleByte;this.leadSurrogate=-1}return newBuf.slice(0,j)};DBCSEncoder.prototype.findIdx=findIdx;function DBCSDecoder(options,codec){this.nodeIdx=0;this.prevBuf=new Buffer(0);this.decodeTables=codec.decodeTables;this.decodeTableSeq=codec.decodeTableSeq;this.defaultCharUnicode=codec.defaultCharUnicode;this.gb18030=codec.gb18030}DBCSDecoder.prototype.write=function(buf){var newBuf=new Buffer(buf.length*2),nodeIdx=this.nodeIdx,prevBuf=this.prevBuf,prevBufOffset=this.prevBuf.length,seqStart=-this.prevBuf.length,uCode;if(prevBufOffset>0)prevBuf=Buffer.concat([prevBuf,buf.slice(0,10)]);for(var i=0,j=0;i<buf.length;i++){var curByte=i>=0?buf[i]:prevBuf[i+prevBufOffset];var uCode=this.decodeTables[nodeIdx][curByte];if(uCode>=0){}else if(uCode===UNASSIGNED){i=seqStart;uCode=this.defaultCharUnicode.charCodeAt(0)}else if(uCode===GB18030_CODE){var curSeq=seqStart>=0?buf.slice(seqStart,i+1):prevBuf.slice(seqStart+prevBufOffset,i+1+prevBufOffset);var ptr=(curSeq[0]-129)*12600+(curSeq[1]-48)*1260+(curSeq[2]-129)*10+(curSeq[3]-48);var idx=findIdx(this.gb18030.gbChars,ptr);uCode=this.gb18030.uChars[idx]+ptr-this.gb18030.gbChars[idx]}else if(uCode<=NODE_START){nodeIdx=NODE_START-uCode;continue}else if(uCode<=SEQ_START){var seq=this.decodeTableSeq[SEQ_START-uCode];for(var k=0;k<seq.length-1;k++){uCode=seq[k];newBuf[j++]=uCode&255;newBuf[j++]=uCode>>8}uCode=seq[seq.length-1]}else throw new Error("iconv-lite internal error: invalid decoding table value "+uCode+" at "+nodeIdx+"/"+curByte);if(uCode>65535){uCode-=65536;var uCodeLead=55296+Math.floor(uCode/1024);newBuf[j++]=uCodeLead&255;newBuf[j++]=uCodeLead>>8;uCode=56320+uCode%1024}newBuf[j++]=uCode&255;newBuf[j++]=uCode>>8;nodeIdx=0;seqStart=i+1}this.nodeIdx=nodeIdx;this.prevBuf=seqStart>=0?buf.slice(seqStart):prevBuf.slice(seqStart+prevBufOffset);return newBuf.slice(0,j).toString("ucs2")};DBCSDecoder.prototype.end=function(){var ret="";while(this.prevBuf.length>0){ret+=this.defaultCharUnicode;var buf=this.prevBuf.slice(1);this.prevBuf=new Buffer(0);this.nodeIdx=0;if(buf.length>0)ret+=this.write(buf)}this.nodeIdx=0;return ret};function findIdx(table,val){if(table[0]>val)return-1;var l=0,r=table.length;while(l<r-1){var mid=l+Math.floor((r-l+1)/2);if(table[mid]<=val)l=mid;else r=mid}return l}var dbcsCodec={_dbcs:_dbcs};var shiftjis=[["0","\0",128],["a1","",62],["8140","",9,""],["8180",""],["81b8",""],["81c8",""],["81da",""],["81f0",""],["81fc",""],["824f","",9],["8260","",25],["8281","",25],["829f","",82],["8340","",62],["8380","",22],["839f","",16,"",6],["83bf","",16,"",6],["8440","",5,"",25],["8470","",5,"",7],["8480","",17],["849f",""],["8740","",19,"",9],["875f",""],["877e",""],["8780","",4,""],["889f",""],["8940",""],["8980",""],["8a40",""],["8a80",""],["8b40",""],["8b80",""],["8c40",""],["8c80",""],["8d40",""],["8d80",""],["8e40",""],["8e80",""],["8f40",""],["8f80",""],["9040",""],["9080",""],["9140",""],["9180",""],["9240",""],["9280",""],["9340",""],["9380",""],["9440",""],["9480",""],["9540",""],["9580",""],["9640",""],["9680",""],["9740",""],["9780",""],["9840",""],["989f",""],["9940",""],["9980",""],["9a40",""],["9a80",""],["9b40",""],["9b80",""],["9c40",""],["9c80",""],["9d40",""],["9d80",""],["9e40",""],["9e80",""],["9f40",""],["9f80",""],["e040",""],["e080",""],["e140",""],["e180",""],["e240",""],["e280",""],["e340",""],["e380",""],["e440",""],["e480",""],["e540",""],["e580",""],["e640",""],["e680",""],["e740",""],["e780",""],["e840",""],["e880",""],["e940",""],["e980",""],["ea40",""],["ea80",""],["ed40",""],["ed80",""],["ee40",""],["ee80",""],["eeef","",9,""],["f040","",62],["f080","",124],["f140","",62],["f180","",124],["f240","",62],["f280","",124],["f340","",62],["f380","",124],["f440","",62],["f480","",124],["f540","",62],["f580","",124],["f640","",62],["f680","",124],["f740","",62],["f780","",124],["f840","",62],["f880","",124],["f940",""],["fa40","",9,"",9,""],["fa80",""],["fb40",""],["fb80",""],["fc40",""]];var shiftjis$1=Object.freeze({default:shiftjis});var eucjp=[["0","\0",127],["8ea1","",62],["a1a1","",9,""],["a2a1",""],["a2ba",""],["a2ca",""],["a2dc",""],["a2f2",""],["a2fe",""],["a3b0","",9],["a3c1","",25],["a3e1","",25],["a4a1","",82],["a5a1","",85],["a6a1","",16,"",6],["a6c1","",16,"",6],["a7a1","",5,"",25],["a7d1","",5,"",25],["a8a1",""],["ada1","",19,"",9],["adc0",""],["addf","",4,""],["b0a1",""],["b1a1",""],["b2a1",""],["b3a1",""],["b4a1",""],["b5a1",""],["b6a1",""],["b7a1",""],["b8a1",""],["b9a1",""],["baa1",""],["bba1",""],["bca1",""],["bda1",""],["bea1",""],["bfa1",""],["c0a1",""],["c1a1",""],["c2a1",""],["c3a1",""],["c4a1",""],["c5a1",""],["c6a1",""],["c7a1",""],["c8a1",""],["c9a1",""],["caa1",""],["cba1",""],["cca1",""],["cda1",""],["cea1",""],["cfa1",""],["d0a1",""],["d1a1",""],["d2a1",""],["d3a1",""],["d4a1",""],["d5a1",""],["d6a1",""],["d7a1",""],["d8a1",""],["d9a1",""],["daa1",""],["dba1",""],["dca1",""],["dda1",""],["dea1",""],["dfa1",""],["e0a1",""],["e1a1",""],["e2a1",""],["e3a1",""],["e4a1",""],["e5a1",""],["e6a1",""],["e7a1",""],["e8a1",""],["e9a1",""],["eaa1",""],["eba1",""],["eca1",""],["eda1",""],["eea1",""],["efa1",""],["f0a1",""],["f1a1",""],["f2a1",""],["f3a1",""],["f4a1",""],["f9a1",""],["faa1",""],["fba1",""],["fca1",""],["fcf1","",9,""],["8fa2af",""],["8fa2c2",""],["8fa2eb",""],["8fa6e1",""],["8fa6e7",""],["8fa6e9",""],["8fa6ec",""],["8fa6f1",""],["8fa7c2","",10,""],["8fa7f2","",10,""],["8fa9a1",""],["8fa9a4",""],["8fa9a6",""],["8fa9a8",""],["8fa9ab",""],["8fa9af",""],["8fa9c1",""],["8faaa1",""],["8faaba",""],["8faba1",""],["8fabbd",""],["8fabc5",""],["8fb0a1",""],["8fb1a1",""],["8fb2a1","",4,""],["8fb3a1",""],["8fb4a1",""],["8fb5a1",""],["8fb6a1","",5,"",4,""],["8fb7a1","",4,""],["8fb8a1",""],["8fb9a1",""],["8fbaa1","",4,""],["8fbba1",""],["8fbca1","",4,""],["8fbda1","",4,""],["8fbea1","",4,""],["8fbfa1",""],["8fc0a1",""],["8fc1a1",""],["8fc2a1",""],["8fc3a1","",4,""],["8fc4a1",""],["8fc5a1",""],["8fc6a1",""],["8fc7a1",""],["8fc8a1",""],["8fc9a1","",4,"",4,""],["8fcaa1",""],["8fcba1",""],["8fcca1","",9,""],["8fcda1","",5,""],["8fcea1","",6,""],["8fcfa1",""],["8fd0a1",""],["8fd1a1",""],["8fd2a1","",5],["8fd3a1",""],["8fd4a1","",4,""],["8fd5a1",""],["8fd6a1",""],["8fd7a1",""],["8fd8a1",""],["8fd9a1","",4,"",6,""],["8fdaa1","",4,""],["8fdba1","",6,""],["8fdca1","",4,""],["8fdda1","",4,""],["8fdea1","",4,""],["8fdfa1",""],["8fe0a1",""],["8fe1a1","",4,""],["8fe2a1",""],["8fe3a1","",5,"",4,""],["8fe4a1","",4,""],["8fe5a1","",4,""],["8fe6a1",""],["8fe7a1",""],["8fe8a1","",4,""],["8fe9a1","",4],["8feaa1","",4,""],["8feba1","",4,""],["8feca1",""],["8feda1","",4,"",4,""]];var eucjp$1=Object.freeze({default:eucjp});var cp936=[["0","\0",127,""],["8140","",5,"",9,"",6,""],["8180","",6,"",4,"",4,"",5,""],["8240","",4,"",8,"",4,"",11],["8280","",10,"",4,"",7,"",5,"",8,"",20,"",4,"",6,""],["8340","",17,"",5,"",10,"",4,"",9,""],["8380","",5,"",13,"",28,"",4,"",4,"",5],["8440","",5,"",5,""],["8480","",9,"",4,"",6,"",6,"",9,"",5,"",10,"",7,""],["8540","",9,""],["8580","",4,"",6,"",4,"",4,"",7,""],["8640","",4,"",5,"",4,"",5,""],["8680","",4,"",4,"",5,"",6,"",8,"",4,"",4,"",4,""],["8740","",7,"",11,"",4,"",4],["8780","",7,"",6,"",14,"",10,"",6,"",12,"",8,"",5,"",6],["8840","",9,"",4,"",4,""],["8880","",4,"",6,"",8,"",6,"",7,"",4,"",4,"",7],["8940","",5,"",6,"",4,"",5,"",4,"",16,""],["8980","",4,"",4,"",7,"",17,"",10,"",13,"",5,"",7,"",4,""],["8a40","",4,"",12,""],["8a80","",5,"",6,"",4,"",11,"",6,"",4,"",4,"",9,"",5],["8b40","",8,"",17,"",6,"",13,""],["8b80","",4,"",4,"",5,"",4,"",4,"",22,"",11,"",25,"",7,"",6],["8c40","",7,""],["8c80","",8,"",4,"",6,"",6,"",6,"",4,"",4,"",4],["8d40","",5,"",5,"",5,"",6,"",9,"",4],["8d80","",5,"",4,"",4,"",4,"",7,"",7,"",10,"",10,"",12,"",21,""],["8e40","",21,"",12,"",6,"",12,""],["8e80","",4,"",7,"",4,"",4,"",5,"",6,"",4,"",14,"",4,"",4,"",6],["8f40","",5,"",11,"",8,""],["8f80","",6,"",14,"",5,"",5,"",4,""],["9040","",4,"",4,"",6,""],["9080","",7,"",4,"",4,"",4,"",4,"",18,"",6],["9140","",6,"",6,"",18,"",4,""],["9180","",6,"",8,"",9,"",5,"",4,"",4,"",16,"",13,"",8,"",5,"",4,""],["9240","",6,"",5,""],["9280","",5,"",7,"",6,""],["9340","",6,"",4,"",4,"",5,""],["9380","",5,"",4,"",6,"",4,"",7,"",9,"",6,"",8,"",4,"",6,""],["9440","",24,"",7,"",7,"",4,"",8],["9480","",4,"",4,"",14,"",7,"",7,""],["9540","",4,"",4,"",6,""],["9580","",4,"",4,"",8,"",4,"",4,"",25,"",7,"",5,""],["9640","",5,"",4,""],["9680","",7,"",9,"",7,"",4,"",6,"",6,"",5],["9740","",7,"",8,"",7,"",9,""],["9780","",6,"",5,"",4,"",9,"",4,"",11,"",7,"",16,""],["9840","",4,"",5,"",9,""],["9880","",7,"",5,"",11,"",9,"",9,"",11,"",5,"",5,"",6,"",4,"",7,"",6,""],["9940","",4,"",10,"",6,"",8,"",4,"",7,"",5],["9980","",114,"",6],["9a40","",11,"",7,"",13,""],["9a80","",4,"",7,"",7,"",6,"",4,"",4,"",7,"",6,"",4,"",4,""],["9b40","",4,""],["9b80","",5,"",4,"",4,"",5,""],["9c40","",7,""],["9c80","",7,"",7,"",10,"",14,"",4,"",6,"",5],["9d40","",7,"",4,"",9,"",6,""],["9d80","",9,"",5,"",6,"",12,"",4,"",10,"",5,"",5,"",6,"",10,""],["9e40","",7,"",32,"",7,"",6,"",6],["9e80","",9,"",17,"",13,"",11,"",12,"",12,""],["9f40","",6,"",10,"",4,"",10,"",7,""],["9f80","",13,"",12,"",4,"",4,"",5,"",4,"",4,"",6,"",5,"",8,"",9,"",4],["a040","",9,"",5,"",9,"",11,"",19],["a080","",9,"",6,"",4,"",11,"",11,"",6,""],["a1a1","",7,""],["a2a1","",9],["a2b1","",19,"",19,"",9],["a2e5","",9],["a2f1","",11],["a3a1","",88,""],["a4a1","",82],["a5a1","",85],["a6a1","",16,"",6],["a6c1","",16,"",6],["a6e0",""],["a6ee",""],["a6f4",""],["a7a1","",5,"",25],["a7d1","",5,"",25],["a840","",35,"",6],["a880","",7,""],["a8a1",""],["a8bd",""],["a8c0",""],["a8c5","",36],["a940","",8,""],["a959",""],["a95c",""],["a960","",9,"",8],["a980","",4,""],["a996",""],["a9a4","",75],["aa40","",5,"",5,"",8],["aa80","",7,"",10,""],["ab40","",11,"",4,"",5,"",4],["ab80","",6,"",4],["ac40","",10,"",8,"",5,"",4,"",11],["ac80","",6,"",12,"",4,""],["ad40","",10,"",7,"",15,"",12],["ad80","",9,"",8,"",6,""],["ae40","",6,"",7,"",4,""],["ae80","",7,"",6,"",4,""],["af40","",4,""],["af80",""],["b040","",6,"",5,"",4,"",6,"",7,""],["b080","",7,"",8,"",9,""],["b140","",4,"",7,"",10,""],["b180","",4,"",7,"",7,""],["b240","",11,"",5,"",11,"",4],["b280","",12,"",8,"",4,""],["b340","",5,""],["b380","",11,"",7,"",6,""],["b440","",7,"",9],["b480","",4,"",5,"",6,""],["b540","",5,"",9,"",4,"",14,"",4,"",8,""],["b580","",6,"",4,""],["b640","",6,"",11,"",10,"",4,"",5,""],["b680","",6,"",4,""],["b740","",14,"",5,"",9,"",4,"",16],["b780","",6,""],["b840","",4,"",10,"",10,"",9,"",5,""],["b880","",4,""],["b940","",5,"",10,"",6,""],["b980","",7,""],["ba40","",4,"",4,"",7,"",5,""],["ba80","",4,"",5,"",12,"",5,""],["bb40","",9,"",36,"",5,"",9],["bb80","",6,"",4,""],["bc40","",6,"",6,"",5,"",7,"",13,"",5],["bc80","",14,"",6,""],["bd40","",54,"",7],["bd80","",32,""],["be40","",12,"",6,"",42],["be80","",32,""],["bf40","",62],["bf80","",4,"",4,"",21,""],["c040","",35,"",23,""],["c080","",6,"",9,""],["c140","",4,"",7,"",4,"",4,"",6,""],["c180","",4,"",4,"",5,""],["c240","",6,"",5,""],["c280","",13,"",5,"",11,""],["c340","",5,"",4,"",6,""],["c380","",12,"",4,""],["c440","",5,"",4,"",4,"",5,"",4,""],["c480","",7,"",5,"",6,""],["c540","",14,"",4,"",5,"",4,"",5,""],["c580","",7,"",7,""],["c640",""],["c680","",4,"",9,""],["c740","",4,"",4,"",6,"",6,"",6,""],["c780",""],["c840","",4,"",5,"",5,"",7,"",5,"",7,""],["c880","",6,"",4,"",4,""],["c940","",4,"",7,"",12,""],["c980","",4,"",4,"",10,""],["ca40","",8,"",8,"",9,"",4,"",10],["ca80","",4,"",8,""],["cb40","",6,"",10,"",6,"",5,"",6,"",6,"",4,""],["cb80","",5,"",6,"",14,""],["cc40","",4,"",10,"",15,"",13,""],["cc80","",11,"",4,"",7,""],["cd40","",6,"",6,"",4,"",5,"",4,"",4,""],["cd80",""],["ce40","",6,"",5,"",7,""],["ce80","",4,"",6,"",4,""],["cf40","",4,"",4,"",6,"",9],["cf80","",5,"",7,"",4,""],["d040","",13,"",5,"",5,"",5,"",6,""],["d080","",4,"",4,"",5,""],["d140","",4,"",4,"",6,"",5],["d180","",4,"",4,"",4,""],["d240","",8,"",24,"",5,"",19,""],["d280","",26,""],["d340","",30,"",6],["d380","",4,"",5,"",21,""],["d440","",31,"",8,"",21],["d480","",25,"",6,""],["d540","",7,"",7,"",46],["d580","",32,""],["d640","",34,"",27],["d680","",30,""],["d740","",31,"",4,"",25],["d780","",24,""],["d840","",8,"",7,"",5,"",6,"",6,"",6,""],["d880","",6,"",20,""],["d940","",62],["d980","",32,""],["da40","",14,"",8,"",4,"",9,""],["da80","",12,""],["db40","",6,"",7,"",4,""],["db80","",4,"",5,"",11,""],["dc40","",4,"",6,"",6,"",11,"",6,"",7],["dc80","",10,"",21,""],["dd40","",62],["dd80","",32,""],["de40","",32,""],["de80","",4,""],["df40","",5,"",4,"",4,"",5,"",4,"",6,""],["df80","",4,""],["e040","",19,""],["e080","",10,"",6,"",8,""],["e140","",4,"",6,"",5,"",5,""],["e180","",10,"",9,"",8,""],["e240","",62],["e280","",32,"",5,""],["e340","",45,"",16],["e380","",7,"",24,""],["e440","",5,"",24,"",31],["e480","",32,""],["e540","",51,"",10],["e580","",31,""],["e640","",34,"",27],["e680","",29,""],["e740","",7,"",54],["e780","",32,"",6,"",4,""],["e840","",14,"",43,""],["e880","",20,""],["e940","",7,"",42],["e980","",32,""],["ea40","",27,"",6,""],["ea80","",4,"",12,""],["eb40","",9,"",7,"",9,"",6,""],["eb80","",4,""],["ec40","",8,"",4,"",18,"",7],["ec80","",4,"",7,"",4,"",4,""],["ed40","",6,"",46],["ed80","",4,"",23,""],["ee40","",62],["ee80","",32,"",4,"",6,""],["ef40","",5,"",37,"",4],["ef80","",30,"",4,"",8,""],["f040","",4,"",28,"",26],["f080","",9,"",12,"",4,"",6,""],["f140","",10,"",47],["f180","",32,""],["f240","",62],["f280","",32,""],["f340","",17,"",6,"",4,""],["f380","",8,"",6,""],["f440","",5,"",10,"",10,"",7,"",5],["f480","",32,""],["f540","",62],["f580","",32,""],["f640","",62],["f680","",32,"",5,"",5,"",4,"",7,""],["f740","",62],["f780","",4,"",4,""],["f840","",62],["f880","",32],["f940","",62],["f980","",32],["fa40","",62],["fa80","",32],["fb40","",27,"",9,""],["fb80","",5,"",8,"",5,""],["fc40","",8,"",4,"",8,"",6],["fc80","",4,"",5,"",8,""],["fd40","",4,"",4,"",10,"",38],["fd80","",5,"",11,"",4,""],["fe40",""]];var cp936$1=Object.freeze({default:cp936});var gbkAdded=[["a140","",62],["a180","",32],["a240","",62],["a280","",32],["a2ab","",5],["a2e3",""],["a2ef",""],["a2fd",""],["a340","",62],["a380","",31,""],["a440","",62],["a480","",32],["a4f4","",10],["a540","",62],["a580","",32],["a5f7","",7],["a640","",62],["a680","",32],["a6b9","",7],["a6d9","",6],["a6ec",""],["a6f3",""],["a6f6","",8],["a740","",62],["a780","",32],["a7c2","",14],["a7f2","",12],["a896","",10],["a8bc",""],["a8bf",""],["a8c1",""],["a8ea","",20],["a958",""],["a95b",""],["a95d",""],["a989","",11],["a997","",12],["a9f0","",14],["aaa1","",93],["aba1","",93],["aca1","",93],["ada1","",93],["aea1","",93],["afa1","",93],["d7fa","",4],["f8a1","",93],["f9a1","",93],["faa1","",93],["fba1","",93],["fca1","",93],["fda1","",93],["fe50",""],["fe80","",6,"",93]];var gbkAdded$1=Object.freeze({default:gbkAdded});var uChars=[128,165,169,178,184,216,226,235,238,244,248,251,253,258,276,284,300,325,329,334,364,463,465,467,469,471,473,475,477,506,594,610,712,716,730,930,938,962,970,1026,1104,1106,8209,8215,8218,8222,8231,8241,8244,8246,8252,8365,8452,8454,8458,8471,8482,8556,8570,8596,8602,8713,8720,8722,8726,8731,8737,8740,8742,8748,8751,8760,8766,8777,8781,8787,8802,8808,8816,8854,8858,8870,8896,8979,9322,9372,9548,9588,9616,9622,9634,9652,9662,9672,9676,9680,9702,9735,9738,9793,9795,11906,11909,11913,11917,11928,11944,11947,11951,11956,11960,11964,11979,12284,12292,12312,12319,12330,12351,12436,12447,12535,12543,12586,12842,12850,12964,13200,13215,13218,13253,13263,13267,13270,13384,13428,13727,13839,13851,14617,14703,14801,14816,14964,15183,15471,15585,16471,16736,17208,17325,17330,17374,17623,17997,18018,18212,18218,18301,18318,18760,18811,18814,18820,18823,18844,18848,18872,19576,19620,19738,19887,40870,59244,59336,59367,59413,59417,59423,59431,59437,59443,59452,59460,59478,59493,63789,63866,63894,63976,63986,64016,64018,64021,64025,64034,64037,64042,65074,65093,65107,65112,65127,65132,65375,65510,65536];var gbChars=[0,36,38,45,50,81,89,95,96,100,103,104,105,109,126,133,148,172,175,179,208,306,307,308,309,310,311,312,313,341,428,443,544,545,558,741,742,749,750,805,819,820,7922,7924,7925,7927,7934,7943,7944,7945,7950,8062,8148,8149,8152,8164,8174,8236,8240,8262,8264,8374,8380,8381,8384,8388,8390,8392,8393,8394,8396,8401,8406,8416,8419,8424,8437,8439,8445,8482,8485,8496,8521,8603,8936,8946,9046,9050,9063,9066,9076,9092,9100,9108,9111,9113,9131,9162,9164,9218,9219,11329,11331,11334,11336,11346,11361,11363,11366,11370,11372,11375,11389,11682,11686,11687,11692,11694,11714,11716,11723,11725,11730,11736,11982,11989,12102,12336,12348,12350,12384,12393,12395,12397,12510,12553,12851,12962,12973,13738,13823,13919,13933,14080,14298,14585,14698,15583,15847,16318,16434,16438,16481,16729,17102,17122,17315,17320,17402,17418,17859,17909,17911,17915,17916,17936,17939,17961,18664,18703,18814,18962,19043,33469,33470,33471,33484,33485,33490,33497,33501,33505,33513,33520,33536,33550,37845,37921,37948,38029,38038,38064,38065,38066,38069,38075,38076,38078,39108,39109,39113,39114,39115,39116,39265,39394,189e3];var gb18030Ranges={uChars:uChars,gbChars:gbChars};var gb18030Ranges$1=Object.freeze({uChars:uChars,gbChars:gbChars,default:gb18030Ranges});var cp949=[["0","\0",127],["8141","",4,"",6,""],["8161","",9,"",5,""],["8181","",18,"",4,"",6,"",5,"",6,"",7,"",7,"",4,"",4,""],["8241","",7,"",5],["8261","",6,"",5,""],["8281","",7,"",7,"",4,"",10,"",5,"",17,"",7,"",6,"",7,"",18],["8341","",5,"",5,"",7],["8361","",18,""],["8381","",4,"",6,"",5,"",5,"",46,"",6,"",5,"",8],["8441","",5,"",8],["8461","",18],["8481","",7,"",6,"",5,"",10,"",5,"",18,"",5,"",6,"",5,"",26,""],["8541","",5,"",4,"",6,"",4],["8561","",5,"",5,"",6,""],["8581","",6,"",6,"",9,"",26,"",29,"",6,"",5,""],["8641","",6,"",5,""],["8661","",6,"",10],["8681","",22,"",4,"",6,"",5,"",6,"",22,"",4,""],["8741","",9,"",15],["8761","",18,""],["8781","",5,"",7,"",7,"",5,"",6,"",5,"",18,"",6,"",26,"",6,"",4],["8841","",4,"",5,"",6,"",4],["8861","",4,""],["8881","",15,"",4,"",6,"",5,"",54,""],["8941","",6,"",5,""],["8961","",10,"",5,""],["8981","",21,"",18,"",18,"",6,"",6,"",7,"",15],["8a41","",10,"",6,""],["8a61","",4,"",18,""],["8a81","",4,"",19,"",5,"",7,"",5,"",6,"",5,"",4,"",5,"",26,""],["8b41","",5,"",4,"",6,""],["8b61","",6,"",8],["8b81","",52,"",4,"",6,"",5,"",18,"",18],["8c41","",15,"",4],["8c61","",6,"",5,"",6,"",5],["8c81","",12,"",26,"",50,"",5,"",16],["8d41","",16,"",8],["8d61","",17,""],["8d81","",4,"",33,"",6,"",7,"",6,"",9,"",6,"",5,"",6,""],["8e41","",6,"",5,"",8],["8e61","",4,"",19],["8e81","",13,"",6,"",4,"",6,"",5,"",6,"",5,"",11,"",7,"",6,"",5,"",7],["8f41","",7,"",17],["8f61","",7,"",6,"",4],["8f81","",5,"",7,"",5,"",6,"",5,"",18,"",6,"",26,"",6,"",5],["9041","",6,"",5,""],["9061","",5,"",15],["9081","",12,"",6,"",5,"",4,"",6,"",4,"",5,"",11,"",33,""],["9141","",6,"",5],["9161","",9,"",5],["9181","",20,"",4,"",5,"",14,"",33,"",7,"",5,"",6],["9241","",7,"",4,""],["9261","",7,"",7,"",4],["9281","",21,"",18,"",6,"",7,"",6,"",35,""],["9341","",4,""],["9361","",6,"",8],["9381","",37,"",4,"",4,"",6,"",5,"",7,"",22,""],["9441","",5,"",5,"",8],["9461","",5,"",6,"",12],["9481","",5,"",6,"",6,"",9,"",22,"",4,"",6,"",10,"",6,"",24],["9541","",11,"",5,""],["9561","",6,"",5,""],["9581","",6,"",35,"",4,"",4,"",4,"",6,"",5,"",13,"",14],["9641","",23,""],["9661","",6,"",5,"",8],["9681","",10,"",5,"",13,"",33,"",6,"",44],["9741","",16,"",8],["9761","",17,"",7],["9781","",11,"",5,"",6,"",89,""],["9841","",16,"",5,""],["9861","",6,"",15],["9881","",21,"",6,"",5,"",4,"",6,"",5,"",6,"",5,"",6,"",5,""],["9941","",6,"",5,""],["9961","",6,"",5,""],["9981","",8,"",5,"",4,"",11,"",5,"",6,"",6,"",6,"",7,"",6,"",5,""],["9a41","",16],["9a61","",6,"",6,""],["9a81","",4,"",6,"",5,"",5,"",6,"",5,"",5,"",33,"",5,"",6,""],["9b41","",6,"",8],["9b61","",17,"",7],["9b81","",25,"",4,"",5,"",50,"",22,""],["9c41","",4,"",5,"",5],["9c61","",8,"",6,"",9],["9c81","",8,"",6,"",6,"",9,"",26,"",6,"",5,"",18,"",6,"",12],["9d41","",13,"",8],["9d61","",25],["9d81","",8,"",5,"",9,"",6,"",10,"",6,"",5,"",6,"",5,""],["9e41","",7,"",9,""],["9e61","",4,"",6,""],["9e81","",6,"",6,"",6,"",5,"",10,"",5,"",6,"",5,"",6,""],["9f41","",5,"",4,"",5,""],["9f61","",6,"",5,""],["9f81","",4,"",5,"",6,"",5,"",6,"",4,"",6,"",7,"",4,"",4,""],["a041","",5,"",6,""],["a061","",5,"",13],["a081","",4,"",4,"",4,"",6,"",5,"",6,"",5,"",26,"",4,"",5,"",7,""],["a141","",18,""],["a161","",6,"",5,""],["a181","",14,"",5,"",4,"",9,""],["a241","",5,"",18],["a261","",6,"",18],["a281","",7,"",6,"",7,""],["a341","",6,"",10,""],["a361","",6,"",16],["a381","",16,"",4,"",58,"",32,""],["a441","",5,""],["a461","",5,"",12],["a481","",28,"",93],["a541","",4,"",6,"",5,""],["a561","",17,"",5,""],["a581","",16,"",14,"",9],["a5b0","",9],["a5c1","",16,"",6],["a5e1","",16,"",6],["a641","",19,""],["a661","",5,"",5,"",6],["a681","",6,"",18,"",7],["a741","",4,"",6,"",7],["a761","",22,""],["a781","",6,"",5,"",7,"",9,"",9,"",4,"",5,"",4,""],["a841","",10,"",14],["a861","",18,"",6],["a881","",19,"",11,""],["a8a6",""],["a8a8",""],["a8b1","",27,"",25,"",14,""],["a941","",14,"",10],["a961","",18],["a981","",14,"",6,"",27,"",25,"",14,""],["aa41","",6,"",4,""],["aa61","",4,"",5,"",6,""],["aa81","",29,"",82],["ab41","",6,"",5,""],["ab61","",6,"",5,"",5],["ab81","",8,"",6,"",12,"",85],["ac41","",5,"",6,""],["ac61","",11,"",4],["ac81","",28,"",5,"",25],["acd1","",5,"",25],["ad41","",6,"",5,"",7],["ad61","",6,"",10,""],["ad81","",5,"",18,""],["ae41","",5,"",16],["ae61","",5,"",6,"",4],["ae81","",6,"",5,""],["af41","",19],["af61","",13,"",5,""],["af81","",5,"",6,"",5,""],["b041","",5,"",5,"",12],["b061","",5,"",19],["b081","",13,"",6,"",5,"",7,"",4,""],["b141","",6,"",5,""],["b161","",6,"",5,"",11],["b181","",14,"",6,""],["b241","",6,"",5,""],["b261","",18,"",5,""],["b281","",5,"",18,"",6,""],["b341","",19,""],["b361","",5,"",5,"",5],["b381","",5,"",5,"",19,"",4,""],["b441","",5,"",6,"",5],["b461","",6,"",10,""],["b481","",6,"",18,"",4,"",4,""],["b541","",14,"",5],["b561","",5,"",5,"",4],["b581","",6,"",5,"",11,""],["b641","",7,"",17],["b661","",15,""],["b681","",5,"",6,"",5,""],["b741","",13,"",6,""],["b761","",20,""],["b781","",6,"",14,""],["b841","",7,"",17],["b861","",8,"",13],["b881","",5,"",24,"",4,""],["b941","",6,"",5,""],["b961","",14,"",6,""],["b981","",22,"",4,"",4,""],["ba41","",5,"",6,""],["ba61","",5,"",4,"",5],["ba81","",6,"",9,""],["bb41","",4,"",5,"",4,""],["bb61","",6,"",5,""],["bb81","",31,""],["bc41","",17,""],["bc61","",5,"",6,""],["bc81","",4,"",6,"",5,"",5,"",4,""],["bd41","",7,"",7,""],["bd61","",5,"",13],["bd81","",5,"",25,""],["be41","",7,"",14],["be61","",7,"",7,""],["be81","",4,"",4,"",5,"",8,"",6,""],["bf41","",10,"",14],["bf61","",18,""],["bf81","",5,"",7,"",6,"",5,""],["c041","",5,"",6,"",5],["c061","",25],["c081","",6,"",5,"",7,""],["c141","",5,"",6,""],["c161","",19,""],["c181","",31,""],["c241","",4,"",5,""],["c261","",4,"",5,"",6,""],["c281","",5,"",7,"",9,""],["c341","",4],["c361","",4,"",5,"",11],["c381","",5,"",7,"",5,""],["c441","",7,"",7,""],["c461","",5,"",4],["c481","",5,"",11,""],["c541","",6,"",5,""],["c561","",6,"",5,"",4],["c581","",6,"",5,""],["c641","",6,"",5],["c6a1",""],["c7a1",""],["c8a1",""],["caa1",""],["cba1",""],["cca1",""],["cda1",""],["cea1",""],["cfa1",""],["d0a1",""],["d1a1","",5,"",4,""],["d2a1","",4,"",5,"",10,"",7,"",5,""],["d3a1",""],["d4a1",""],["d5a1",""],["d6a1",""],["d7a1",""],["d8a1",""],["d9a1",""],["daa1",""],["dba1",""],["dca1",""],["dda1",""],["dea1",""],["dfa1",""],["e0a1",""],["e1a1",""],["e2a1",""],["e3a1",""],["e4a1",""],["e5a1",""],["e6a1",""],["e7a1",""],["e8a1",""],["e9a1",""],["eaa1",""],["eba1",""],["eca1",""],["eda1",""],["eea1",""],["efa1",""],["f0a1",""],["f1a1",""],["f2a1",""],["f3a1",""],["f4a1",""],["f5a1",""],["f6a1",""],["f7a1",""],["f8a1",""],["f9a1",""],["faa1",""],["fba1",""],["fca1",""],["fda1",""]];var cp949$1=Object.freeze({default:cp949});var cp950=[["0","\0",127],["a140",""],["a1a1","",4,""],["a240","",7,""],["a2a1","",9,"",9,"",8,"",25,"",21],["a340","",16,"",6,"",16,"",6,"",10],["a3a1","",25,""],["a3e1",""],["a440",""],["a4a1",""],["a540",""],["a5a1",""],["a640",""],["a6a1",""],["a740",""],["a7a1",""],["a840",""],["a8a1",""],["a940",""],["a9a1",""],["aa40",""],["aaa1",""],["ab40",""],["aba1",""],["ac40",""],["aca1",""],["ad40",""],["ada1",""],["ae40",""],["aea1",""],["af40",""],["afa1",""],["b040",""],["b0a1",""],["b140",""],["b1a1",""],["b240",""],["b2a1",""],["b340",""],["b3a1",""],["b440",""],["b4a1",""],["b540",""],["b5a1",""],["b640",""],["b6a1",""],["b740",""],["b7a1",""],["b840",""],["b8a1",""],["b940",""],["b9a1",""],["ba40",""],["baa1",""],["bb40",""],["bba1",""],["bc40",""],["bca1",""],["bd40",""],["bda1",""],["be40",""],["bea1",""],["bf40",""],["bfa1",""],["c040",""],["c0a1",""],["c140",""],["c1a1",""],["c240",""],["c2a1",""],["c340",""],["c3a1",""],["c440",""],["c4a1",""],["c540",""],["c5a1",""],["c640",""],["c940",""],["c9a1",""],["ca40",""],["caa1",""],["cb40",""],["cba1",""],["cc40",""],["cca1",""],["cd40",""],["cda1",""],["ce40",""],["cea1",""],["cf40",""],["cfa1",""],["d040",""],["d0a1",""],["d140",""],["d1a1",""],["d240",""],["d2a1",""],["d340",""],["d3a1",""],["d440",""],["d4a1",""],["d540",""],["d5a1",""],["d640",""],["d6a1",""],["d740",""],["d7a1",""],["d840",""],["d8a1",""],["d940",""],["d9a1",""],["da40",""],["daa1",""],["db40",""],["dba1",""],["dc40",""],["dca1",""],["dd40",""],["dda1",""],["de40",""],["dea1",""],["df40",""],["dfa1",""],["e040",""],["e0a1",""],["e140",""],["e1a1",""],["e240",""],["e2a1",""],["e340",""],["e3a1",""],["e440",""],["e4a1",""],["e540",""],["e5a1",""],["e640",""],["e6a1",""],["e740",""],["e7a1",""],["e840",""],["e8a1",""],["e940",""],["e9a1",""],["ea40",""],["eaa1",""],["eb40",""],["eba1",""],["ec40",""],["eca1",""],["ed40",""],["eda1",""],["ee40",""],["eea1",""],["ef40",""],["efa1",""],["f040",""],["f0a1",""],["f140",""],["f1a1",""],["f240",""],["f2a1",""],["f340",""],["f3a1",""],["f440",""],["f4a1",""],["f540",""],["f5a1",""],["f640",""],["f6a1",""],["f740",""],["f7a1",""],["f840",""],["f8a1",""],["f940",""],["f9a1",""]];var cp950$1=Object.freeze({default:cp950});var big5Added=[["8740",""],["8767",""],["87a1",""],["8840","",4,""],["88a1",""],["8940",""],["8943",""],["8946",""],["894c",""],["89a1",""],["89ab",""],["89b0",""],["89b5",""],["89c1",""],["89c5",""],["8a40",""],["8a43",""],["8a64",""],["8a76",""],["8aa1",""],["8aac",""],["8ab2",""],["8abb",""],["8ac9",""],["8ace",""],["8adf",""],["8af6",""],["8b40",""],["8b55",""],["8ba1",""],["8bde",""],["8c40",""],["8ca1",""],["8ca7",""],["8cc9",""],["8cce",""],["8ce6",""],["8d40",""],["8d42",""],["8da1",""],["8e40",""],["8ea1",""],["8f40",""],["8fa1",""],["9040",""],["90a1",""],["9140",""],["91a1",""],["9240",""],["92a1",""],["9340",""],["93a1",""],["9440",""],["94a1",""],["9540",""],["95a1",""],["9640",""],["96a1",""],["9740",""],["97a1",""],["9840",""],["98a1",""],["9940",""],["99a1",""],["9a40",""],["9aa1",""],["9b40",""],["9b62",""],["9ba1",""],["9c40",""],["9ca1",""],["9d40",""],["9da1",""],["9e40",""],["9ea1",""],["9ead",""],["9ec5",""],["9ef5",""],["9f40",""],["9f4f",""],["9fa1",""],["9fae",""],["9fb2",""],["9fc1",""],["9fc9",""],["9fdb",""],["9fe7",""],["9feb",""],["9ff0",""],["a040",""],["a055",""],["a058",""],["a05b",""],["a063",""],["a073",""],["a0a1",""],["a0a6",""],["a0ae",""],["a0b0",""],["a0d4",""],["a0e2",""],["a3c0","",31,""],["c6a1","",9,"",9,"",9,"",23],["c740","",58,""],["c7a1","",81,"",5,"",4],["c840","",26,"",25,""],["c8a1",""],["c8cd",""],["c8f5",""],["f9fe",""],["fa40",""],["faa1",""],["fb40",""],["fba1",""],["fc40",""],["fca1",""],["fd40",""],["fda1",""],["fe40",""],["fea1",""]];var big5Added$1=Object.freeze({default:big5Added});var require$$0$7=shiftjis$1&&shiftjis||shiftjis$1;var require$$1$4=eucjp$1&&eucjp||eucjp$1;var require$$2$3=cp936$1&&cp936||cp936$1;var require$$3$1=gbkAdded$1&&gbkAdded||gbkAdded$1;var require$$4=gb18030Ranges$1&&gb18030Ranges||gb18030Ranges$1;var require$$5=cp949$1&&cp949||cp949$1;var require$$6=cp950$1&&cp950||cp950$1;var require$$7=big5Added$1&&big5Added||big5Added$1;var dbcsData={shiftjis:{type:"_dbcs",table:function(){return require$$0$7},encodeAdd:{"":92,"":126},encodeSkipVals:[{from:60736,to:63808}]},csshiftjis:"shiftjis",mskanji:"shiftjis",sjis:"shiftjis",windows31j:"shiftjis",ms31j:"shiftjis",xsjis:"shiftjis",windows932:"shiftjis",ms932:"shiftjis",932:"shiftjis",cp932:"shiftjis",eucjp:{type:"_dbcs",table:function(){return require$$1$4},encodeAdd:{"":92,"":126}},gb2312:"cp936",gb231280:"cp936",gb23121980:"cp936",csgb2312:"cp936",csiso58gb231280:"cp936",euccn:"cp936",windows936:"cp936",ms936:"cp936",936:"cp936",cp936:{type:"_dbcs",table:function(){return require$$2$3}},gbk:{type:"_dbcs",table:function(){return require$$2$3.concat(require$$3$1)}},xgbk:"gbk",isoir58:"gbk",gb18030:{type:"_dbcs",table:function(){return require$$2$3.concat(require$$3$1)},gb18030:function(){return require$$4},encodeSkipVals:[128],encodeAdd:{"":41699}},chinese:"gb18030",windows949:"cp949",ms949:"cp949",949:"cp949",cp949:{type:"_dbcs",table:function(){return require$$5}},cseuckr:"cp949",csksc56011987:"cp949",euckr:"cp949",isoir149:"cp949",korean:"cp949",ksc56011987:"cp949",ksc56011989:"cp949",ksc5601:"cp949",windows950:"cp950",ms950:"cp950",950:"cp950",cp950:{type:"_dbcs",table:function(){return require$$6}},big5:"big5hkscs",big5hkscs:{type:"_dbcs",table:function(){return require$$6.concat(require$$7)},encodeSkipVals:[41676]},cnbig5:"big5hkscs",csbig5:"big5hkscs",xxbig5:"big5hkscs"};var index$54=createCommonjsModule(function(module,exports){"use strict";var modules=[internal,utf16,utf7,sbcsCodec,sbcsData,sbcsDataGenerated,dbcsCodec,dbcsData];for(var i=0;i<modules.length;i++){var module=modules[i];for(var enc in module)if(Object.prototype.hasOwnProperty.call(module,enc))exports[enc]=module[enc]}});var Transform=require$$1.Transform;var streams=function(iconv){iconv.encodeStream=function encodeStream(encoding,options){return new IconvLiteEncoderStream(iconv.getEncoder(encoding,options),options)};iconv.decodeStream=function decodeStream(encoding,options){return new IconvLiteDecoderStream(iconv.getDecoder(encoding,options),options)};iconv.supportsStreams=true;iconv.IconvLiteEncoderStream=IconvLiteEncoderStream;iconv.IconvLiteDecoderStream=IconvLiteDecoderStream;iconv._collect=IconvLiteDecoderStream.prototype.collect};function IconvLiteEncoderStream(conv,options){this.conv=conv;options=options||{};options.decodeStrings=false;Transform.call(this,options)}IconvLiteEncoderStream.prototype=Object.create(Transform.prototype,{constructor:{value:IconvLiteEncoderStream}});IconvLiteEncoderStream.prototype._transform=function(chunk,encoding,done){if(typeof chunk!="string")return done(new Error("Iconv encoding stream needs strings as its input."));try{var res=this.conv.write(chunk);if(res&&res.length)this.push(res);done()}catch(e){done(e)}};IconvLiteEncoderStream.prototype._flush=function(done){try{var res=this.conv.end();if(res&&res.length)this.push(res);done()}catch(e){done(e)}};IconvLiteEncoderStream.prototype.collect=function(cb){var chunks=[];this.on("error",cb);this.on("data",function(chunk){chunks.push(chunk)});this.on("end",function(){cb(null,Buffer.concat(chunks))});return this};function IconvLiteDecoderStream(conv,options){this.conv=conv;options=options||{};options.encoding=this.encoding="utf8";Transform.call(this,options)}IconvLiteDecoderStream.prototype=Object.create(Transform.prototype,{constructor:{value:IconvLiteDecoderStream}});IconvLiteDecoderStream.prototype._transform=function(chunk,encoding,done){if(!Buffer.isBuffer(chunk))return done(new Error("Iconv decoding stream needs buffers as its input."));try{var res=this.conv.write(chunk);if(res&&res.length)this.push(res,this.encoding);done()}catch(e){done(e)}};IconvLiteDecoderStream.prototype._flush=function(done){try{var res=this.conv.end();if(res&&res.length)this.push(res,this.encoding);done()}catch(e){done(e)}};IconvLiteDecoderStream.prototype.collect=function(cb){var res="";this.on("error",cb);this.on("data",function(chunk){res+=chunk});this.on("end",function(){cb(null,res)});return this};var extendNode=function(iconv){var original=undefined;iconv.supportsNodeEncodingsExtension=!(new Buffer(0)instanceof Uint8Array);iconv.extendNodeEncodings=function extendNodeEncodings(){if(original)return;original={};if(!iconv.supportsNodeEncodingsExtension){console.error("ACTION NEEDED: require('iconv-lite').extendNodeEncodings() is not supported in your version of Node");console.error("See more info at https://github.com/ashtuchkin/iconv-lite/wiki/Node-v4-compatibility");return}var nodeNativeEncodings={hex:true,utf8:true,"utf-8":true,ascii:true,binary:true,base64:true,ucs2:true,"ucs-2":true,utf16le:true,"utf-16le":true};Buffer.isNativeEncoding=function(enc){return enc&&nodeNativeEncodings[enc.toLowerCase()]};var SlowBuffer=require$$0$5.SlowBuffer;original.SlowBufferToString=SlowBuffer.prototype.toString;SlowBuffer.prototype.toString=function(encoding,start,end){encoding=String(encoding||"utf8").toLowerCase();if(Buffer.isNativeEncoding(encoding))return original.SlowBufferToString.call(this,encoding,start,end);if(typeof start=="undefined")start=0;if(typeof end=="undefined")end=this.length;return iconv.decode(this.slice(start,end),encoding)};original.SlowBufferWrite=SlowBuffer.prototype.write;SlowBuffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();if(Buffer.isNativeEncoding(encoding))return original.SlowBufferWrite.call(this,string,offset,length,encoding);if(string.length>0&&(length<0||offset<0))throw new RangeError("attempt to write beyond buffer bounds");var buf=iconv.encode(string,encoding);if(buf.length<length)length=buf.length;buf.copy(this,offset,0,length);return length};original.BufferIsEncoding=Buffer.isEncoding;Buffer.isEncoding=function(encoding){return Buffer.isNativeEncoding(encoding)||iconv.encodingExists(encoding)};original.BufferByteLength=Buffer.byteLength;Buffer.byteLength=SlowBuffer.byteLength=function(str,encoding){encoding=String(encoding||"utf8").toLowerCase();if(Buffer.isNativeEncoding(encoding))return original.BufferByteLength.call(this,str,encoding);return iconv.encode(str,encoding).length};original.BufferToString=Buffer.prototype.toString;Buffer.prototype.toString=function(encoding,start,end){encoding=String(encoding||"utf8").toLowerCase();if(Buffer.isNativeEncoding(encoding))return original.BufferToString.call(this,encoding,start,end);if(typeof start=="undefined")start=0;if(typeof end=="undefined")end=this.length;return iconv.decode(this.slice(start,end),encoding)};original.BufferWrite=Buffer.prototype.write;Buffer.prototype.write=function(string,offset,length,encoding){var _offset=offset,_length=length,_encoding=encoding;if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}encoding=String(encoding||"utf8").toLowerCase();if(Buffer.isNativeEncoding(encoding))return original.BufferWrite.call(this,string,_offset,_length,_encoding);offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}if(string.length>0&&(length<0||offset<0))throw new RangeError("attempt to write beyond buffer bounds");var buf=iconv.encode(string,encoding);if(buf.length<length)length=buf.length;buf.copy(this,offset,0,length);return length};if(iconv.supportsStreams){var Readable=require$$1.Readable;original.ReadableSetEncoding=Readable.prototype.setEncoding;Readable.prototype.setEncoding=function setEncoding(enc,options){this._readableState.decoder=iconv.getDecoder(enc,options);this._readableState.encoding=enc};Readable.prototype.collect=iconv._collect}};iconv.undoExtendNodeEncodings=function undoExtendNodeEncodings(){if(!iconv.supportsNodeEncodingsExtension)return;if(!original)throw new Error("require('iconv-lite').undoExtendNodeEncodings(): Nothing to undo; extendNodeEncodings() is not called.");delete Buffer.isNativeEncoding;var SlowBuffer=require$$0$5.SlowBuffer;SlowBuffer.prototype.toString=original.SlowBufferToString;SlowBuffer.prototype.write=original.SlowBufferWrite;Buffer.isEncoding=original.BufferIsEncoding;Buffer.byteLength=original.BufferByteLength;Buffer.prototype.toString=original.BufferToString;Buffer.prototype.write=original.BufferWrite;if(iconv.supportsStreams){var Readable=require$$1.Readable;Readable.prototype.setEncoding=original.ReadableSetEncoding;delete Readable.prototype.collect}original=undefined}};var index$52=createCommonjsModule(function(module){"use strict";var iconv=module.exports;iconv.encodings=null;iconv.defaultCharUnicode="";iconv.defaultCharSingleByte="?";iconv.encode=function encode(str,encoding,options){str=""+(str||"");var encoder=iconv.getEncoder(encoding,options);var res=encoder.write(str);var trail=encoder.end();return trail&&trail.length>0?Buffer.concat([res,trail]):res};iconv.decode=function decode(buf,encoding,options){if(typeof buf==="string"){if(!iconv.skipDecodeWarning){console.error("Iconv-lite warning: decode()-ing strings is deprecated. Refer to https://github.com/ashtuchkin/iconv-lite/wiki/Use-Buffers-when-decoding");iconv.skipDecodeWarning=true}buf=new Buffer(""+(buf||""),"binary")}var decoder=iconv.getDecoder(encoding,options);var res=decoder.write(buf);var trail=decoder.end();return trail?res+trail:res};iconv.encodingExists=function encodingExists(enc){try{iconv.getCodec(enc);return true}catch(e){return false}};iconv.toEncoding=iconv.encode;iconv.fromEncoding=iconv.decode;iconv._codecDataCache={};iconv.getCodec=function getCodec(encoding){if(!iconv.encodings)iconv.encodings=index$54;var enc=(""+encoding).toLowerCase().replace(/[^0-9a-z]|:\d{4}$/g,"");var codecOptions={};while(true){var codec=iconv._codecDataCache[enc];if(codec)return codec;var codecDef=iconv.encodings[enc];switch(typeof codecDef){case"string":enc=codecDef;break;case"object":for(var key in codecDef)codecOptions[key]=codecDef[key];if(!codecOptions.encodingName)codecOptions.encodingName=enc;enc=codecDef.type;break;case"function":if(!codecOptions.encodingName)codecOptions.encodingName=enc;codec=new codecDef(codecOptions,iconv);iconv._codecDataCache[codecOptions.encodingName]=codec;return codec;default:throw new Error("Encoding not recognized: '"+encoding+"' (searched as: '"+enc+"')")}}};iconv.getEncoder=function getEncoder(encoding,options){var codec=iconv.getCodec(encoding),encoder=new codec.encoder(options,codec);if(codec.bomAware&&options&&options.addBOM)encoder=new bomHandling.PrependBOM(encoder,options);return encoder};iconv.getDecoder=function getDecoder(encoding,options){var codec=iconv.getCodec(encoding),decoder=new codec.decoder(options,codec);if(codec.bomAware&&!(options&&options.stripBOM===false))decoder=new bomHandling.StripBOM(decoder,options);return decoder};var nodeVer=typeof process!=="undefined"&&process.versions&&process.versions.node;if(nodeVer){var nodeVerArr=nodeVer.split(".").map(Number);if(nodeVerArr[0]>0||nodeVerArr[1]>=10){streams(iconv)}extendNode(iconv)}});var iconv_package;var Iconv;try{iconv_package="iconv";Iconv=commonjsRequire(iconv_package).Iconv}catch(E){}var iconvLoader=Iconv;var convert_1=convert$1;function convert$1(str,to,from,useLite){from=checkEncoding(from||"UTF-8");to=checkEncoding(to||"UTF-8");str=str||"";var result;if(from!=="UTF-8"&&typeof str==="string"){str=new Buffer(str,"binary")}if(from===to){if(typeof str==="string"){result=new Buffer(str)}else{result=str}}else if(iconvLoader&&!useLite){try{result=convertIconv(str,to,from)}catch(E){console.error(E);try{result=convertIconvLite(str,to,from)}catch(E){console.error(E);result=str}}}else{try{result=convertIconvLite(str,to,from)}catch(E){console.error(E);result=str}}if(typeof result==="string"){result=new Buffer(result,"utf-8")}return result}function convertIconv(str,to,from){var response,iconv;iconv=new iconvLoader(from,to+"//TRANSLIT//IGNORE");response=iconv.convert(str);return response.slice(0,response.length)}function convertIconvLite(str,to,from){if(to==="UTF-8"){return index$52.decode(str,from)}else if(from==="UTF-8"){return index$52.encode(str,to)}else{return index$52.encode(index$52.decode(str,from),to)}}function checkEncoding(name){return(name||"").toString().trim().replace(/^latin[\-_]?(\d+)$/i,"ISO-8859-$1").replace(/^win(?:dows)?[\-_]?(\d+)$/i,"WINDOWS-$1").replace(/^utf[\-_]?(\d+)$/i,"UTF-$1").replace(/^ks_c_5601\-1987$/i,"CP949").replace(/^us[\-_]?ascii$/i,"ASCII").toUpperCase()}var encoding={convert:convert_1};var index$56=createCommonjsModule(function(module){"use strict";var isStream=module.exports=function(stream$$1){return stream$$1!==null&&typeof stream$$1==="object"&&typeof stream$$1.pipe==="function"};isStream.writable=function(stream$$1){return isStream(stream$$1)&&stream$$1.writable!==false&&typeof stream$$1._write==="function"&&typeof stream$$1._writableState==="object"};isStream.readable=function(stream$$1){return isStream(stream$$1)&&stream$$1.readable!==false&&typeof stream$$1._read==="function"&&typeof stream$$1._readableState==="object"};isStream.duplex=function(stream$$1){return isStream.writable(stream$$1)&&isStream.readable(stream$$1)};isStream.transform=function(stream$$1){return isStream.duplex(stream$$1)&&typeof stream$$1._transform==="function"&&typeof stream$$1._transformState==="object"}});var fetchError=FetchError;function FetchError(message,type,systemError){Error.captureStackTrace(this,this.constructor);this.name=this.constructor.name;this.message=message;this.type=type;if(systemError){this.code=this.errno=systemError.code}}require$$0.inherits(FetchError,Error);var convert=encoding.convert;var PassThrough=require$$1.PassThrough;var body=Body;function Body(body,opts){opts=opts||{};this.body=body;this.bodyUsed=false;this.size=opts.size||0;this.timeout=opts.timeout||0;this._raw=[];this._abort=false}Body.prototype.json=function(){if(this.status===204){return Body.Promise.resolve({})}return this._decode().then(function(buffer$$1){return JSON.parse(buffer$$1.toString())})};Body.prototype.text=function(){return this._decode().then(function(buffer$$1){return buffer$$1.toString()})};Body.prototype.buffer=function(){return this._decode()};Body.prototype._decode=function(){var self=this;if(this.bodyUsed){return Body.Promise.reject(new Error("body used already for: "+this.url))}this.bodyUsed=true;this._bytes=0;this._abort=false;this._raw=[];return new Body.Promise(function(resolve,reject){var resTimeout;if(typeof self.body==="string"){self._bytes=self.body.length;self._raw=[new Buffer(self.body)];return resolve(self._convert())}if(self.body instanceof Buffer){self._bytes=self.body.length;self._raw=[self.body];return resolve(self._convert())}if(self.timeout){resTimeout=setTimeout(function(){self._abort=true;reject(new fetchError("response timeout at "+self.url+" over limit: "+self.timeout,"body-timeout"))},self.timeout)}self.body.on("error",function(err){reject(new fetchError("invalid response body at: "+self.url+" reason: "+err.message,"system",err))});self.body.on("data",function(chunk){if(self._abort||chunk===null){return}if(self.size&&self._bytes+chunk.length>self.size){self._abort=true;reject(new fetchError("content size at "+self.url+" over limit: "+self.size,"max-size"));return}self._bytes+=chunk.length;self._raw.push(chunk)});self.body.on("end",function(){if(self._abort){return}clearTimeout(resTimeout);resolve(self._convert())})})};Body.prototype._convert=function(encoding$$1){encoding$$1=encoding$$1||"utf-8";var ct=this.headers.get("content-type");var charset="utf-8";var res,str;if(ct){if(!/text\/html|text\/plain|\+xml|\/xml/i.test(ct)){return Buffer.concat(this._raw)}res=/charset=([^;]*)/i.exec(ct)}if(!res&&this._raw.length>0){for(var i=0;i<this._raw.length;i++){str+=this._raw[i].toString();if(str.length>1024){break}}str=str.substr(0,1024)}if(!res&&str){res=/<meta.+?charset=(['"])(.+?)\1/i.exec(str)}if(!res&&str){res=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(str);if(res){res=/charset=(.*)/i.exec(res.pop())}}if(!res&&str){res=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(str)}if(res){charset=res.pop();if(charset==="gb2312"||charset==="gbk"){charset="gb18030"}}return convert(Buffer.concat(this._raw),encoding$$1,charset)};Body.prototype._clone=function(instance){var p1,p2;var body=instance.body;if(instance.bodyUsed){throw new Error("cannot clone body after it is used")}if(index$56(body)&&typeof body.getBoundary!=="function"){p1=new PassThrough;p2=new PassThrough;body.pipe(p1);body.pipe(p2);instance.body=p1;body=p2}return body};Body.Promise=commonjsGlobal.Promise;var headers=Headers;function Headers(headers){var self=this;this._headers={};if(headers instanceof Headers){headers=headers.raw()}for(var prop in headers){if(!headers.hasOwnProperty(prop)){continue}if(typeof headers[prop]==="string"){this.set(prop,headers[prop])}else if(typeof headers[prop]==="number"&&!isNaN(headers[prop])){this.set(prop,headers[prop].toString())}else if(headers[prop]instanceof Array){headers[prop].forEach(function(item){self.append(prop,item.toString())})}}}Headers.prototype.get=function(name){var list=this._headers[name.toLowerCase()];return list?list[0]:null};Headers.prototype.getAll=function(name){if(!this.has(name)){return[]}return this._headers[name.toLowerCase()]};Headers.prototype.forEach=function(callback,thisArg){Object.getOwnPropertyNames(this._headers).forEach(function(name){this._headers[name].forEach(function(value){callback.call(thisArg,value,name,this)},this)},this)};Headers.prototype.set=function(name,value){this._headers[name.toLowerCase()]=[value]};Headers.prototype.append=function(name,value){if(!this.has(name)){this.set(name,value);return}this._headers[name.toLowerCase()].push(value)};Headers.prototype.has=function(name){return this._headers.hasOwnProperty(name.toLowerCase())};Headers.prototype["delete"]=function(name){delete this._headers[name.toLowerCase()]};Headers.prototype.raw=function(){return this._headers};var http$1=http&&http__default||http;var response=Response;function Response(body$$1,opts){opts=opts||{};this.url=opts.url;this.status=opts.status||200;this.statusText=opts.statusText||http$1.STATUS_CODES[this.status];this.headers=new headers(opts.headers);this.ok=this.status>=200&&this.status<300;body.call(this,body$$1,opts)}Response.prototype=Object.create(body.prototype);Response.prototype.clone=function(){return new Response(this._clone(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok})};var parse_url=require$$0$6.parse;var request=Request;function Request(input,init){var url$$1,url_parsed;if(!(input instanceof Request)){url$$1=input;url_parsed=parse_url(url$$1);input={}}else{url$$1=input.url;url_parsed=parse_url(url$$1)}init=init||{};this.method=init.method||input.method||"GET";this.redirect=init.redirect||input.redirect||"follow";this.headers=new headers(init.headers||input.headers||{});this.url=url$$1;this.follow=init.follow!==undefined?init.follow:input.follow!==undefined?input.follow:20;this.compress=init.compress!==undefined?init.compress:input.compress!==undefined?input.compress:true;this.counter=init.counter||input.counter||0;this.agent=init.agent||input.agent;body.call(this,init.body||this._clone(input),{timeout:init.timeout||input.timeout||0,size:init.size||input.size||0});this.protocol=url_parsed.protocol;this.hostname=url_parsed.hostname;this.port=url_parsed.port;this.path=url_parsed.path;this.auth=url_parsed.auth}Request.prototype=Object.create(body.prototype);Request.prototype.clone=function(){return new Request(this)};var https$1=https&&https__default||https;var zlib$1=zlib&&zlib__default||zlib;var index$50=createCommonjsModule(function(module){var parse_url=require$$0$6.parse;var resolve_url=require$$0$6.resolve;module.exports=Fetch;module.exports.default=module.exports;function Fetch(url$$1,opts){if(!(this instanceof Fetch))return new Fetch(url$$1,opts);if(!Fetch.Promise){throw new Error("native promise missing, set Fetch.Promise to your favorite alternative")}body.Promise=Fetch.Promise;var self=this;return new Fetch.Promise(function(resolve,reject){var options=new request(url$$1,opts);if(!options.protocol||!options.hostname){throw new Error("only absolute urls are supported")}if(options.protocol!=="http:"&&options.protocol!=="https:"){throw new Error("only http(s) protocols are supported")}var send;if(options.protocol==="https:"){send=https$1.request}else{send=http$1.request}var headers$$1=new headers(options.headers);if(options.compress){headers$$1.set("accept-encoding","gzip,deflate")}if(!headers$$1.has("user-agent")){headers$$1.set("user-agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)")}if(!headers$$1.has("connection")&&!options.agent){headers$$1.set("connection","close")}if(!headers$$1.has("accept")){headers$$1.set("accept","*/*")}if(!headers$$1.has("content-type")&&options.body&&typeof options.body.getBoundary==="function"){headers$$1.set("content-type","multipart/form-data; boundary="+options.body.getBoundary())}if(!headers$$1.has("content-length")&&/post|put|patch|delete/i.test(options.method)){if(typeof options.body==="string"){headers$$1.set("content-length",Buffer.byteLength(options.body))}else if(options.body&&typeof options.body.getLengthSync==="function"){if(options.body._lengthRetrievers&&options.body._lengthRetrievers.length==0){headers$$1.set("content-length",options.body.getLengthSync().toString())}else if(options.body.hasKnownLength&&options.body.hasKnownLength()){headers$$1.set("content-length",options.body.getLengthSync().toString())}}else if(options.body===undefined||options.body===null){headers$$1.set("content-length","0")}}options.headers=headers$$1.raw();if(options.headers.host){options.headers.host=options.headers.host[0]}var req=send(options);var reqTimeout;if(options.timeout){req.once("socket",function(socket){reqTimeout=setTimeout(function(){req.abort();reject(new fetchError("network timeout at: "+options.url,"request-timeout"))},options.timeout)})}req.on("error",function(err){clearTimeout(reqTimeout);reject(new fetchError("request to "+options.url+" failed, reason: "+err.message,"system",err))});req.on("response",function(res){clearTimeout(reqTimeout);if(self.isRedirect(res.statusCode)&&options.redirect!=="manual"){if(options.redirect==="error"){reject(new fetchError("redirect mode is set to error: "+options.url,"no-redirect"));return}if(options.counter>=options.follow){reject(new fetchError("maximum redirect reached at: "+options.url,"max-redirect"));return}if(!res.headers.location){reject(new fetchError("redirect location header missing at: "+options.url,"invalid-redirect"));return}if(res.statusCode===303||(res.statusCode===301||res.statusCode===302)&&options.method==="POST"){options.method="GET";delete options.body;delete options.headers["content-length"]}options.counter++;resolve(Fetch(resolve_url(options.url,res.headers.location),options));return}var headers$$1=new headers(res.headers);if(options.redirect==="manual"&&headers$$1.has("location")){headers$$1.set("location",resolve_url(options.url,headers$$1.get("location")))}var body$$1=res.pipe(new require$$1.PassThrough);var response_options={url:options.url,status:res.statusCode,statusText:res.statusMessage,headers:headers$$1,size:options.size,timeout:options.timeout};var output;if(!options.compress||options.method==="HEAD"||!headers$$1.has("content-encoding")||res.statusCode===204||res.statusCode===304){output=new response(body$$1,response_options);resolve(output);return}var name=headers$$1.get("content-encoding");if(name=="gzip"||name=="x-gzip"){body$$1=body$$1.pipe(zlib$1.createGunzip());output=new response(body$$1,response_options);resolve(output);return}else if(name=="deflate"||name=="x-deflate"){var raw=res.pipe(new require$$1.PassThrough);raw.once("data",function(chunk){if((chunk[0]&15)===8){body$$1=body$$1.pipe(zlib$1.createInflate())}else{body$$1=body$$1.pipe(zlib$1.createInflateRaw())}output=new response(body$$1,response_options);resolve(output)});return}output=new response(body$$1,response_options);resolve(output);return});if(typeof options.body==="string"){req.write(options.body);req.end()}else if(options.body instanceof Buffer){req.write(options.body);req.end()}else if(typeof options.body==="object"&&options.body.pipe){options.body.pipe(req)}else if(typeof options.body==="object"){req.write(options.body.toString());req.end()}else{req.end()}})}Fetch.prototype.isRedirect=function(code){return code===301||code===302||code===303||code===307||code===308};Fetch.Promise=commonjsGlobal.Promise;Fetch.Response=response;Fetch.Headers=headers;Fetch.Request=request});var slack=createCommonjsModule(function(module,exports){"use strict";var __awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});const slackChannelName=channel=>`#${process.env.SLACK_CHANNEL_PREFIX}${channel}`;const slackPostUrl="https://hooks.slack.com/services/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";exports.sendSlackMessage=(({key:key,message:message,channel:channel,fields:extraFields})=>__awaiter(commonjsGlobal,void 0,void 0,function*(){const requestId=index$18.v4();const fields=[{title:"Message",value:message},{title:"Request",value:requestId},...extraFields];const response=yield index$50.default(slackPostUrl,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({username:"Support Bot",icon_emoji:":ghost:",attachments:[{fallback:JSON.stringify(fields),fields:fields}],channel:slackChannelName(channel)})});log_1.info(key,"Support message sent",message,response.status,requestId);if(response.status!==200){throw new Error(`Unexpected response code from slack ${response.status}`)}}));exports.sendSlackMessageOneLine=(({key:key,message:message,channel:channel})=>__awaiter(commonjsGlobal,void 0,void 0,function*(){const response=yield index$50.default(slackPostUrl,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({username:"Support Bot",icon_emoji:":ghost:",text:message,channel:slackChannelName(channel)})});log_1.info(key,"One-line message sent",message,response.status);if(response.status!==200){throw new Error(`Unexpected response code from slack ${response.status}`)}}))});var index$58=createCommonjsModule(function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.calculateServiceFee=(price=>Math.ceil(price/1.1*.1));const{get:get,post:post}=fetch.default("store",baseUrl.lambdaBaseUrl);exports.getStoreFromCode=((key,code)=>get(1,key,`/code/${code}`));exports.getStoreFromId=((key,id)=>get(1,key,`/${id}`));exports.recordTransaction=((key,transaction)=>post(1,key,`/transaction`,transaction));exports.listItem=((key,storeId,listing,userId)=>post(1,key,`/${storeId}/item`,{userId:userId,listing:listing}));exports.updateItemDetails=((key,storeId,itemId,details,userId)=>post(1,key,`/${storeId}/${itemId}`,{userId:userId,details:details}));exports.updateItemCount=((key,storeId,itemId,count,userId)=>post(1,key,`/${storeId}/${itemId}/count`,{count:count,userId:userId}));exports.unlistItem=((key,storeId,itemId,userId)=>post(1,key,`/${storeId}/${itemId}/unlist`,{userId:userId}));exports.relistItem=((key,storeId,itemId,additionalCount,userId)=>post(1,key,`/${storeId}/${itemId}/relist`,{additionalCount:additionalCount,userId:userId}))});var stream$5=createCommonjsModule(function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const isAccount=account=>account.balance!=null;exports.subscribeTransactionsAndBalances=function*(event){for(const record of event.Records){const image=aws_sdk_1.DynamoDB.Converter.output({M:record.dynamodb.NewImage});if(isAccount(image)&&image.cachedTransactions.length>0){const{balance:balance,cachedTransactions:cachedTransactions}=image;yield{balance:balance,transaction:cachedTransactions[0]}}}};exports.subscribeTransactions=function*(event){for(const record of exports.subscribeTransactionsAndBalances(event)){const{transaction:transaction}=record;yield transaction}}});var index$60=createCommonjsModule(function(module,exports){"use strict";var __awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});const{get:get,post:post,put:put}=fetch.default("user");exports.getUser=((key,userId)=>get(1,key,`/${userId}`));exports.getUserByAccessToken=((key,accessToken)=>get(1,key,`/accessToken/${accessToken}`));exports.getUserByRefreshToken=((key,refreshToken)=>get(1,key,`/refreshToken/${refreshToken}`));exports.getUserByMagicLinkToken=((key,magicLinkToken)=>get(1,key,`/magicLink/${magicLinkToken}`));exports.getUserByEmailAddress=((key,emailAddress)=>get(1,key,`/emailAddress/${emailAddress}`));exports.createUser=((key,userId,userProfile)=>post(1,key,"/",Object.assign({userId:userId},userProfile)));exports.updateUser=((key,userId,userProfile)=>put(1,key,`/${userId}`,userProfile));exports.userRegistered=(user=>user.emailAddress!=null);exports.sendMagicLinkEmail=((key,emailAddress,storeCode)=>post(1,key,`/magicLink/${emailAddress}/${storeCode}`,{}));exports.logout=((key,userId)=>__awaiter(commonjsGlobal,void 0,void 0,function*(){return post(1,key,`/logout/${userId}`,{})}));exports.TEST_DATA_USER_ID="c50234ff-6c33-4878-a1ab-05f6b3e7b649"});var lambda=createCommonjsModule(function(module,exports){"use strict";var __awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});const cruft=index$12.default({tableName:process.env.TABLE_NAME,limit:100});const csvStringify=(objects,options)=>new Promise((resolve,reject)=>index.stringify(objects,options,(err,data)=>{if(err){return reject(err)}return resolve(data)}));const getCommonItemTransactionDetails=(key$$1,{id:transactionId,data:{itemId:itemId,storeId:storeId,userId:userId},amount:amount})=>__awaiter(commonjsGlobal,void 0,void 0,function*(){const[user,item,store]=yield Promise.all([index$60.getUser(key$$1,userId),index$14.getItem(key$$1,itemId),index$58.getStoreFromId(key$$1,storeId)]);const shortTxId=transactionId.replace(/^(.{5}).*:(.{5}).*/,"$1:$2");return{emailAddress:user.emailAddress,itemDescription:item.name+(item.qualifier?` ${item.qualifier}`:""),storeCode:store.code,price:Math.abs(amount),shortTxId:shortTxId}});const sendSlackRefundMessage=(key$$1,transaction)=>__awaiter(commonjsGlobal,void 0,void 0,function*(){const commonDetails=yield getCommonItemTransactionDetails(key$$1,transaction);const{data:{reason:comment}}=transaction;const message=Object.assign({emoji:":money_with_wings:",type:"refund"},commonDetails,{comment:comment});yield sendTransactionNotification(key$$1,message)});const sendSlackPurchaseMessage=(key$$1,transaction)=>__awaiter(commonjsGlobal,void 0,void 0,function*(){const commonDetails=yield getCommonItemTransactionDetails(key$$1,transaction);const message=Object.assign({emoji:":moneybag:",type:"purchase"},commonDetails,{comment:""});yield sendTransactionNotification(key$$1,message)});const sendTransactionNotification=(key$$1,message)=>__awaiter(commonjsGlobal,void 0,void 0,function*(){const csvMessage=yield csvStringify([message],{header:false});yield slack.sendSlackMessageOneLine({key:key$$1,message:csvMessage,channel:"purchases"})});const asyncHandler=dynamoEvent=>__awaiter(commonjsGlobal,void 0,void 0,function*(){const key$$1=key.createServiceKey({service:"transaction-slack"});const transactions=[...stream$5.subscribeTransactions(dynamoEvent)];const sendSlackMessage=event=>__awaiter(this,void 0,void 0,function*(){const transaction=transactions.find(({id:id})=>id===event.id);switch(event.type){case"purchase":yield sendSlackPurchaseMessage(key$$1,transaction);break;case"refund":yield sendSlackRefundMessage(key$$1,transaction);break;default:assert.assertNever(event.type);break}});const reduce=cruft.reduce(_event=>"aggregate",event=>event.id,(aggregate,event,_emit)=>__awaiter(this,void 0,void 0,function*(){yield sendSlackMessage(event);return aggregate}));for(const transaction of transactions){if(transaction.type!=="purchase"&&transaction.type!=="refund"){continue}const simplifiedTx={id:transaction.id,type:transaction.type,version:0};yield reduce(simplifiedTx)}return`Successfully processed ${dynamoEvent.Records.length} records`});exports.handler=((event,context)=>asyncHandler(event).then(info=>context.succeed(info)).catch(e=>context.fail(e)))});var lambda$1=unwrapExports(lambda);var lambda_1=lambda.handler;exports["default"]=lambda$1;exports.handler=lambda_1;
